<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Proton: GLESUtils.cpp Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Proton
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_b4959094aa2649f063000bebf8111065.html">shared</a>      </li>
      <li class="navelem"><a class="el" href="dir_0c90619a56014cc4e695b3ba8d24af5c.html">util</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">GLESUtils.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="GLESUtils_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include &quot;<a class="code" href="PlatformPrecomp_8h.html">PlatformPrecomp.h</a>&quot;</span>
<a name="l00002"></a>00002 <span class="preprocessor">#include &quot;<a class="code" href="GLESUtils_8h.html">GLESUtils.h</a>&quot;</span>
<a name="l00003"></a>00003 <span class="preprocessor">#include &quot;../Renderer/Surface.h&quot;</span>
<a name="l00004"></a>00004 <span class="preprocessor">#include &quot;<a class="code" href="BaseApp_8h.html">BaseApp.h</a>&quot;</span>
<a name="l00005"></a>00005 
<a name="l00006"></a><a class="code" href="GLESUtils_8cpp.html#a38deb7f34428741e2d3c1c635fb68e43">00006</a> <span class="keywordtype">float</span> <a class="code" href="GLESUtils_8cpp.html#a38deb7f34428741e2d3c1c635fb68e43">g_renderOrthoRenderSizeX</a>;
<a name="l00007"></a><a class="code" href="GLESUtils_8cpp.html#acf46e869b557a68225eb92905ea30d32">00007</a> <span class="keywordtype">float</span> <a class="code" href="GLESUtils_8cpp.html#acf46e869b557a68225eb92905ea30d32">g_renderOrthoRenderSizeY</a>;
<a name="l00008"></a>00008 
<a name="l00009"></a>00009 <span class="keywordtype">void</span>  <a class="code" href="GLESUtils_8cpp.html#a0c05467fb497e6cea00bc882f6c3a201">GenerateFillRect</a>( <a class="code" href="flash_2GLES_2gl_8h.html#a68c4714e43d8e827d80759f9cb864f3c">GLuint</a> rgba, <span class="keywordtype">float</span> <a class="code" href="flash_2GLES_2glext_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>, <span class="keywordtype">float</span> <a class="code" href="flash_2GLES_2glext_8h.html#a2532a9f8ed3a10a63f5e3c484fbfdb9b">y</a>, <span class="keywordtype">float</span> <a class="code" href="Renderer_2GL_2glext_8h.html#adb12a0d439f32ca388b2c806150cc54d">w</a>, <span class="keywordtype">float</span> <a class="code" href="Renderer_2GL_2glext_8h.html#afa0fb1b5e976920c0abeff2dca3ed774">h</a> );
<a name="l00010"></a>00010 
<a name="l00011"></a><a class="code" href="GLESUtils_8cpp.html#a9ec5523d823416523e820a4a7e75ba07">00011</a> <span class="keywordtype">void</span> <a class="code" href="GLESUtils_8cpp.html#a9ec5523d823416523e820a4a7e75ba07">gluLookAt</a>(<a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> eyex, <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> eyey, <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> eyez,
<a name="l00012"></a>00012                            <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> centerx, <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> centery, <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> centerz,
<a name="l00013"></a>00013                            <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> upx, <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> upy, <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> upz)
<a name="l00014"></a>00014 
<a name="l00015"></a>00015 {
<a name="l00016"></a>00016         <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> <a class="code" href="Renderer_2GL_2glext_8h.html#af593500c283bf1a787a6f947f503a5c2">m</a>[16];
<a name="l00017"></a>00017         <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> <a class="code" href="flash_2GLES_2glext_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>[3], <a class="code" href="flash_2GLES_2glext_8h.html#a2532a9f8ed3a10a63f5e3c484fbfdb9b">y</a>[3], <a class="code" href="flash_2GLES_2glext_8h.html#afbd8e4152e83f10b9242ae1e7a71cb0b">z</a>[3];
<a name="l00018"></a>00018         <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> mag;
<a name="l00019"></a>00019 
<a name="l00020"></a>00020         <span class="comment">/* Make rotation matrix */</span>
<a name="l00021"></a>00021         <span class="comment">/* Z vector */</span>
<a name="l00022"></a>00022         z[0] = eyex - centerx;
<a name="l00023"></a>00023         z[1] = eyey - centery;
<a name="l00024"></a>00024         z[2] = eyez - centerz;
<a name="l00025"></a>00025 
<a name="l00026"></a>00026         mag = sqrt(z[0] * z[0] + z[1] * z[1] + z[2] * z[2]);
<a name="l00027"></a>00027 
<a name="l00028"></a>00028         <span class="keywordflow">if</span> (mag)
<a name="l00029"></a>00029         {                   <span class="comment">/* mpichler, 19950515 */</span>
<a name="l00030"></a>00030                 z[0] /= mag;
<a name="l00031"></a>00031                 z[1] /= mag;
<a name="l00032"></a>00032                 z[2] /= mag;
<a name="l00033"></a>00033         }
<a name="l00034"></a>00034 
<a name="l00035"></a>00035         <span class="comment">/* Y vector */</span>
<a name="l00036"></a>00036         y[0] = upx;
<a name="l00037"></a>00037         y[1] = upy;
<a name="l00038"></a>00038         y[2] = upz;
<a name="l00039"></a>00039 
<a name="l00040"></a>00040         <span class="comment">/* X vector = Y cross Z */</span>
<a name="l00041"></a>00041         x[0] = y[1] * z[2] - y[2] * z[1];
<a name="l00042"></a>00042         x[1] = -y[0] * z[2] + y[2] * z[0];
<a name="l00043"></a>00043         x[2] = y[0] * z[1] - y[1] * z[0];
<a name="l00044"></a>00044 
<a name="l00045"></a>00045         <span class="comment">/* Recompute Y = Z cross X */</span>
<a name="l00046"></a>00046         y[0] = z[1] * x[2] - z[2] * x[1];
<a name="l00047"></a>00047         y[1] = -z[0] * x[2] + z[2] * x[0];
<a name="l00048"></a>00048         y[2] = z[0] * x[1] - z[1] * x[0];
<a name="l00049"></a>00049 
<a name="l00050"></a>00050         <span class="comment">/* mpichler, 19950515 */</span>
<a name="l00051"></a>00051         <span class="comment">/* cross product gives area of parallelogram, which is &lt; 1.0 for</span>
<a name="l00052"></a>00052 <span class="comment">        * non-perpendicular unit-length vectors; so normalize x, y here</span>
<a name="l00053"></a>00053 <span class="comment">        */</span>
<a name="l00054"></a>00054 
<a name="l00055"></a>00055         mag = sqrt(x[0] * x[0] + x[1] * x[1] + x[2] * x[2]);
<a name="l00056"></a>00056 
<a name="l00057"></a>00057         <span class="keywordflow">if</span> (mag) {
<a name="l00058"></a>00058                 x[0] /= mag;
<a name="l00059"></a>00059                 x[1] /= mag;
<a name="l00060"></a>00060                 x[2] /= mag;
<a name="l00061"></a>00061         }
<a name="l00062"></a>00062 
<a name="l00063"></a>00063         mag = sqrt(y[0] * y[0] + y[1] * y[1] + y[2] * y[2]);
<a name="l00064"></a>00064 
<a name="l00065"></a>00065         <span class="keywordflow">if</span> (mag) 
<a name="l00066"></a>00066         {
<a name="l00067"></a>00067                 y[0] /= mag;
<a name="l00068"></a>00068                 y[1] /= mag;
<a name="l00069"></a>00069                 y[2] /= mag;
<a name="l00070"></a>00070         }
<a name="l00071"></a>00071 
<a name="l00072"></a>00072 <span class="preprocessor">#define M(row,col)  m[col*4+row]</span>
<a name="l00073"></a>00073 <span class="preprocessor"></span>
<a name="l00074"></a>00074         M(0, 0) = x[0];
<a name="l00075"></a>00075         M(0, 1) = x[1];
<a name="l00076"></a>00076         M(0, 2) = x[2];
<a name="l00077"></a>00077         M(0, 3) = 0.0;
<a name="l00078"></a>00078         M(1, 0) = y[0];
<a name="l00079"></a>00079         M(1, 1) = y[1];
<a name="l00080"></a>00080         M(1, 2) = y[2];
<a name="l00081"></a>00081         M(1, 3) = 0.0;
<a name="l00082"></a>00082         M(2, 0) = z[0];
<a name="l00083"></a>00083         M(2, 1) = z[1];
<a name="l00084"></a>00084         M(2, 2) = z[2];
<a name="l00085"></a>00085         M(2, 3) = 0.0;
<a name="l00086"></a>00086         M(3, 0) = 0.0;
<a name="l00087"></a>00087         M(3, 1) = 0.0;
<a name="l00088"></a>00088         M(3, 2) = 0.0;
<a name="l00089"></a>00089         M(3, 3) = 1.0;
<a name="l00090"></a>00090 
<a name="l00091"></a>00091 <span class="preprocessor">#undef M</span>
<a name="l00092"></a>00092 <span class="preprocessor"></span>
<a name="l00093"></a>00093         <a class="code" href="GLFlashAdaptor_8cpp.html#aaed23aea9b620338f4b728f5303f497c">glMultMatrixf</a>(m);
<a name="l00094"></a>00094         <span class="comment">/* Translate Eye to Origin */</span>
<a name="l00095"></a>00095         <a class="code" href="GLFlashAdaptor_8cpp.html#ae9636873ef091fbb322604d8b97b4e4e">glTranslatef</a>(-eyex, -eyey, -eyez);
<a name="l00096"></a>00096 }
<a name="l00097"></a><a class="code" href="GLESUtils_8cpp.html#a3a7e7d2023a589f67be6fe4b3c341c3c">00097</a> <span class="keywordtype">float</span> <a class="code" href="GLESUtils_8cpp.html#a3a7e7d2023a589f67be6fe4b3c341c3c">g_extraScreenRotation</a> = 0;
<a name="l00098"></a><a class="code" href="GLESUtils_8h.html#a55e8c295a8f92340f5e0e97e6665aa95">00098</a> <span class="keywordtype">void</span> <a class="code" href="GLESUtils_8cpp.html#a55e8c295a8f92340f5e0e97e6665aa95">SetExtraScreenRotationDegrees</a>(<span class="keywordtype">float</span> degrees)
<a name="l00099"></a>00099 {
<a name="l00100"></a>00100         <a class="code" href="GLESUtils_8cpp.html#a3a7e7d2023a589f67be6fe4b3c341c3c">g_extraScreenRotation</a> = degrees;
<a name="l00101"></a>00101 }
<a name="l00102"></a>00102 
<a name="l00103"></a>00103 
<a name="l00104"></a><a class="code" href="GLESUtils_8h.html#a7157cf537a76b460d9b1c190cc129d78">00104</a> <span class="keywordtype">float</span> <a class="code" href="GLESUtils_8cpp.html#a7157cf537a76b460d9b1c190cc129d78">OrientationToDegrees</a>(<span class="keywordtype">int</span> orientation)
<a name="l00105"></a>00105 {
<a name="l00106"></a>00106         <span class="keywordflow">switch</span> (<a class="code" href="RenderUtils_8cpp.html#a23d7ec03c9dd69ce0af19858d1c4ff79">GetOrientation</a>())
<a name="l00107"></a>00107         {
<a name="l00108"></a>00108         <span class="keywordflow">case</span> <a class="code" href="PlatformEnums_8h.html#a02ed901e93e9d5ffb22fc6a2f0284f3dac86fcbdd8a443ba2731a871a5daf31bc">ORIENTATION_DONT_CARE</a>:
<a name="l00109"></a>00109             <span class="keywordflow">return</span> 0;
<a name="l00110"></a>00110             
<a name="l00111"></a>00111         <span class="keywordflow">case</span> <a class="code" href="PlatformEnums_8h.html#a02ed901e93e9d5ffb22fc6a2f0284f3dacd00a965397a558275015a84f2f22dd5">ORIENTATION_PORTRAIT</a>:
<a name="l00112"></a>00112                 <span class="keywordflow">return</span> 0;
<a name="l00113"></a>00113                 <span class="keywordflow">break</span>;
<a name="l00114"></a>00114         <span class="keywordflow">case</span> <a class="code" href="PlatformEnums_8h.html#a02ed901e93e9d5ffb22fc6a2f0284f3dae06d63ec66f90a060ad29dc2987f991f">ORIENTATION_PORTRAIT_UPSIDE_DOWN</a>:
<a name="l00115"></a>00115                 <span class="keywordflow">return</span> 180;
<a name="l00116"></a>00116 
<a name="l00117"></a>00117         <span class="keywordflow">case</span> <a class="code" href="PlatformEnums_8h.html#a02ed901e93e9d5ffb22fc6a2f0284f3dad7139ae64e316779a0190d875de24a5e">ORIENTATION_LANDSCAPE_RIGHT</a>:
<a name="l00118"></a>00118                 <span class="keywordflow">return</span> 90;
<a name="l00119"></a>00119 
<a name="l00120"></a>00120         <span class="keywordflow">case</span> <a class="code" href="PlatformEnums_8h.html#a02ed901e93e9d5ffb22fc6a2f0284f3daaf02c443f5209ec2e93a624b17d8ff62">ORIENTATION_LANDSCAPE_LEFT</a>:
<a name="l00121"></a>00121                 <span class="keywordflow">return</span> -90;
<a name="l00122"></a>00122                 <span class="keywordflow">break</span>;
<a name="l00123"></a>00123         }
<a name="l00124"></a>00124 
<a name="l00125"></a>00125         assert(0);
<a name="l00126"></a>00126         <span class="keywordflow">return</span> 0;
<a name="l00127"></a>00127 }
<a name="l00128"></a><a class="code" href="GLESUtils_8h.html#aaef93f36ac2fdf1b7344d46d998d7299">00128</a> <span class="keywordtype">void</span> <a class="code" href="GLESUtils_8cpp.html#aaef93f36ac2fdf1b7344d46d998d7299">RotateGLIfNeeded</a>()
<a name="l00129"></a>00129 {
<a name="l00130"></a>00130         <span class="keywordflow">if</span> (<a class="code" href="BaseApp_8h.html#a72086b48d24daf0a65dd20189a16bd16">GetBaseApp</a>()-&gt;GetManualRotationMode())
<a name="l00131"></a>00131         {
<a name="l00132"></a>00132                 <span class="keywordtype">float</span> degrees = <a class="code" href="GLESUtils_8cpp.html#a7157cf537a76b460d9b1c190cc129d78">OrientationToDegrees</a>(<a class="code" href="RenderUtils_8cpp.html#a23d7ec03c9dd69ce0af19858d1c4ff79">GetOrientation</a>());
<a name="l00133"></a>00133                 <a class="code" href="GLFlashAdaptor_8cpp.html#a47507478dc599b4b4fd9619a7a6aec45">glRotatef</a>(degrees, 0.0<a class="code" href="Renderer_2GL_2glext_8h.html#aba8ad56949f59242bc167b073dae3715">f</a>, 0.0<a class="code" href="Renderer_2GL_2glext_8h.html#aba8ad56949f59242bc167b073dae3715">f</a>, 1.0<a class="code" href="Renderer_2GL_2glext_8h.html#aba8ad56949f59242bc167b073dae3715">f</a>);
<a name="l00134"></a>00134 
<a name="l00135"></a>00135                 
<a name="l00136"></a>00136         }
<a name="l00137"></a>00137     
<a name="l00138"></a>00138     <span class="keywordflow">if</span> (<a class="code" href="GLESUtils_8cpp.html#a3a7e7d2023a589f67be6fe4b3c341c3c">g_extraScreenRotation</a> != 0)
<a name="l00139"></a>00139     {
<a name="l00140"></a>00140         <a class="code" href="GLFlashAdaptor_8cpp.html#a47507478dc599b4b4fd9619a7a6aec45">glRotatef</a>(-<a class="code" href="GLESUtils_8cpp.html#a3a7e7d2023a589f67be6fe4b3c341c3c">g_extraScreenRotation</a>, 0,0,1);
<a name="l00141"></a>00141     }
<a name="l00142"></a>00142 
<a name="l00143"></a>00143 }
<a name="l00144"></a>00144 
<a name="l00145"></a><a class="code" href="GLESUtils_8cpp.html#adf4ab3ce0ed0ea61ec72f2f1c273b1b8">00145</a> <span class="keywordtype">void</span> <a class="code" href="GLESUtils_8cpp.html#aaef93f36ac2fdf1b7344d46d998d7299">RotateGLIfNeeded</a>(CL_Mat4f &amp;mat)
<a name="l00146"></a>00146 {
<a name="l00147"></a>00147 
<a name="l00148"></a>00148         <span class="keywordflow">if</span> (<a class="code" href="BaseApp_8h.html#a72086b48d24daf0a65dd20189a16bd16">GetBaseApp</a>()-&gt;GetManualRotationMode())
<a name="l00149"></a>00149         {
<a name="l00150"></a>00150                 <span class="keywordtype">float</span> degrees = <a class="code" href="GLESUtils_8cpp.html#a7157cf537a76b460d9b1c190cc129d78">OrientationToDegrees</a>(<a class="code" href="RenderUtils_8cpp.html#a23d7ec03c9dd69ce0af19858d1c4ff79">GetOrientation</a>());
<a name="l00151"></a>00151                 mat = mat.rotate(CL_Angle(degrees, cl_degrees), 0,0,1.0<a class="code" href="Renderer_2GL_2glext_8h.html#aba8ad56949f59242bc167b073dae3715">f</a>);
<a name="l00152"></a>00152         }
<a name="l00153"></a>00153     
<a name="l00154"></a>00154     <span class="keywordflow">if</span> (<a class="code" href="GLESUtils_8cpp.html#a3a7e7d2023a589f67be6fe4b3c341c3c">g_extraScreenRotation</a> != 0)
<a name="l00155"></a>00155     {
<a name="l00156"></a>00156         mat = mat.rotate(CL_Angle(-<a class="code" href="GLESUtils_8cpp.html#a3a7e7d2023a589f67be6fe4b3c341c3c">g_extraScreenRotation</a>, cl_degrees), 0,0,1.0<a class="code" href="Renderer_2GL_2glext_8h.html#aba8ad56949f59242bc167b073dae3715">f</a>);
<a name="l00157"></a>00157         }
<a name="l00158"></a>00158 
<a name="l00159"></a>00159 }
<a name="l00160"></a>00160 
<a name="l00161"></a><a class="code" href="GLESUtils_8h.html#af1322cd897b08260c2df6da68fb44f6d">00161</a> <span class="keywordtype">void</span> <a class="code" href="GLESUtils_8cpp.html#af1322cd897b08260c2df6da68fb44f6d">GenerateSetPerspectiveFOV</a>(<span class="keywordtype">float</span> fovy, <span class="keywordtype">float</span> aspect, <span class="keywordtype">float</span> <a class="code" href="flash_2GLES_2glext_8h.html#aca1cd7f8a604971b0adc0d98f76ffb9d">zNear</a>, <span class="keywordtype">float</span> <a class="code" href="flash_2GLES_2glext_8h.html#a2195596e209aab1745c93e7d8cd1ab67">zFar</a>)
<a name="l00162"></a>00162 {
<a name="l00163"></a>00163         <a class="code" href="GLESUtils_8cpp.html#ac6c3f6a87dbfa09bbcc20c6c4dbe7c20">PrepareForGL</a>();
<a name="l00164"></a>00164 
<a name="l00165"></a>00165         <a class="code" href="GLFlashAdaptor_8cpp.html#a28695f13b359fbbc9e8a5d57662305eb">glMatrixMode</a>(GL_PROJECTION);
<a name="l00166"></a>00166         
<a name="l00167"></a>00167         <span class="comment">//we use Clanlib to setup our matrix manually because if we do it in HW we can&#39;t always extract it again as android gl doesn&#39;t support that</span>
<a name="l00168"></a>00168         <a class="code" href="GLFlashAdaptor_8cpp.html#a77d245cb8a1701a1dedc8c1d5796a836">glLoadIdentity</a>();
<a name="l00169"></a>00169         CL_Mat4f mat = CL_Mat4f::identity();
<a name="l00170"></a>00170 
<a name="l00171"></a>00171         <a class="code" href="GLESUtils_8cpp.html#aaef93f36ac2fdf1b7344d46d998d7299">RotateGLIfNeeded</a>(mat);
<a name="l00172"></a>00172         
<a name="l00173"></a>00173         <span class="keywordtype">float</span> xmin, xmax, ymin, ymax;
<a name="l00174"></a>00174 
<a name="l00175"></a>00175         ymax = zNear * float(tan(fovy * M_PI / 360.0<a class="code" href="Renderer_2GL_2glext_8h.html#aba8ad56949f59242bc167b073dae3715">f</a>));
<a name="l00176"></a>00176         ymin = -ymax;
<a name="l00177"></a>00177         xmin = ymin * aspect;
<a name="l00178"></a>00178         xmax = ymax * aspect;
<a name="l00179"></a>00179 
<a name="l00180"></a>00180         mat.multiply( CL_Mat4f::frustum(xmin, xmax, ymin, ymax, zNear, zFar));
<a name="l00181"></a>00181         *<a class="code" href="BaseApp_8h.html#a72086b48d24daf0a65dd20189a16bd16">GetBaseApp</a>()-&gt;<a class="code" href="classBaseApp.html#a4b42d197e4bedda46a3230dc4e1a4a98">GetProjectionMatrix</a>() = mat;
<a name="l00182"></a>00182         <span class="comment">//glFrustumf(xmin, xmax, ymin, ymax, zNear, zFar);</span>
<a name="l00183"></a>00183         <a class="code" href="GLFlashAdaptor_8cpp.html#a58a1b8941f33abde21123c2d83f74d74">glLoadMatrixf</a>((<a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a>*)mat);
<a name="l00184"></a>00184 
<a name="l00185"></a>00185         <a class="code" href="GLFlashAdaptor_8cpp.html#a28695f13b359fbbc9e8a5d57662305eb">glMatrixMode</a>(GL_MODELVIEW);
<a name="l00186"></a>00186 }
<a name="l00187"></a>00187 
<a name="l00188"></a>00188 
<a name="l00189"></a><a class="code" href="GLESUtils_8h.html#a31648851dd8a6010dedc018c38af43b1">00189</a> <span class="keywordtype">void</span> <a class="code" href="GLESUtils_8cpp.html#a7e7b4fa9cc2a41943b617af10ccd4a1d">DrawFilledSquare</a>( <span class="keywordtype">float</span> <a class="code" href="flash_2GLES_2glext_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>, <span class="keywordtype">float</span> <a class="code" href="flash_2GLES_2glext_8h.html#a2532a9f8ed3a10a63f5e3c484fbfdb9b">y</a>, <span class="keywordtype">float</span> <a class="code" href="flash_2GLES_2glext_8h.html#a3d1e3edfcf61ca2d831883e1afbad89e">size</a><span class="comment">/*=10*/</span>, <a class="code" href="PlatformSetupAndroid_8h.html#acbd4acd0d29e2d6c43104827f77d9cd2">uint32</a> <a class="code" href="Renderer_2GL_2glext_8h.html#a3ea846f998d64f079b86052b6c4193a8">color</a> <span class="comment">/*= MAKE_RGBA(255,255,255,255)*/</span>, <span class="keywordtype">bool</span> bCentered )
<a name="l00190"></a>00190 {
<a name="l00191"></a>00191         <span class="keywordflow">if</span> (bCentered)
<a name="l00192"></a>00192         {
<a name="l00193"></a>00193                 x -= size/2;
<a name="l00194"></a>00194                 y -= size/2;
<a name="l00195"></a>00195         }
<a name="l00196"></a>00196         <a class="code" href="GLESUtils_8cpp.html#a0c05467fb497e6cea00bc882f6c3a201">GenerateFillRect</a>(color, x,y, size, size);
<a name="l00197"></a>00197 }
<a name="l00198"></a>00198 
<a name="l00199"></a><a class="code" href="GLESUtils_8h.html#a5d08d616ba56f053d6dbcd5f60ddd25c">00199</a> <span class="keywordtype">void</span> <a class="code" href="GLESUtils_8cpp.html#a5d08d616ba56f053d6dbcd5f60ddd25c">DrawFilledRect</a>(<span class="keyword">const</span> CL_Rectf &amp;<a class="code" href="flash_2GLES_2glext_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, <a class="code" href="PlatformSetupAndroid_8h.html#acbd4acd0d29e2d6c43104827f77d9cd2">uint32</a> <a class="code" href="Renderer_2GL_2glext_8h.html#a3ea846f998d64f079b86052b6c4193a8">color</a>)
<a name="l00200"></a>00200 {
<a name="l00201"></a>00201         <a class="code" href="GLESUtils_8cpp.html#a0c05467fb497e6cea00bc882f6c3a201">GenerateFillRect</a>(color, r.left, r.top, r.get_width(), r.get_height());
<a name="l00202"></a>00202 }
<a name="l00203"></a>00203 
<a name="l00204"></a><a class="code" href="GLESUtils_8h.html#a6fc2aac18ca535cd21513016d4c8d893">00204</a> <span class="keywordtype">void</span> <a class="code" href="GLESUtils_8cpp.html#a5d08d616ba56f053d6dbcd5f60ddd25c">DrawFilledRect</a>(<a class="code" href="structrtRectf.html">rtRectf</a> &amp;<a class="code" href="flash_2GLES_2glext_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, <a class="code" href="PlatformSetupAndroid_8h.html#acbd4acd0d29e2d6c43104827f77d9cd2">uint32</a> <a class="code" href="Renderer_2GL_2glext_8h.html#a3ea846f998d64f079b86052b6c4193a8">color</a>)
<a name="l00205"></a>00205 {
<a name="l00206"></a>00206         <a class="code" href="GLESUtils_8cpp.html#a0c05467fb497e6cea00bc882f6c3a201">GenerateFillRect</a>(color, r.<a class="code" href="structrtRectf.html#a567b9e4d9febb9bf7f338f416e94a688">left</a>, r.<a class="code" href="structrtRectf.html#a9b3d0f8a066c23d58f29bf61d165f97a">top</a>, r.<a class="code" href="structrtRectf.html#a0410aa65b3d292f46ca5b5df02a3087e">GetWidth</a>(), r.<a class="code" href="structrtRectf.html#af5b496cf9927a066da3749ebb0c203b9">GetHeight</a>());
<a name="l00207"></a>00207 }
<a name="l00208"></a>00208 
<a name="l00209"></a><a class="code" href="GLESUtils_8h.html#a3d15d3aa88d2a45602d4a968fbeb15f8">00209</a> <span class="keywordtype">void</span> <a class="code" href="GLESUtils_8cpp.html#a5d08d616ba56f053d6dbcd5f60ddd25c">DrawFilledRect</a>(<a class="code" href="structrtRect.html">rtRect</a> &amp;<a class="code" href="flash_2GLES_2glext_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, <a class="code" href="PlatformSetupAndroid_8h.html#acbd4acd0d29e2d6c43104827f77d9cd2">uint32</a> <a class="code" href="Renderer_2GL_2glext_8h.html#a3ea846f998d64f079b86052b6c4193a8">color</a>)
<a name="l00210"></a>00210 {
<a name="l00211"></a>00211         <a class="code" href="GLESUtils_8cpp.html#a0c05467fb497e6cea00bc882f6c3a201">GenerateFillRect</a>(color, (<span class="keywordtype">float</span>)r.<a class="code" href="structrtRect.html#a7029bbd808da55ddcfbcaf4843c4cf93">left</a>, (<span class="keywordtype">float</span>)r.<a class="code" href="structrtRect.html#a0b0ff87ec53461beae29aeb4d42b9eb9">top</a>, (<span class="keywordtype">float</span>)r.<a class="code" href="structrtRect.html#a49dc0dd63ad0550be72db1b27bdfcd55">GetWidth</a>(), (float)r.<a class="code" href="structrtRect.html#a08e5d1a005020fd08aa6bcb40f01e04a">GetHeight</a>());
<a name="l00212"></a>00212 }
<a name="l00213"></a>00213 
<a name="l00214"></a><a class="code" href="GLESUtils_8h.html#a92efef92f52b904e5c82c3d956680d90">00214</a> <span class="keywordtype">void</span> <a class="code" href="GLESUtils_8cpp.html#a5d08d616ba56f053d6dbcd5f60ddd25c">DrawFilledRect</a>(<span class="keywordtype">float</span> <a class="code" href="flash_2GLES_2glext_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>, <span class="keywordtype">float</span> <a class="code" href="flash_2GLES_2glext_8h.html#a2532a9f8ed3a10a63f5e3c484fbfdb9b">y</a>, <span class="keywordtype">float</span> sizeX, <span class="keywordtype">float</span> sizeY, <a class="code" href="PlatformSetupAndroid_8h.html#acbd4acd0d29e2d6c43104827f77d9cd2">uint32</a> <a class="code" href="Renderer_2GL_2glext_8h.html#a3ea846f998d64f079b86052b6c4193a8">color</a>)
<a name="l00215"></a>00215 {
<a name="l00216"></a>00216         <a class="code" href="GLESUtils_8cpp.html#a0c05467fb497e6cea00bc882f6c3a201">GenerateFillRect</a>(color, x, y, sizeX, sizeY);
<a name="l00217"></a>00217 }
<a name="l00218"></a>00218 
<a name="l00219"></a><a class="code" href="GLESUtils_8h.html#ae735434a63239236abcf2adcd97354d7">00219</a> <span class="keywordtype">void</span> <a class="code" href="GLESUtils_8cpp.html#a5d08d616ba56f053d6dbcd5f60ddd25c">DrawFilledRect</a>(CL_Vec2f vPos, CL_Vec2f vSize, <a class="code" href="PlatformSetupAndroid_8h.html#acbd4acd0d29e2d6c43104827f77d9cd2">uint32</a> <a class="code" href="Renderer_2GL_2glext_8h.html#a3ea846f998d64f079b86052b6c4193a8">color</a>)
<a name="l00220"></a>00220 {
<a name="l00221"></a>00221         <a class="code" href="GLESUtils_8cpp.html#a0c05467fb497e6cea00bc882f6c3a201">GenerateFillRect</a>(color, vPos.x, vPos.y, vSize.x, vSize.y);
<a name="l00222"></a>00222 }
<a name="l00223"></a>00223 
<a name="l00224"></a><a class="code" href="GLESUtils_8h.html#a3ff7c7c345dfddb46b2273a9a3fd18f7">00224</a> <span class="keywordtype">void</span> <a class="code" href="GLESUtils_8cpp.html#a6ac3f63b00b7c06f823a5d23a6d63053">DrawRect</a>(<span class="keyword">const</span> CL_Rectf &amp;<a class="code" href="flash_2GLES_2glext_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, <a class="code" href="PlatformSetupAndroid_8h.html#acbd4acd0d29e2d6c43104827f77d9cd2">uint32</a> <a class="code" href="Renderer_2GL_2glext_8h.html#a3ea846f998d64f079b86052b6c4193a8">color</a>, <span class="keywordtype">float</span> lineWidth)
<a name="l00225"></a>00225 {
<a name="l00226"></a>00226         <a class="code" href="GLESUtils_8cpp.html#a6ac3f63b00b7c06f823a5d23a6d63053">DrawRect</a>(r.left, r.top, r.get_width(), r.get_height(), <a class="code" href="Renderer_2GL_2glext_8h.html#a3ea846f998d64f079b86052b6c4193a8">color</a>, lineWidth);
<a name="l00227"></a>00227 }
<a name="l00228"></a>00228 
<a name="l00229"></a><a class="code" href="GLESUtils_8h.html#a2563c5e4a6acfe4f10d016845f8b1962">00229</a> <span class="keywordtype">void</span> <a class="code" href="GLESUtils_8cpp.html#aaf572eadd620b54bd2eb31e0d7e965cc">DrawFilledBitmapRect</a>(<a class="code" href="structrtRect.html">rtRect</a> &amp;<a class="code" href="flash_2GLES_2glext_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, <a class="code" href="PlatformSetupAndroid_8h.html#acbd4acd0d29e2d6c43104827f77d9cd2">uint32</a> middleColor,  <a class="code" href="PlatformSetupAndroid_8h.html#acbd4acd0d29e2d6c43104827f77d9cd2">uint32</a> borderColor, <a class="code" href="classSurfaceAnim.html">SurfaceAnim</a> *pSurf, <span class="keywordtype">bool</span> bFillMiddleCloserToEdges)
<a name="l00230"></a>00230 {
<a name="l00231"></a>00231         <a class="code" href="GLESUtils_8cpp.html#aaf572eadd620b54bd2eb31e0d7e965cc">DrawFilledBitmapRect</a>( CL_Rectf((<span class="keywordtype">float</span>)r.<a class="code" href="structrtRect.html#a7029bbd808da55ddcfbcaf4843c4cf93">left</a>,(<span class="keywordtype">float</span>) r.<a class="code" href="structrtRect.html#a0b0ff87ec53461beae29aeb4d42b9eb9">top</a>,(<span class="keywordtype">float</span>) r.<a class="code" href="structrtRect.html#abc8c2d005731e0cd03f7e15fdd76a581">right</a>, (<span class="keywordtype">float</span>)r.<a class="code" href="structrtRect.html#a20158de322bbef633da845447df5c994">bottom</a>), middleColor, borderColor, pSurf, bFillMiddleCloserToEdges);
<a name="l00232"></a>00232 }
<a name="l00233"></a>00233 
<a name="l00234"></a><a class="code" href="GLESUtils_8h.html#a03923d721302d291edd70fa5c51bed9a">00234</a> <span class="keywordtype">void</span> <a class="code" href="GLESUtils_8cpp.html#aaf572eadd620b54bd2eb31e0d7e965cc">DrawFilledBitmapRect</a>(<span class="keyword">const</span> CL_Rectf &amp;<a class="code" href="flash_2GLES_2glext_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, <a class="code" href="PlatformSetupAndroid_8h.html#acbd4acd0d29e2d6c43104827f77d9cd2">uint32</a> middleColor, <a class="code" href="PlatformSetupAndroid_8h.html#acbd4acd0d29e2d6c43104827f77d9cd2">uint32</a> borderColor, <a class="code" href="classSurfaceAnim.html">SurfaceAnim</a> *pSurf, <span class="keywordtype">bool</span> bFillMiddleCloserToEdges )
<a name="l00235"></a>00235 {
<a name="l00236"></a>00236         <span class="comment">//assert(r.get_width()&gt;=C_MINIMUM_BMP_RECT_SIZE &amp;&amp; &quot;GUIBox rect too small to work!&quot;);</span>
<a name="l00237"></a>00237         <span class="comment">//assert(r.get_height()&gt;=C_MINIMUM_BMP_RECT_SIZE &amp;&amp; &quot;GUIBox rect too small to work!&quot;);</span>
<a name="l00238"></a>00238         assert(pSurf-&gt;<a class="code" href="classSurfaceAnim.html#acbf12c264f9e68bf033cf403f725043e">GetFramesX</a>() &gt;= 3 &amp;&amp; pSurf-&gt;<a class="code" href="classSurfaceAnim.html#ab038d3f6a648af6fa5a517a852aa804f">GetFramesY</a>() &gt;= 3 &amp;&amp; <span class="stringliteral">&quot;The surf needs to be setup as a 3x3 (or larger) first&quot;</span>);
<a name="l00239"></a>00239         <span class="comment">// draw corners</span>
<a name="l00240"></a>00240         pSurf-&gt;<a class="code" href="classSurfaceAnim.html#a872de67e257a34226fb280de24939da0">BlitAnim</a>(r.left,r.top,0,0, borderColor);
<a name="l00241"></a>00241         pSurf-&gt;<a class="code" href="classSurfaceAnim.html#a872de67e257a34226fb280de24939da0">BlitAnim</a>(r.right-10,r.top,2,0, borderColor);
<a name="l00242"></a>00242         pSurf-&gt;<a class="code" href="classSurfaceAnim.html#a872de67e257a34226fb280de24939da0">BlitAnim</a>(r.left,r.bottom-10,0,2, borderColor);
<a name="l00243"></a>00243         pSurf-&gt;<a class="code" href="classSurfaceAnim.html#a872de67e257a34226fb280de24939da0">BlitAnim</a>(r.right-10,r.bottom-10,2,2, borderColor);
<a name="l00244"></a>00244         CL_Vec2f <a class="code" href="Renderer_2GL_2glext_8h.html#a281421b881aa7a1266842b73a3bc7655">scale</a>;
<a name="l00245"></a>00245         <span class="comment">// draw top and bottom</span>
<a name="l00246"></a>00246         scale.x=(r.get_width()-20)/10;
<a name="l00247"></a>00247         scale.y=1;
<a name="l00248"></a>00248         pSurf-&gt;<a class="code" href="classSurfaceAnim.html#a1aeee63ff7d7e1961385fa2d0cf52aec">BlitScaledAnim</a>(r.left+10,r.top,1,0,scale,<a class="code" href="rtRect_8h.html#a74e9e3c1ad777682769717e601d606a7a8bd2310d77f502af915d2e80834e5788">ALIGNMENT_UPPER_LEFT</a>, borderColor);
<a name="l00249"></a>00249         pSurf-&gt;<a class="code" href="classSurfaceAnim.html#a1aeee63ff7d7e1961385fa2d0cf52aec">BlitScaledAnim</a>(r.left+10,r.bottom-10,1,2,scale,<a class="code" href="rtRect_8h.html#a74e9e3c1ad777682769717e601d606a7a8bd2310d77f502af915d2e80834e5788">ALIGNMENT_UPPER_LEFT</a>, borderColor);
<a name="l00250"></a>00250 
<a name="l00251"></a>00251         <span class="comment">// draw sides</span>
<a name="l00252"></a>00252         scale.x=1;
<a name="l00253"></a>00253         scale.y=(r.get_height()-20)/10;
<a name="l00254"></a>00254         pSurf-&gt;<a class="code" href="classSurfaceAnim.html#a1aeee63ff7d7e1961385fa2d0cf52aec">BlitScaledAnim</a>(r.left,r.top+10,0,1,scale,<a class="code" href="rtRect_8h.html#a74e9e3c1ad777682769717e601d606a7a8bd2310d77f502af915d2e80834e5788">ALIGNMENT_UPPER_LEFT</a>, borderColor);
<a name="l00255"></a>00255         pSurf-&gt;<a class="code" href="classSurfaceAnim.html#a1aeee63ff7d7e1961385fa2d0cf52aec">BlitScaledAnim</a>(r.right-10,r.top+10,2,1,scale,<a class="code" href="rtRect_8h.html#a74e9e3c1ad777682769717e601d606a7a8bd2310d77f502af915d2e80834e5788">ALIGNMENT_UPPER_LEFT</a>, borderColor);
<a name="l00256"></a>00256 
<a name="l00257"></a>00257         <span class="comment">// fill middle</span>
<a name="l00258"></a>00258         <span class="keywordflow">if</span> (bFillMiddleCloserToEdges)
<a name="l00259"></a>00259         {
<a name="l00260"></a>00260                 <a class="code" href="GLESUtils_8cpp.html#a5d08d616ba56f053d6dbcd5f60ddd25c">DrawFilledRect</a>(r.left+7,r.top+8,r.get_width()-15,r.get_height()-16,middleColor);
<a name="l00261"></a>00261         } <span class="keywordflow">else</span>
<a name="l00262"></a>00262         {
<a name="l00263"></a>00263                 <a class="code" href="GLESUtils_8cpp.html#a5d08d616ba56f053d6dbcd5f60ddd25c">DrawFilledRect</a>(r.left+10,r.top+10,r.get_width()-20,r.get_height()-20,middleColor);
<a name="l00264"></a>00264         }
<a name="l00265"></a>00265 }
<a name="l00266"></a>00266 
<a name="l00267"></a><a class="code" href="GLESUtils_8h.html#aed4a28e732acdc34e055301ac56ec90d">00267</a> <span class="keywordtype">void</span> <a class="code" href="GLESUtils_8cpp.html#a6ac3f63b00b7c06f823a5d23a6d63053">DrawRect</a>(<span class="keyword">const</span> <a class="code" href="structrtRect.html">rtRect</a> &amp;<a class="code" href="flash_2GLES_2glext_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, <a class="code" href="PlatformSetupAndroid_8h.html#acbd4acd0d29e2d6c43104827f77d9cd2">uint32</a> <a class="code" href="Renderer_2GL_2glext_8h.html#a3ea846f998d64f079b86052b6c4193a8">color</a>, <span class="keywordtype">float</span> lineWidth)
<a name="l00268"></a>00268 {
<a name="l00269"></a>00269         <a class="code" href="GLESUtils_8cpp.html#a6ac3f63b00b7c06f823a5d23a6d63053">DrawRect</a>((<span class="keywordtype">float</span>)r.<a class="code" href="structrtRect.html#a7029bbd808da55ddcfbcaf4843c4cf93">left</a>, (<span class="keywordtype">float</span>)r.<a class="code" href="structrtRect.html#a0b0ff87ec53461beae29aeb4d42b9eb9">top</a>, (<span class="keywordtype">float</span>)r.<a class="code" href="structrtRect.html#a49dc0dd63ad0550be72db1b27bdfcd55">GetWidth</a>(), (float)r.<a class="code" href="structrtRect.html#a08e5d1a005020fd08aa6bcb40f01e04a">GetHeight</a>(), <a class="code" href="Renderer_2GL_2glext_8h.html#a3ea846f998d64f079b86052b6c4193a8">color</a>, lineWidth);
<a name="l00270"></a>00270 }
<a name="l00271"></a><a class="code" href="GLESUtils_8h.html#a86986c402dab5375f894ef59635a30c8">00271</a> <span class="keywordtype">void</span> <a class="code" href="GLESUtils_8cpp.html#a6ac3f63b00b7c06f823a5d23a6d63053">DrawRect</a>(<span class="keyword">const</span> <a class="code" href="structrtRectf.html">rtRectf</a> &amp;<a class="code" href="flash_2GLES_2glext_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a>, <a class="code" href="PlatformSetupAndroid_8h.html#acbd4acd0d29e2d6c43104827f77d9cd2">uint32</a> <a class="code" href="Renderer_2GL_2glext_8h.html#a3ea846f998d64f079b86052b6c4193a8">color</a>, <span class="keywordtype">float</span> lineWidth)
<a name="l00272"></a>00272 {
<a name="l00273"></a>00273         <a class="code" href="GLESUtils_8cpp.html#a6ac3f63b00b7c06f823a5d23a6d63053">DrawRect</a>((<span class="keywordtype">float</span>)r.<a class="code" href="structrtRectf.html#a567b9e4d9febb9bf7f338f416e94a688">left</a>, (<span class="keywordtype">float</span>)r.<a class="code" href="structrtRectf.html#a9b3d0f8a066c23d58f29bf61d165f97a">top</a>, (<span class="keywordtype">float</span>)r.<a class="code" href="structrtRectf.html#a0410aa65b3d292f46ca5b5df02a3087e">GetWidth</a>(), (float)r.<a class="code" href="structrtRectf.html#af5b496cf9927a066da3749ebb0c203b9">GetHeight</a>(), <a class="code" href="Renderer_2GL_2glext_8h.html#a3ea846f998d64f079b86052b6c4193a8">color</a>, lineWidth);
<a name="l00274"></a>00274 }
<a name="l00275"></a>00275 
<a name="l00276"></a>00276 
<a name="l00277"></a><a class="code" href="GLESUtils_8h.html#a1f87f395f1e12a4c9d637cf2bedbadd1">00277</a> <span class="keywordtype">void</span> <a class="code" href="GLESUtils_8cpp.html#a6ac3f63b00b7c06f823a5d23a6d63053">DrawRect</a>(<span class="keywordtype">float</span> <a class="code" href="flash_2GLES_2glext_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>, <span class="keywordtype">float</span> <a class="code" href="flash_2GLES_2glext_8h.html#a2532a9f8ed3a10a63f5e3c484fbfdb9b">y</a>, <span class="keywordtype">float</span> <a class="code" href="flash_2GLES_2glext_8h.html#a3ce386e55bbeb900c1b23e064b89bd04">width</a>, <span class="keywordtype">float</span> <a class="code" href="flash_2GLES_2glext_8h.html#aedd0ea77029b98ce91e47c19addcb68f">height</a>, <a class="code" href="PlatformSetupAndroid_8h.html#acbd4acd0d29e2d6c43104827f77d9cd2">uint32</a> <a class="code" href="Renderer_2GL_2glext_8h.html#a3ea846f998d64f079b86052b6c4193a8">color</a>, <span class="keywordtype">float</span> lineWidth)
<a name="l00278"></a>00278 {
<a name="l00279"></a>00279         <span class="comment">//OPTIMIZE:  This could be done as a single GL call instead... or optimize GenerateFillRect to smartly handle render states</span>
<a name="l00280"></a>00280         <a class="code" href="GLESUtils_8cpp.html#a0c05467fb497e6cea00bc882f6c3a201">GenerateFillRect</a>(color, x, y, width, lineWidth); <span class="comment">//top bar</span>
<a name="l00281"></a>00281         <a class="code" href="GLESUtils_8cpp.html#a0c05467fb497e6cea00bc882f6c3a201">GenerateFillRect</a>(color, x, (y+height)-lineWidth, width, lineWidth); <span class="comment">//bottom bar</span>
<a name="l00282"></a>00282         <a class="code" href="GLESUtils_8cpp.html#a0c05467fb497e6cea00bc882f6c3a201">GenerateFillRect</a>(color, x, y+lineWidth, lineWidth, (height-lineWidth*2)); <span class="comment">//left side</span>
<a name="l00283"></a>00283         <a class="code" href="GLESUtils_8cpp.html#a0c05467fb497e6cea00bc882f6c3a201">GenerateFillRect</a>(color, (x+width)-lineWidth, y+lineWidth, lineWidth, (height-lineWidth*2)); <span class="comment">//left side</span>
<a name="l00284"></a>00284 }
<a name="l00285"></a>00285 
<a name="l00286"></a>00286 
<a name="l00287"></a><a class="code" href="GLESUtils_8h.html#af51c0f9247c051751f69d0d4795df763">00287</a> <span class="keywordtype">void</span> <a class="code" href="GLESUtils_8cpp.html#ab4196f589749a060bf7f01226c6974ae">DrawEllipse</a> (<span class="keyword">const</span> <span class="keywordtype">int</span> segments, CL_Vec2f vPos, <span class="keywordtype">float</span> radianWidth, <span class="keywordtype">float</span> radiusHeight, <span class="keywordtype">bool</span> vFilled, <a class="code" href="PlatformSetupAndroid_8h.html#acbd4acd0d29e2d6c43104827f77d9cd2">uint32</a> <a class="code" href="Renderer_2GL_2glext_8h.html#a3ea846f998d64f079b86052b6c4193a8">color</a>)
<a name="l00288"></a>00288 {
<a name="l00289"></a>00289 
<a name="l00290"></a>00290         <a class="code" href="GLESUtils_8cpp.html#aaecd6106d849b5b0fd205753c3ee7c42">SetupOrtho</a>();
<a name="l00291"></a>00291 
<a name="l00292"></a>00292         <a class="code" href="GLFlashAdaptor_8cpp.html#a5b2a1a17e595774a852426a5ed64c023">glPushMatrix</a>();
<a name="l00293"></a>00293         <a class="code" href="GLFlashAdaptor_8cpp.html#ae9636873ef091fbb322604d8b97b4e4e">glTranslatef</a>(vPos.x, vPos.y, 0.0);
<a name="l00294"></a>00294         vector&lt;float&gt; vertices;
<a name="l00295"></a>00295         vertices.resize(segments*2);
<a name="l00296"></a>00296         <a class="code" href="GLFlashAdaptor_8cpp.html#a408bccf3c3cf0419446bf36c64a3adc0">glEnable</a> (GL_LINE_SMOOTH);
<a name="l00297"></a>00297         <span class="keywordtype">int</span> <a class="code" href="flash_2GLES_2glext_8h.html#a4e867eee5910f6b2df6123b47ab70dae">count</a>=0;
<a name="l00298"></a>00298         <span class="keywordflow">for</span> (<a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> i = 0; i &lt; 360.0f; i+=(360.0f/segments))
<a name="l00299"></a>00299         {
<a name="l00300"></a>00300                 vertices[count++] = (float(cos(DEG2RAD(i)))*radianWidth);
<a name="l00301"></a>00301                 vertices[count++] = (float(sin(DEG2RAD(i)))*radiusHeight);
<a name="l00302"></a>00302         }
<a name="l00303"></a>00303         <a class="code" href="GLFlashAdaptor_8cpp.html#aeed45e81d121fa686b8286a2855d655c">glColor4x</a>( (color &gt;&gt;8 &amp; 0xFF)*256,  (color&gt;&gt;16&amp; 0xFF)*256, (color&gt;&gt;24&amp; 0xFF)*256, (color&amp;0xFF)*256);
<a name="l00304"></a>00304         <span class="keywordflow">if</span> (GET_ALPHA(color) != 255)
<a name="l00305"></a>00305         {
<a name="l00306"></a>00306                 <a class="code" href="GLFlashAdaptor_8cpp.html#a408bccf3c3cf0419446bf36c64a3adc0">glEnable</a>(GL_BLEND);
<a name="l00307"></a>00307                 <a class="code" href="GLFlashAdaptor_8cpp.html#a408bccf3c3cf0419446bf36c64a3adc0">glEnable</a>(GL_ALPHA_TEST);
<a name="l00308"></a>00308 
<a name="l00309"></a>00309         }
<a name="l00310"></a>00310         <a class="code" href="GLFlashAdaptor_8cpp.html#a90fb252b1dfce3a2c9a96d605693450b">glDisableClientState</a>(GL_TEXTURE_COORD_ARRAY);   
<a name="l00311"></a>00311         <a class="code" href="GLFlashAdaptor_8cpp.html#a80fb7c3b62fc0b18c40424cf3bc22d13">glDisable</a>(GL_TEXTURE_2D);       
<a name="l00312"></a>00312         <a class="code" href="GLFlashAdaptor_8cpp.html#ae706b283dab261d2212bccd9bf30fc32">glVertexPointer</a> (2, GL_FLOAT , 0, &amp;vertices.at(0)); 
<a name="l00313"></a>00313         <a class="code" href="GLFlashAdaptor_8cpp.html#a0e3de4d267f017c28a03fc4375a4b40e">glDrawArrays</a> ((vFilled) ? GL_TRIANGLE_FAN : GL_LINE_LOOP, 0, segments);
<a name="l00314"></a>00314         
<a name="l00315"></a>00315         <a class="code" href="GLFlashAdaptor_8cpp.html#ad4d5af9621c6fd6339889bdb295e11c8">glEnableClientState</a>(GL_TEXTURE_COORD_ARRAY);    
<a name="l00316"></a>00316         <a class="code" href="GLFlashAdaptor_8cpp.html#a408bccf3c3cf0419446bf36c64a3adc0">glEnable</a>(GL_TEXTURE_2D);        
<a name="l00317"></a>00317         <span class="keywordflow">if</span> (GET_ALPHA(color) != 255)
<a name="l00318"></a>00318         {
<a name="l00319"></a>00319                 <a class="code" href="GLFlashAdaptor_8cpp.html#a80fb7c3b62fc0b18c40424cf3bc22d13">glDisable</a>(GL_BLEND);
<a name="l00320"></a>00320                 <a class="code" href="GLFlashAdaptor_8cpp.html#a80fb7c3b62fc0b18c40424cf3bc22d13">glDisable</a>(GL_ALPHA_TEST);
<a name="l00321"></a>00321 
<a name="l00322"></a>00322         }
<a name="l00323"></a>00323         <a class="code" href="GLFlashAdaptor_8cpp.html#aeed45e81d121fa686b8286a2855d655c">glColor4x</a>(1 &lt;&lt; 16, 1 &lt;&lt; 16, 1 &lt;&lt; 16, 1 &lt;&lt; 16);
<a name="l00324"></a>00324         <a class="code" href="GLFlashAdaptor_8cpp.html#aa7108f2235d7790ff4e9b20a53306625">glPopMatrix</a>();
<a name="l00325"></a>00325 }
<a name="l00326"></a>00326 
<a name="l00327"></a>00327 
<a name="l00328"></a><a class="code" href="GLESUtils_8h.html#ae7574b84620fb45181e75e3fb111ad8c">00328</a> <span class="keywordtype">void</span> <a class="code" href="GLESUtils_8cpp.html#a6ac3f63b00b7c06f823a5d23a6d63053">DrawRect</a>(CL_Vec2f &amp;vPos, CL_Vec2f &amp;vSize, <a class="code" href="PlatformSetupAndroid_8h.html#acbd4acd0d29e2d6c43104827f77d9cd2">uint32</a> <a class="code" href="Renderer_2GL_2glext_8h.html#a3ea846f998d64f079b86052b6c4193a8">color</a>, <span class="keywordtype">float</span> lineWidth)
<a name="l00329"></a>00329 {
<a name="l00330"></a>00330         <a class="code" href="GLESUtils_8cpp.html#a6ac3f63b00b7c06f823a5d23a6d63053">DrawRect</a>(vPos.x, vPos.y, vSize.x, vSize.y, color, lineWidth);
<a name="l00331"></a>00331 }
<a name="l00332"></a>00332 
<a name="l00333"></a>00333 <span class="comment">//old way using GL_LINES, but doesn&#39;t work on the Flash target</span>
<a name="l00334"></a>00334 
<a name="l00335"></a>00335 <span class="preprocessor">#ifndef PLATFORM_FLASH</span>
<a name="l00336"></a><a class="code" href="GLESUtils_8h.html#a5c368ce08b20e56e3c895754d1bde740">00336</a> <span class="preprocessor"></span><span class="keywordtype">void</span>  <a class="code" href="GLESUtils_8cpp.html#af1c8f2d31cd9381a3e80e1c3f7a5a1dc">DrawLine</a>( <a class="code" href="flash_2GLES_2gl_8h.html#a68c4714e43d8e827d80759f9cb864f3c">GLuint</a> rgba,   <span class="keywordtype">float</span> ax, <span class="keywordtype">float</span> ay, <span class="keywordtype">float</span> bx, <span class="keywordtype">float</span> <a class="code" href="Renderer_2GL_2glext_8h.html#aee54e9aab2837a54be2ff5fb1c073bd2">by</a>, <span class="keywordtype">float</span> lineWidth )
<a name="l00337"></a>00337 {
<a name="l00338"></a>00338         <a class="code" href="GLESUtils_8cpp.html#aaecd6106d849b5b0fd205753c3ee7c42">SetupOrtho</a>();
<a name="l00339"></a>00339 
<a name="l00340"></a>00340         <a class="code" href="GLFlashAdaptor_8cpp.html#a80fb7c3b62fc0b18c40424cf3bc22d13">glDisable</a>( GL_TEXTURE_2D );
<a name="l00341"></a>00341 
<a name="l00342"></a>00342         <a class="code" href="GLFlashAdaptor_8cpp.html#ad4d5af9621c6fd6339889bdb295e11c8">glEnableClientState</a>(GL_VERTEX_ARRAY);   
<a name="l00343"></a>00343         <a class="code" href="GLFlashAdaptor_8cpp.html#a90fb252b1dfce3a2c9a96d605693450b">glDisableClientState</a>(GL_TEXTURE_COORD_ARRAY);
<a name="l00344"></a>00344         <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> vertices[] = 
<a name="l00345"></a>00345         {
<a name="l00346"></a>00346                 ax,ay, 0,
<a name="l00347"></a>00347                 bx, <a class="code" href="Renderer_2GL_2glext_8h.html#aee54e9aab2837a54be2ff5fb1c073bd2">by</a>, 0 
<a name="l00348"></a>00348         };
<a name="l00349"></a>00349         
<a name="l00350"></a>00350                 <a class="code" href="GLFlashAdaptor_8cpp.html#a971ff5ffa2e7fc5a5c270db726031657">glLineWidth</a>(lineWidth); 
<a name="l00351"></a>00351                 <a class="code" href="GLFlashAdaptor_8cpp.html#a408bccf3c3cf0419446bf36c64a3adc0">glEnable</a> (GL_LINE_SMOOTH);
<a name="l00352"></a>00352                 <span class="comment">//glDisable(GL_LINE_SMOOTH);</span>
<a name="l00353"></a>00353                 <a class="code" href="GLFlashAdaptor_8cpp.html#a60b42a384d48eab89b8a56231bc86906">glHint</a> (GL_LINE_SMOOTH_HINT, GL_NICEST);
<a name="l00354"></a>00354 
<a name="l00355"></a>00355                 <a class="code" href="GLFlashAdaptor_8cpp.html#ae706b283dab261d2212bccd9bf30fc32">glVertexPointer</a>(3, GL_FLOAT, 0, vertices);
<a name="l00356"></a>00356                 <span class="comment">//glColor4f(1, 1, 1, 1);</span>
<a name="l00357"></a>00357                 <a class="code" href="GLFlashAdaptor_8cpp.html#a408bccf3c3cf0419446bf36c64a3adc0">glEnable</a>( GL_BLEND );
<a name="l00358"></a>00358                 <a class="code" href="GLFlashAdaptor_8cpp.html#aeed45e81d121fa686b8286a2855d655c">glColor4x</a>( (rgba &gt;&gt;8 &amp; 0xFF)*256,  (rgba&gt;&gt;16&amp; 0xFF)*256, (rgba&gt;&gt;24&amp; 0xFF)*256, (rgba&amp;0xFF)*256);
<a name="l00359"></a>00359 
<a name="l00360"></a>00360                 <a class="code" href="GLFlashAdaptor_8cpp.html#a0e3de4d267f017c28a03fc4375a4b40e">glDrawArrays</a>(GL_LINES, 0, 2);
<a name="l00361"></a>00361                 <a class="code" href="GLFlashAdaptor_8cpp.html#aeed45e81d121fa686b8286a2855d655c">glColor4x</a>(1 &lt;&lt; 16, 1 &lt;&lt; 16, 1 &lt;&lt; 16, 1 &lt;&lt; 16);
<a name="l00362"></a>00362 
<a name="l00363"></a>00363                 <a class="code" href="GLFlashAdaptor_8cpp.html#a80fb7c3b62fc0b18c40424cf3bc22d13">glDisable</a>( GL_BLEND );
<a name="l00364"></a>00364                 <a class="code" href="GLFlashAdaptor_8cpp.html#a408bccf3c3cf0419446bf36c64a3adc0">glEnable</a>( GL_TEXTURE_2D );
<a name="l00365"></a>00365                 <a class="code" href="GLFlashAdaptor_8cpp.html#ad4d5af9621c6fd6339889bdb295e11c8">glEnableClientState</a>(GL_TEXTURE_COORD_ARRAY);    
<a name="l00366"></a>00366                 CHECK_GL_ERROR();
<a name="l00367"></a>00367 }
<a name="l00368"></a>00368 <span class="preprocessor">#else</span>
<a name="l00369"></a>00369 <span class="preprocessor"></span><span class="keywordtype">void</span>  <a class="code" href="GLESUtils_8cpp.html#af1c8f2d31cd9381a3e80e1c3f7a5a1dc">DrawLine</a>( <a class="code" href="flash_2GLES_2gl_8h.html#a68c4714e43d8e827d80759f9cb864f3c">GLuint</a> rgba,   <span class="keywordtype">float</span> ax, <span class="keywordtype">float</span> ay, <span class="keywordtype">float</span> bx, <span class="keywordtype">float</span> <a class="code" href="Renderer_2GL_2glext_8h.html#aee54e9aab2837a54be2ff5fb1c073bd2">by</a>, <span class="keywordtype">float</span> lineWidth )
<a name="l00370"></a>00370 {
<a name="l00371"></a>00371         <a class="code" href="GLESUtils_8cpp.html#aaecd6106d849b5b0fd205753c3ee7c42">SetupOrtho</a>();
<a name="l00372"></a>00372         <a class="code" href="BaseApp_8cpp.html#a2575c1138f3c57506bd1b72caa8c80c2">g_globalBatcher</a>.<a class="code" href="classRenderBatcher.html#a591ad1906b8683de45ed8a7c86043151">Flush</a>();
<a name="l00373"></a>00373 
<a name="l00374"></a>00374         <a class="code" href="GLFlashAdaptor_8cpp.html#a80fb7c3b62fc0b18c40424cf3bc22d13">glDisable</a>( GL_TEXTURE_2D );
<a name="l00375"></a>00375 
<a name="l00376"></a>00376         <a class="code" href="GLFlashAdaptor_8cpp.html#ad4d5af9621c6fd6339889bdb295e11c8">glEnableClientState</a>(GL_VERTEX_ARRAY);   
<a name="l00377"></a>00377         <a class="code" href="GLFlashAdaptor_8cpp.html#a90fb252b1dfce3a2c9a96d605693450b">glDisableClientState</a>(GL_TEXTURE_COORD_ARRAY);
<a name="l00378"></a>00378         <a class="code" href="GLFlashAdaptor_8cpp.html#a80fb7c3b62fc0b18c40424cf3bc22d13">glDisable</a>(GL_CULL_FACE);
<a name="l00379"></a>00379 
<a name="l00380"></a>00380         <span class="keyword">static</span> <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a>  vertices[3*4];
<a name="l00381"></a>00381 
<a name="l00382"></a>00382         CL_Vec2f <a class="code" href="Renderer_2GL_2glext_8h.html#a13be19455586e95d5a42ed8f054afad2">start</a> = CL_Vec2f(ax, ay);
<a name="l00383"></a>00383         CL_Vec2f <a class="code" href="Renderer_2GL_2glext_8h.html#a432111147038972f06e049e18a837002">end</a> = CL_Vec2f(bx, by);
<a name="l00384"></a>00384 
<a name="l00385"></a>00385         <span class="keywordtype">float</span> dx = ax - bx;
<a name="l00386"></a>00386         <span class="keywordtype">float</span> dy = ay - <a class="code" href="Renderer_2GL_2glext_8h.html#aee54e9aab2837a54be2ff5fb1c073bd2">by</a>;
<a name="l00387"></a>00387 
<a name="l00388"></a>00388         CL_Vec2f rightSide = CL_Vec2f(dy, -dx);
<a name="l00389"></a>00389 
<a name="l00390"></a>00390         <span class="keywordflow">if</span> (rightSide.length() &gt; 0) 
<a name="l00391"></a>00391         {
<a name="l00392"></a>00392                 rightSide.normalize();
<a name="l00393"></a>00393                 rightSide *= lineWidth/2;
<a name="l00394"></a>00394         }
<a name="l00395"></a>00395         
<a name="l00396"></a>00396         CL_Vec2f  leftSide =CL_Vec2f(-dy, dx);
<a name="l00397"></a>00397         
<a name="l00398"></a>00398         <span class="keywordflow">if</span> (leftSide.length() &gt; 0) 
<a name="l00399"></a>00399         {
<a name="l00400"></a>00400                 leftSide.normalize();
<a name="l00401"></a>00401                 leftSide *= lineWidth/2;
<a name="l00402"></a>00402         }
<a name="l00403"></a>00403 
<a name="l00404"></a>00404         CL_Vec2f one = leftSide + <a class="code" href="Renderer_2GL_2glext_8h.html#a13be19455586e95d5a42ed8f054afad2">start</a>;
<a name="l00405"></a>00405 
<a name="l00406"></a>00406         CL_Vec2f two = rightSide + <a class="code" href="Renderer_2GL_2glext_8h.html#a13be19455586e95d5a42ed8f054afad2">start</a>;
<a name="l00407"></a>00407 
<a name="l00408"></a>00408         CL_Vec2f three = rightSide + <a class="code" href="Renderer_2GL_2glext_8h.html#a432111147038972f06e049e18a837002">end</a>;
<a name="l00409"></a>00409 
<a name="l00410"></a>00410         CL_Vec2f four = leftSide = <a class="code" href="Renderer_2GL_2glext_8h.html#a432111147038972f06e049e18a837002">end</a>;
<a name="l00411"></a>00411 
<a name="l00412"></a>00412         vertices[0*3+0] = one.x; vertices[0*3+1] = one.y;
<a name="l00413"></a>00413         vertices[1*3+0] = two.x; vertices[1*3+1] = two.y;
<a name="l00414"></a>00414         vertices[2*3+0] = three.x; vertices[2*3+1] = three.y;
<a name="l00415"></a>00415         vertices[3*3+0] = four.x; vertices[3*3+1] = four.y;
<a name="l00416"></a>00416 
<a name="l00417"></a>00417         <span class="comment">//set the Z</span>
<a name="l00418"></a>00418         vertices[0*3+2] = 0;
<a name="l00419"></a>00419         vertices[1*3+2] = 0;
<a name="l00420"></a>00420         vertices[2*3+2] = 0;
<a name="l00421"></a>00421         vertices[3*3+2] = 0;
<a name="l00422"></a>00422         
<a name="l00423"></a>00423         <a class="code" href="GLFlashAdaptor_8cpp.html#ae706b283dab261d2212bccd9bf30fc32">glVertexPointer</a>(3, GL_FLOAT, 0, vertices);
<a name="l00424"></a>00424         <span class="comment">//glColor4f(1, 1, 1, 1);</span>
<a name="l00425"></a>00425         <a class="code" href="GLFlashAdaptor_8cpp.html#a408bccf3c3cf0419446bf36c64a3adc0">glEnable</a>( GL_BLEND );
<a name="l00426"></a>00426         <a class="code" href="GLFlashAdaptor_8cpp.html#aeed45e81d121fa686b8286a2855d655c">glColor4x</a>( (rgba &gt;&gt;8 &amp; 0xFF)*256,  (rgba&gt;&gt;16&amp; 0xFF)*256, (rgba&gt;&gt;24&amp; 0xFF)*256, (rgba&amp;0xFF)*256);
<a name="l00427"></a>00427 
<a name="l00428"></a>00428         <a class="code" href="GLFlashAdaptor_8cpp.html#a0e3de4d267f017c28a03fc4375a4b40e">glDrawArrays</a>(GL_TRIANGLE_FAN, 0, 4);
<a name="l00429"></a>00429         <a class="code" href="GLFlashAdaptor_8cpp.html#aeed45e81d121fa686b8286a2855d655c">glColor4x</a>(1 &lt;&lt; 16, 1 &lt;&lt; 16, 1 &lt;&lt; 16, 1 &lt;&lt; 16);
<a name="l00430"></a>00430 
<a name="l00431"></a>00431         <a class="code" href="GLFlashAdaptor_8cpp.html#a408bccf3c3cf0419446bf36c64a3adc0">glEnable</a>(GL_CULL_FACE);
<a name="l00432"></a>00432 
<a name="l00433"></a>00433         <a class="code" href="GLFlashAdaptor_8cpp.html#a80fb7c3b62fc0b18c40424cf3bc22d13">glDisable</a>( GL_BLEND );
<a name="l00434"></a>00434         <a class="code" href="GLFlashAdaptor_8cpp.html#a408bccf3c3cf0419446bf36c64a3adc0">glEnable</a>( GL_TEXTURE_2D );
<a name="l00435"></a>00435         <a class="code" href="GLFlashAdaptor_8cpp.html#ad4d5af9621c6fd6339889bdb295e11c8">glEnableClientState</a>(GL_TEXTURE_COORD_ARRAY);    
<a name="l00436"></a>00436         CHECK_GL_ERROR();
<a name="l00437"></a>00437 }
<a name="l00438"></a>00438 
<a name="l00439"></a>00439 <span class="preprocessor">#endif</span>
<a name="l00440"></a><a class="code" href="GLESUtils_8cpp.html#a0c05467fb497e6cea00bc882f6c3a201">00440</a> <span class="preprocessor"></span><span class="keywordtype">void</span>  <a class="code" href="GLESUtils_8cpp.html#a0c05467fb497e6cea00bc882f6c3a201">GenerateFillRect</a>( <a class="code" href="flash_2GLES_2gl_8h.html#a68c4714e43d8e827d80759f9cb864f3c">GLuint</a> rgba, <span class="keywordtype">float</span> <a class="code" href="flash_2GLES_2glext_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>, <span class="keywordtype">float</span> <a class="code" href="flash_2GLES_2glext_8h.html#a2532a9f8ed3a10a63f5e3c484fbfdb9b">y</a>, <span class="keywordtype">float</span> <a class="code" href="Renderer_2GL_2glext_8h.html#adb12a0d439f32ca388b2c806150cc54d">w</a>, <span class="keywordtype">float</span> <a class="code" href="Renderer_2GL_2glext_8h.html#afa0fb1b5e976920c0abeff2dca3ed774">h</a> )
<a name="l00441"></a>00441 {
<a name="l00442"></a>00442         <a class="code" href="GLESUtils_8cpp.html#aaecd6106d849b5b0fd205753c3ee7c42">SetupOrtho</a>();
<a name="l00443"></a>00443 
<a name="l00444"></a>00444         <span class="comment">//disable depth testing and depth writing</span>
<a name="l00445"></a>00445         <a class="code" href="GLFlashAdaptor_8cpp.html#a80fb7c3b62fc0b18c40424cf3bc22d13">glDisable</a>( GL_TEXTURE_2D );
<a name="l00446"></a>00446         
<a name="l00447"></a>00447         <span class="keywordflow">if</span> (<a class="code" href="BaseApp_8h.html#a72086b48d24daf0a65dd20189a16bd16">GetBaseApp</a>()-&gt;GetDisableSubPixelBlits())
<a name="l00448"></a>00448         {
<a name="l00449"></a>00449                 <span class="comment">//fix issue for cracks when scaling when 2d tile blits</span>
<a name="l00450"></a>00450 
<a name="l00451"></a>00451                 x = ceil(x);
<a name="l00452"></a>00452                 y = ceil(y);
<a name="l00453"></a>00453                 w = ceil(w);
<a name="l00454"></a>00454                 h = ceil(h);
<a name="l00455"></a>00455         }
<a name="l00456"></a>00456 
<a name="l00457"></a>00457 
<a name="l00458"></a>00458         <span class="comment">//3 2</span>
<a name="l00459"></a>00459         <span class="comment">//0 1</span>
<a name="l00460"></a>00460         
<a name="l00461"></a>00461         <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> vertices[] = {
<a name="l00462"></a>00462                 <a class="code" href="flash_2GLES_2glext_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>,                      <a class="code" href="flash_2GLES_2glext_8h.html#a2532a9f8ed3a10a63f5e3c484fbfdb9b">y</a>,                      0.0,
<a name="l00463"></a>00463                 x + <a class="code" href="Renderer_2GL_2glext_8h.html#adb12a0d439f32ca388b2c806150cc54d">w</a>,          <a class="code" href="flash_2GLES_2glext_8h.html#a2532a9f8ed3a10a63f5e3c484fbfdb9b">y</a>,                      0.0,
<a name="l00464"></a>00464                 x +<a class="code" href="Renderer_2GL_2glext_8h.html#adb12a0d439f32ca388b2c806150cc54d">w</a>,                   y+<a class="code" href="Renderer_2GL_2glext_8h.html#afa0fb1b5e976920c0abeff2dca3ed774">h</a>,            0.0,
<a name="l00465"></a>00465                 <a class="code" href="flash_2GLES_2glext_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a> ,              y+<a class="code" href="Renderer_2GL_2glext_8h.html#afa0fb1b5e976920c0abeff2dca3ed774">h</a>,           0.0 };
<a name="l00466"></a>00466 
<a name="l00467"></a>00467                 <a class="code" href="GLFlashAdaptor_8cpp.html#ad4d5af9621c6fd6339889bdb295e11c8">glEnableClientState</a>(GL_VERTEX_ARRAY);   
<a name="l00468"></a>00468         
<a name="l00469"></a>00469                 <a class="code" href="GLFlashAdaptor_8cpp.html#ae706b283dab261d2212bccd9bf30fc32">glVertexPointer</a>(3, GL_FLOAT, 0, vertices);
<a name="l00470"></a>00470                 <span class="comment">//glColor4f(1, 1, 1, 1);</span>
<a name="l00471"></a>00471                 assert((rgba&amp;0xFF)*256 != 0 &amp;&amp; <span class="stringliteral">&quot;Why send something with zero alpha?&quot;</span>);
<a name="l00472"></a>00472                 <a class="code" href="GLFlashAdaptor_8cpp.html#a408bccf3c3cf0419446bf36c64a3adc0">glEnable</a>( GL_BLEND );
<a name="l00473"></a>00473                 <a class="code" href="GLFlashAdaptor_8cpp.html#a80fb7c3b62fc0b18c40424cf3bc22d13">glDisable</a>( GL_TEXTURE_2D );
<a name="l00474"></a>00474                 <a class="code" href="GLFlashAdaptor_8cpp.html#a408bccf3c3cf0419446bf36c64a3adc0">glEnable</a>(GL_ALPHA_TEST);
<a name="l00475"></a>00475 
<a name="l00476"></a>00476                 <a class="code" href="GLFlashAdaptor_8cpp.html#aeed45e81d121fa686b8286a2855d655c">glColor4x</a>( (rgba &gt;&gt;8 &amp; 0xFF)*256,  (rgba&gt;&gt;16&amp; 0xFF)*256, (rgba&gt;&gt;24&amp; 0xFF)*256, (rgba&amp;0xFF)*256);
<a name="l00477"></a>00477                 <a class="code" href="GLFlashAdaptor_8cpp.html#a90fb252b1dfce3a2c9a96d605693450b">glDisableClientState</a>(GL_TEXTURE_COORD_ARRAY);   
<a name="l00478"></a>00478 
<a name="l00479"></a>00479                 <a class="code" href="GLFlashAdaptor_8cpp.html#a0e3de4d267f017c28a03fc4375a4b40e">glDrawArrays</a>(GL_TRIANGLE_FAN, 0, 4);
<a name="l00480"></a>00480                 <a class="code" href="GLFlashAdaptor_8cpp.html#aeed45e81d121fa686b8286a2855d655c">glColor4x</a>(1 &lt;&lt; 16, 1 &lt;&lt; 16, 1 &lt;&lt; 16, 1 &lt;&lt; 16);
<a name="l00481"></a>00481 
<a name="l00482"></a>00482                 <a class="code" href="GLFlashAdaptor_8cpp.html#a80fb7c3b62fc0b18c40424cf3bc22d13">glDisable</a>( GL_BLEND );
<a name="l00483"></a>00483                 <a class="code" href="GLFlashAdaptor_8cpp.html#a408bccf3c3cf0419446bf36c64a3adc0">glEnable</a>( GL_TEXTURE_2D );
<a name="l00484"></a>00484                 <a class="code" href="GLFlashAdaptor_8cpp.html#a80fb7c3b62fc0b18c40424cf3bc22d13">glDisable</a>(GL_ALPHA_TEST);
<a name="l00485"></a>00485 
<a name="l00486"></a>00486                 <a class="code" href="GLFlashAdaptor_8cpp.html#ad4d5af9621c6fd6339889bdb295e11c8">glEnableClientState</a>(GL_TEXTURE_COORD_ARRAY);    
<a name="l00487"></a>00487         CHECK_GL_ERROR();       
<a name="l00488"></a>00488 }
<a name="l00489"></a>00489 
<a name="l00490"></a><a class="code" href="GLESUtils_8h.html#a06d90a4b4a15ef66133d8057414520d2">00490</a> <span class="keywordtype">void</span> <a class="code" href="GLESUtils_8cpp.html#a7bf6e8268b8338f660286927e31b619e">PushRotationMatrix</a>(<span class="keywordtype">float</span> rotationDegrees, CL_Vec2f vRotatePt)
<a name="l00491"></a>00491 {
<a name="l00492"></a>00492         <a class="code" href="GLFlashAdaptor_8cpp.html#a5b2a1a17e595774a852426a5ed64c023">glPushMatrix</a>();
<a name="l00493"></a>00493         <a class="code" href="GLFlashAdaptor_8cpp.html#ae9636873ef091fbb322604d8b97b4e4e">glTranslatef</a>(vRotatePt.x, vRotatePt.y, 0);
<a name="l00494"></a>00494         <a class="code" href="GLFlashAdaptor_8cpp.html#a47507478dc599b4b4fd9619a7a6aec45">glRotatef</a>(rotationDegrees, 0, 0, 1);
<a name="l00495"></a>00495 }
<a name="l00496"></a>00496 
<a name="l00497"></a><a class="code" href="GLESUtils_8h.html#a64bda37f95afbf66b289824d7f29add0">00497</a> <span class="keywordtype">void</span> <a class="code" href="GLESUtils_8cpp.html#a64bda37f95afbf66b289824d7f29add0">PopRotationMatrix</a>()
<a name="l00498"></a>00498 {
<a name="l00499"></a>00499         <span class="comment">//Wrap this in case I do something more fancy later</span>
<a name="l00500"></a>00500         <a class="code" href="GLFlashAdaptor_8cpp.html#aa7108f2235d7790ff4e9b20a53306625">glPopMatrix</a>();
<a name="l00501"></a>00501 }
<a name="l00502"></a>00502 
<a name="l00503"></a><a class="code" href="GLESUtils_8cpp.html#a2b267cf0aa37e7567db34a20b5c98117">00503</a> <span class="keywordtype">bool</span> <a class="code" href="GLESUtils_8cpp.html#a2b267cf0aa37e7567db34a20b5c98117">g_OrthoRenderSizeActive</a> = <span class="keyword">false</span>;
<a name="l00504"></a>00504 
<a name="l00505"></a><a class="code" href="GLESUtils_8h.html#aa089bbac2590b0da2d656ab46765cbdb">00505</a> <span class="keywordtype">void</span> <a class="code" href="GLESUtils_8cpp.html#aa089bbac2590b0da2d656ab46765cbdb">SetOrthoRenderSize</a>(<span class="keywordtype">float</span> <a class="code" href="flash_2GLES_2glext_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>, <span class="keywordtype">float</span> <a class="code" href="flash_2GLES_2glext_8h.html#a2532a9f8ed3a10a63f5e3c484fbfdb9b">y</a>, <span class="keywordtype">int</span> screenOffsetX, <span class="keywordtype">int</span> screenOffsetY)
<a name="l00506"></a>00506 {
<a name="l00507"></a>00507         
<a name="l00508"></a>00508         <a class="code" href="GLESUtils_8cpp.html#aaecd6106d849b5b0fd205753c3ee7c42">SetupOrtho</a>();
<a name="l00509"></a>00509 
<a name="l00510"></a>00510         <span class="keywordflow">if</span> (g_OrthoRenderSizeActive)
<a name="l00511"></a>00511         {
<a name="l00512"></a>00512                 <a class="code" href="GLESUtils_8cpp.html#ac41749ec724ee4bb5502541885779e7e">RemoveOrthoRenderSize</a>();
<a name="l00513"></a>00513         }
<a name="l00514"></a>00514         
<a name="l00515"></a>00515         g_OrthoRenderSizeActive = <span class="keyword">true</span>;
<a name="l00516"></a>00516         <a class="code" href="GLFlashAdaptor_8cpp.html#a28695f13b359fbbc9e8a5d57662305eb">glMatrixMode</a>(GL_PROJECTION);
<a name="l00517"></a>00517         
<a name="l00518"></a>00518         <a class="code" href="GLFlashAdaptor_8cpp.html#aa7108f2235d7790ff4e9b20a53306625">glPopMatrix</a>();
<a name="l00519"></a>00519         <a class="code" href="GLFlashAdaptor_8cpp.html#a5b2a1a17e595774a852426a5ed64c023">glPushMatrix</a>();
<a name="l00520"></a>00520 
<a name="l00521"></a>00521         <a class="code" href="GLFlashAdaptor_8cpp.html#a77d245cb8a1701a1dedc8c1d5796a836">glLoadIdentity</a>();
<a name="l00522"></a>00522         <a class="code" href="GLESUtils_8cpp.html#aaef93f36ac2fdf1b7344d46d998d7299">RotateGLIfNeeded</a>();
<a name="l00523"></a>00523         <a class="code" href="GLESUtils_8cpp.html#a38deb7f34428741e2d3c1c635fb68e43">g_renderOrthoRenderSizeX</a> = <a class="code" href="flash_2GLES_2glext_8h.html#a0cdec8e97a75ee9458b23d152bf962d4">x</a>;
<a name="l00524"></a>00524         <a class="code" href="GLESUtils_8cpp.html#acf46e869b557a68225eb92905ea30d32">g_renderOrthoRenderSizeY</a> = <a class="code" href="flash_2GLES_2glext_8h.html#a2532a9f8ed3a10a63f5e3c484fbfdb9b">y</a>;
<a name="l00525"></a>00525         
<a name="l00526"></a>00526         <span class="keywordtype">float</span> <a class="code" href="Renderer_2GL_2glext_8h.html#ab81054a092f44d2ce010b3c46e3a7ff3">offset</a> = 0;
<a name="l00527"></a>00527         <a class="code" href="GLFlashAdaptor_8cpp.html#af2f89f50680bb25d24ead574e07fdcd8">glOrthof</a>( (-screenOffsetX)+offset, (x+offset), y+offset, screenOffsetY+offset,  -1, 1 );                
<a name="l00528"></a>00528         <span class="comment">//glTranslatef(0.5f, 0.5f, 0); //fixes a gl glitch where pixels don&#39;t know which side to be on</span>
<a name="l00529"></a>00529 
<a name="l00530"></a>00530         <a class="code" href="GLFlashAdaptor_8cpp.html#a28695f13b359fbbc9e8a5d57662305eb">glMatrixMode</a>(GL_MODELVIEW);
<a name="l00531"></a>00531         CHECK_GL_ERROR();
<a name="l00532"></a>00532 }
<a name="l00533"></a>00533 
<a name="l00534"></a>00534 
<a name="l00535"></a><a class="code" href="GLESUtils_8h.html#ac41749ec724ee4bb5502541885779e7e">00535</a> <span class="keywordtype">void</span> <a class="code" href="GLESUtils_8cpp.html#ac41749ec724ee4bb5502541885779e7e">RemoveOrthoRenderSize</a>()
<a name="l00536"></a>00536 {
<a name="l00537"></a>00537         <a class="code" href="BaseApp_8cpp.html#a2575c1138f3c57506bd1b72caa8c80c2">g_globalBatcher</a>.<a class="code" href="classRenderBatcher.html#a591ad1906b8683de45ed8a7c86043151">Flush</a>();
<a name="l00538"></a>00538         <span class="keywordflow">if</span> (<a class="code" href="RenderUtils_8cpp.html#adcf9eeda4c715bd581aaad4d71d35a97">NeedsOrthoSet</a>()) <span class="keywordflow">return</span>;
<a name="l00539"></a>00539         
<a name="l00540"></a>00540         <span class="keywordflow">if</span> (g_OrthoRenderSizeActive)
<a name="l00541"></a>00541         {
<a name="l00542"></a>00542                 <a class="code" href="GLFlashAdaptor_8cpp.html#a28695f13b359fbbc9e8a5d57662305eb">glMatrixMode</a>(GL_PROJECTION);
<a name="l00543"></a>00543                 <a class="code" href="GLFlashAdaptor_8cpp.html#aa7108f2235d7790ff4e9b20a53306625">glPopMatrix</a>();
<a name="l00544"></a>00544                 <a class="code" href="GLFlashAdaptor_8cpp.html#a5b2a1a17e595774a852426a5ed64c023">glPushMatrix</a>();
<a name="l00545"></a>00545 
<a name="l00546"></a>00546                 <a class="code" href="GLFlashAdaptor_8cpp.html#a77d245cb8a1701a1dedc8c1d5796a836">glLoadIdentity</a>();
<a name="l00547"></a>00547                 <a class="code" href="GLESUtils_8cpp.html#aaef93f36ac2fdf1b7344d46d998d7299">RotateGLIfNeeded</a>();
<a name="l00548"></a>00548                 <a class="code" href="GLESUtils_8cpp.html#a38deb7f34428741e2d3c1c635fb68e43">g_renderOrthoRenderSizeX</a> = <a class="code" href="PlatformSetup_8cpp.html#a3b38aaa65dfcae39c0700887f36f1521" title="Returns the same as GetScreenSizeX() but as a float.">GetScreenSizeXf</a>();
<a name="l00549"></a>00549                 <a class="code" href="GLESUtils_8cpp.html#acf46e869b557a68225eb92905ea30d32">g_renderOrthoRenderSizeY</a> = <a class="code" href="PlatformSetup_8cpp.html#a94a0deb0a111cc46d8f7285fd3f83838" title="Returns the same as GetScreenSizeY() but as a float.">GetScreenSizeYf</a>();
<a name="l00550"></a>00550         
<a name="l00551"></a>00551                 <span class="keywordtype">float</span> <a class="code" href="Renderer_2GL_2glext_8h.html#ab81054a092f44d2ce010b3c46e3a7ff3">offset</a> = 0.0f;
<a name="l00552"></a>00552                 <a class="code" href="GLFlashAdaptor_8cpp.html#af2f89f50680bb25d24ead574e07fdcd8">glOrthof</a>( offset,  <a class="code" href="GLESUtils_8cpp.html#a38deb7f34428741e2d3c1c635fb68e43">g_renderOrthoRenderSizeX</a>+offset, <a class="code" href="GLESUtils_8cpp.html#acf46e869b557a68225eb92905ea30d32">g_renderOrthoRenderSizeY</a>+offset, offset,  -1, 1 );          
<a name="l00553"></a>00553                 <a class="code" href="GLFlashAdaptor_8cpp.html#a28695f13b359fbbc9e8a5d57662305eb">glMatrixMode</a>(GL_MODELVIEW);
<a name="l00554"></a>00554                 CHECK_GL_ERROR();
<a name="l00555"></a>00555         }
<a name="l00556"></a>00556 
<a name="l00557"></a>00557 }
<a name="l00558"></a>00558 
<a name="l00559"></a><a class="code" href="GLESUtils_8h.html#aaecd6106d849b5b0fd205753c3ee7c42">00559</a> <span class="keywordtype">void</span> <a class="code" href="GLESUtils_8cpp.html#aaecd6106d849b5b0fd205753c3ee7c42">SetupOrtho</a>()
<a name="l00560"></a>00560 {
<a name="l00561"></a>00561         <span class="keywordflow">if</span> (!<a class="code" href="RenderUtils_8cpp.html#adcf9eeda4c715bd581aaad4d71d35a97">NeedsOrthoSet</a>()) <span class="keywordflow">return</span>;
<a name="l00562"></a>00562 
<a name="l00563"></a>00563         CHECK_GL_ERROR();
<a name="l00564"></a>00564         <a class="code" href="BaseApp_8cpp.html#a2575c1138f3c57506bd1b72caa8c80c2">g_globalBatcher</a>.<a class="code" href="classRenderBatcher.html#a591ad1906b8683de45ed8a7c86043151">Flush</a>();
<a name="l00565"></a>00565 
<a name="l00566"></a>00566         CHECK_GL_ERROR();
<a name="l00567"></a>00567         <a class="code" href="GLFlashAdaptor_8cpp.html#a28695f13b359fbbc9e8a5d57662305eb">glMatrixMode</a>(GL_PROJECTION);
<a name="l00568"></a>00568         <a class="code" href="GLFlashAdaptor_8cpp.html#a5b2a1a17e595774a852426a5ed64c023">glPushMatrix</a>();
<a name="l00569"></a>00569         <a class="code" href="GLFlashAdaptor_8cpp.html#a77d245cb8a1701a1dedc8c1d5796a836">glLoadIdentity</a>();
<a name="l00570"></a>00570         <a class="code" href="GLFlashAdaptor_8cpp.html#a408bccf3c3cf0419446bf36c64a3adc0">glEnable</a>(GL_TEXTURE_2D);
<a name="l00571"></a>00571         <a class="code" href="GLFlashAdaptor_8cpp.html#ad4d5af9621c6fd6339889bdb295e11c8">glEnableClientState</a>(GL_VERTEX_ARRAY);   
<a name="l00572"></a>00572         <a class="code" href="GLFlashAdaptor_8cpp.html#ad4d5af9621c6fd6339889bdb295e11c8">glEnableClientState</a>(GL_TEXTURE_COORD_ARRAY);    
<a name="l00573"></a>00573         <a class="code" href="GLFlashAdaptor_8cpp.html#a90fb252b1dfce3a2c9a96d605693450b">glDisableClientState</a>(GL_COLOR_ARRAY);   
<a name="l00574"></a>00574         <a class="code" href="GLFlashAdaptor_8cpp.html#a90fb252b1dfce3a2c9a96d605693450b">glDisableClientState</a>(GL_NORMAL_ARRAY);
<a name="l00575"></a>00575 
<a name="l00576"></a>00576         CHECK_GL_ERROR();
<a name="l00577"></a>00577         <a class="code" href="GLESUtils_8cpp.html#aaef93f36ac2fdf1b7344d46d998d7299">RotateGLIfNeeded</a>();
<a name="l00578"></a>00578 
<a name="l00579"></a>00579         <span class="comment">//Note:  We could setup our projection matrix upside down so the upper left would be 0,0, but.. then you have to wind your</span>
<a name="l00580"></a>00580         <span class="comment">//triangles backwards (or keep switching to front face culling) which I find even more confusing than dealing with the y offsets.</span>
<a name="l00581"></a>00581 
<a name="l00582"></a>00582 
<a name="l00583"></a>00583         <span class="comment">//When PrepareForGL() is called (removing our 2d ortho stuff), it gets turned back into normal back face culling</span>
<a name="l00584"></a>00584 
<a name="l00585"></a>00585 <span class="preprocessor">#ifdef _IRR_STATIC_LIB_</span>
<a name="l00586"></a>00586 <span class="preprocessor"></span>        <a class="code" href="GLFlashAdaptor_8cpp.html#a766190fb4cce2d79732db18e0aa098ce">glFrontFace</a>( GL_CW );
<a name="l00587"></a>00587         <a class="code" href="GLFlashAdaptor_8cpp.html#ab63e080caaefe4d36c40d4ebaf9a3f59">glCullFace</a>(GL_BACK);
<a name="l00588"></a>00588 <span class="preprocessor">#else</span>
<a name="l00589"></a>00589 <span class="preprocessor"></span>        <span class="comment">//glFrontFace( GL_CCW );</span>
<a name="l00590"></a>00590         <a class="code" href="GLFlashAdaptor_8cpp.html#ab63e080caaefe4d36c40d4ebaf9a3f59">glCullFace</a>(GL_FRONT);
<a name="l00591"></a>00591 <span class="preprocessor">#endif</span>
<a name="l00592"></a>00592 <span class="preprocessor"></span>        
<a name="l00593"></a>00593 
<a name="l00594"></a>00594         <a class="code" href="GLESUtils_8cpp.html#a38deb7f34428741e2d3c1c635fb68e43">g_renderOrthoRenderSizeX</a> = <a class="code" href="PlatformSetup_8cpp.html#a3b38aaa65dfcae39c0700887f36f1521" title="Returns the same as GetScreenSizeX() but as a float.">GetScreenSizeXf</a>();
<a name="l00595"></a>00595         <a class="code" href="GLESUtils_8cpp.html#acf46e869b557a68225eb92905ea30d32">g_renderOrthoRenderSizeY</a> = <a class="code" href="PlatformSetup_8cpp.html#a94a0deb0a111cc46d8f7285fd3f83838" title="Returns the same as GetScreenSizeY() but as a float.">GetScreenSizeYf</a>();
<a name="l00596"></a>00596         
<a name="l00597"></a>00597         <span class="keywordtype">float</span> tempX = <a class="code" href="GLESUtils_8cpp.html#a38deb7f34428741e2d3c1c635fb68e43">g_renderOrthoRenderSizeX</a>;
<a name="l00598"></a>00598         <span class="keywordtype">float</span> tempY = <a class="code" href="GLESUtils_8cpp.html#acf46e869b557a68225eb92905ea30d32">g_renderOrthoRenderSizeY</a>;
<a name="l00599"></a>00599 
<a name="l00600"></a>00600     CHECK_GL_ERROR();
<a name="l00601"></a>00601 
<a name="l00602"></a>00602         <a class="code" href="GLFlashAdaptor_8cpp.html#af2f89f50680bb25d24ead574e07fdcd8">glOrthof</a>( 0,  tempX, tempY, 0,  -1, 1 );                
<a name="l00603"></a>00603         
<a name="l00604"></a>00604         CHECK_GL_ERROR();
<a name="l00605"></a>00605 
<a name="l00606"></a>00606         <a class="code" href="GLFlashAdaptor_8cpp.html#a28695f13b359fbbc9e8a5d57662305eb">glMatrixMode</a>(GL_MODELVIEW);
<a name="l00607"></a>00607         <a class="code" href="GLFlashAdaptor_8cpp.html#a5b2a1a17e595774a852426a5ed64c023">glPushMatrix</a>();
<a name="l00608"></a>00608         <a class="code" href="GLFlashAdaptor_8cpp.html#a77d245cb8a1701a1dedc8c1d5796a836">glLoadIdentity</a>();
<a name="l00609"></a>00609         <span class="comment">//disable depth testing and depth writing</span>
<a name="l00610"></a>00610         <a class="code" href="GLFlashAdaptor_8cpp.html#a80fb7c3b62fc0b18c40424cf3bc22d13">glDisable</a>(GL_DEPTH_TEST);
<a name="l00611"></a>00611         <a class="code" href="GLFlashAdaptor_8cpp.html#a984e052016da160e455a1e9adfe10933">glDepthMask</a>(GL_FALSE);
<a name="l00612"></a>00612         <a class="code" href="RenderUtils_8cpp.html#a11aabb34b86114eca7586c18310e9028">SetOrthoModeFlag</a>();
<a name="l00613"></a>00613         CHECK_GL_ERROR();
<a name="l00614"></a>00614 }
<a name="l00615"></a>00615 
<a name="l00616"></a><a class="code" href="GLESUtils_8h.html#ac6c3f6a87dbfa09bbcc20c6c4dbe7c20">00616</a> <span class="keywordtype">void</span> <a class="code" href="GLESUtils_8cpp.html#ac6c3f6a87dbfa09bbcc20c6c4dbe7c20">PrepareForGL</a>()
<a name="l00617"></a>00617 {
<a name="l00618"></a>00618         <span class="keywordflow">if</span> (<a class="code" href="RenderUtils_8cpp.html#adcf9eeda4c715bd581aaad4d71d35a97">NeedsOrthoSet</a>()) <span class="keywordflow">return</span>; <span class="comment">//not needed</span>
<a name="l00619"></a>00619 
<a name="l00620"></a>00620         <a class="code" href="BaseApp_8cpp.html#a2575c1138f3c57506bd1b72caa8c80c2">g_globalBatcher</a>.<a class="code" href="classRenderBatcher.html#a591ad1906b8683de45ed8a7c86043151">Flush</a>();
<a name="l00621"></a>00621 
<a name="l00622"></a>00622         <a class="code" href="GLFlashAdaptor_8cpp.html#a28695f13b359fbbc9e8a5d57662305eb">glMatrixMode</a>(GL_PROJECTION);
<a name="l00623"></a>00623         <a class="code" href="GLFlashAdaptor_8cpp.html#aa7108f2235d7790ff4e9b20a53306625">glPopMatrix</a>();
<a name="l00624"></a>00624         <a class="code" href="GLFlashAdaptor_8cpp.html#a28695f13b359fbbc9e8a5d57662305eb">glMatrixMode</a>(GL_MODELVIEW);
<a name="l00625"></a>00625         <a class="code" href="GLFlashAdaptor_8cpp.html#aa7108f2235d7790ff4e9b20a53306625">glPopMatrix</a>();
<a name="l00626"></a>00626         <a class="code" href="GLFlashAdaptor_8cpp.html#a984e052016da160e455a1e9adfe10933">glDepthMask</a>(GL_TRUE);
<a name="l00627"></a>00627         <a class="code" href="GLFlashAdaptor_8cpp.html#a408bccf3c3cf0419446bf36c64a3adc0">glEnable</a>(GL_DEPTH_TEST);   
<a name="l00628"></a>00628         CHECK_GL_ERROR();
<a name="l00629"></a>00629         <a class="code" href="GLFlashAdaptor_8cpp.html#ab63e080caaefe4d36c40d4ebaf9a3f59">glCullFace</a>(GL_BACK);
<a name="l00630"></a>00630         <a class="code" href="GLFlashAdaptor_8cpp.html#a77d245cb8a1701a1dedc8c1d5796a836">glLoadIdentity</a>();
<a name="l00631"></a>00631         CHECK_GL_ERROR();
<a name="l00632"></a>00632         <a class="code" href="RenderUtils_8cpp.html#a79f1ff4acf23c5d2253de96999dc2f61">ResetOrthoFlag</a>();
<a name="l00633"></a>00633 }
<a name="l00634"></a>00634 
<a name="l00635"></a>00635 <span class="comment">/*</span>
<a name="l00636"></a>00636 <span class="comment">* Transform a point (column vector) by a 4x4 matrix.  I.e.  out = m * in</span>
<a name="l00637"></a>00637 <span class="comment">* Input:  m - the 4x4 matrix</span>
<a name="l00638"></a>00638 <span class="comment">*         in - the 4x1 vector</span>
<a name="l00639"></a>00639 <span class="comment">* Output:  out - the resulting 4x1 vector.</span>
<a name="l00640"></a>00640 <span class="comment">*/</span>
<a name="l00641"></a><a class="code" href="GLESUtils_8h.html#a8140c44e1a3b7a6ce5c5484388109bf0">00641</a> <span class="keywordtype">void</span> <a class="code" href="GLESUtils_8cpp.html#a8140c44e1a3b7a6ce5c5484388109bf0">transform_point</a>(<a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> out[4], <span class="keyword">const</span> <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> <a class="code" href="Renderer_2GL_2glext_8h.html#af593500c283bf1a787a6f947f503a5c2">m</a>[16], <span class="keyword">const</span> <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> <a class="code" href="Renderer_2GL_2glext_8h.html#a83ad0ee7f1e06b59c90271716e689080">in</a>[4])
<a name="l00642"></a>00642 {
<a name="l00643"></a>00643 <span class="preprocessor">#define M(row,col)  m[col*4+row]</span>
<a name="l00644"></a>00644 <span class="preprocessor"></span>        out[0] =
<a name="l00645"></a>00645                 M(0, 0) * in[0] + M(0, 1) * in[1] + M(0, 2) * in[2] + M(0, 3) * in[3];
<a name="l00646"></a>00646         out[1] =
<a name="l00647"></a>00647                 M(1, 0) * in[0] + M(1, 1) * in[1] + M(1, 2) * in[2] + M(1, 3) * in[3];
<a name="l00648"></a>00648         out[2] =
<a name="l00649"></a>00649                 M(2, 0) * in[0] + M(2, 1) * in[1] + M(2, 2) * in[2] + M(2, 3) * in[3];
<a name="l00650"></a>00650         out[3] =
<a name="l00651"></a>00651                 M(3, 0) * in[0] + M(3, 1) * in[1] + M(3, 2) * in[2] + M(3, 3) * in[3];
<a name="l00652"></a>00652 <span class="preprocessor">#undef M</span>
<a name="l00653"></a>00653 <span class="preprocessor"></span>}
<a name="l00654"></a>00654 
<a name="l00655"></a>00655 
<a name="l00656"></a>00656 
<a name="l00657"></a>00657 
<a name="l00658"></a>00658 <span class="comment">/*</span>
<a name="l00659"></a>00659 <span class="comment">* Perform a 4x4 matrix multiplication  (product = a x b).</span>
<a name="l00660"></a>00660 <span class="comment">* Input:  a, b - matrices to multiply</span>
<a name="l00661"></a>00661 <span class="comment">* Output:  product - product of a and b</span>
<a name="l00662"></a>00662 <span class="comment">*/</span>
<a name="l00663"></a>00663 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00664"></a><a class="code" href="GLESUtils_8cpp.html#a43666c60d1b7c59ee050524780ba831f">00664</a> <a class="code" href="GLESUtils_8cpp.html#a43666c60d1b7c59ee050524780ba831f">matmul</a>(<a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> * product, <span class="keyword">const</span> <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> * <a class="code" href="Renderer_2GL_2glext_8h.html#ac8729153468b5dcf13f971b21d84d4e5">a</a>, <span class="keyword">const</span> <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> * <a class="code" href="Renderer_2GL_2glext_8h.html#a6eba317e3cf44d6d26c04a5a8f197dcb">b</a>)
<a name="l00665"></a>00665 {
<a name="l00666"></a>00666         <span class="comment">/* This matmul was contributed by Thomas Malik */</span>
<a name="l00667"></a>00667         <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> temp[16];
<a name="l00668"></a>00668         <a class="code" href="flash_2GLES_2gl_8h.html#acebcc1c5663f14ebde1d16831e5fed94">GLint</a> i;
<a name="l00669"></a>00669 
<a name="l00670"></a>00670 <span class="preprocessor">#define A(row,col)  a[(col&lt;&lt;2)+row]</span>
<a name="l00671"></a>00671 <span class="preprocessor"></span><span class="preprocessor">#define B(row,col)  b[(col&lt;&lt;2)+row]</span>
<a name="l00672"></a>00672 <span class="preprocessor"></span><span class="preprocessor">#define T(row,col)  temp[(col&lt;&lt;2)+row]</span>
<a name="l00673"></a>00673 <span class="preprocessor"></span>
<a name="l00674"></a>00674         <span class="comment">/* i-te Zeile */</span>
<a name="l00675"></a>00675         <span class="keywordflow">for</span> (i = 0; i &lt; 4; i++) {
<a name="l00676"></a>00676                 T(i, 0) =
<a name="l00677"></a>00677                         A(i, 0) * B(0, 0) + A(i, 1) * B(1, 0) + A(i, 2) * B(2, 0) + A(i,
<a name="l00678"></a>00678                         3) *
<a name="l00679"></a>00679                         B(3, 0);
<a name="l00680"></a>00680                 T(i, 1) =
<a name="l00681"></a>00681                         A(i, 0) * B(0, 1) + A(i, 1) * B(1, 1) + A(i, 2) * B(2, 1) + A(i,
<a name="l00682"></a>00682                         3) *
<a name="l00683"></a>00683                         B(3, 1);
<a name="l00684"></a>00684                 T(i, 2) =
<a name="l00685"></a>00685                         A(i, 0) * B(0, 2) + A(i, 1) * B(1, 2) + A(i, 2) * B(2, 2) + A(i,
<a name="l00686"></a>00686                         3) *
<a name="l00687"></a>00687                         B(3, 2);
<a name="l00688"></a>00688                 T(i, 3) =
<a name="l00689"></a>00689                         A(i, 0) * B(0, 3) + A(i, 1) * B(1, 3) + A(i, 2) * B(2, 3) + A(i,
<a name="l00690"></a>00690                         3) *
<a name="l00691"></a>00691                         B(3, 3);
<a name="l00692"></a>00692         }
<a name="l00693"></a>00693 
<a name="l00694"></a>00694 <span class="preprocessor">#undef A</span>
<a name="l00695"></a>00695 <span class="preprocessor"></span><span class="preprocessor">#undef B</span>
<a name="l00696"></a>00696 <span class="preprocessor"></span><span class="preprocessor">#undef T</span>
<a name="l00697"></a>00697 <span class="preprocessor"></span>        memcpy(product, temp, 16 * <span class="keyword">sizeof</span>(<a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a>));
<a name="l00698"></a>00698 }
<a name="l00699"></a>00699 
<a name="l00700"></a>00700 
<a name="l00701"></a>00701 
<a name="l00702"></a>00702 <span class="comment">/*</span>
<a name="l00703"></a>00703 <span class="comment">* Compute inverse of 4x4 transformation matrix.</span>
<a name="l00704"></a>00704 <span class="comment">* Code contributed by Jacques Leroy jle@star.be</span>
<a name="l00705"></a>00705 <span class="comment">* Return GL_TRUE for success, GL_FALSE for failure (singular matrix)</span>
<a name="l00706"></a>00706 <span class="comment">*/</span>
<a name="l00707"></a>00707 <span class="keyword">static</span> <a class="code" href="flash_2GLES_2gl_8h.html#aea1419aa8aec5854bd9807b45171029d">GLboolean</a>
<a name="l00708"></a><a class="code" href="GLESUtils_8cpp.html#a110c83c633db7bf415bd14e6c7550fcb">00708</a> <a class="code" href="GLESUtils_8cpp.html#a110c83c633db7bf415bd14e6c7550fcb">invert_matrix</a>(<span class="keyword">const</span> <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> * <a class="code" href="Renderer_2GL_2glext_8h.html#af593500c283bf1a787a6f947f503a5c2">m</a>, <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> * out)
<a name="l00709"></a>00709 {
<a name="l00710"></a>00710         <span class="comment">/* NB. OpenGL Matrices are COLUMN major. */</span>
<a name="l00711"></a>00711 <span class="preprocessor">#define SWAP_ROWS(a, b) { GLfloat *_tmp = a; (a)=(b); (b)=_tmp; }</span>
<a name="l00712"></a>00712 <span class="preprocessor"></span><span class="preprocessor">#define MAT(m,r,c) (m)[(c)*4+(r)]</span>
<a name="l00713"></a>00713 <span class="preprocessor"></span>
<a name="l00714"></a>00714         <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> wtmp[4][8];
<a name="l00715"></a>00715         <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> m0, m1, m2, m3, <a class="code" href="flash_2GLES_2glext_8h.html#ad585a1393cfa368fa9dc3d8ebff640d5">s</a>;
<a name="l00716"></a>00716         <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> *r0, *r1, *r2, *r3;
<a name="l00717"></a>00717 
<a name="l00718"></a>00718         r0 = wtmp[0], r1 = wtmp[1], r2 = wtmp[2], r3 = wtmp[3];
<a name="l00719"></a>00719 
<a name="l00720"></a>00720         r0[0] = MAT(m, 0, 0), r0[1] = MAT(m, 0, 1),
<a name="l00721"></a>00721                 r0[2] = MAT(m, 0, 2), r0[3] = MAT(m, 0, 3),
<a name="l00722"></a>00722                 r0[4] = 1.0, r0[5] = r0[6] = r0[7] = 0.0,
<a name="l00723"></a>00723                 r1[0] = MAT(m, 1, 0), r1[1] = MAT(m, 1, 1),
<a name="l00724"></a>00724                 r1[2] = MAT(m, 1, 2), r1[3] = MAT(m, 1, 3),
<a name="l00725"></a>00725                 r1[5] = 1.0, r1[4] = r1[6] = r1[7] = 0.0,
<a name="l00726"></a>00726                 r2[0] = MAT(m, 2, 0), r2[1] = MAT(m, 2, 1),
<a name="l00727"></a>00727                 r2[2] = MAT(m, 2, 2), r2[3] = MAT(m, 2, 3),
<a name="l00728"></a>00728                 r2[6] = 1.0, r2[4] = r2[5] = r2[7] = 0.0,
<a name="l00729"></a>00729                 r3[0] = MAT(m, 3, 0), r3[1] = MAT(m, 3, 1),
<a name="l00730"></a>00730                 r3[2] = MAT(m, 3, 2), r3[3] = MAT(m, 3, 3),
<a name="l00731"></a>00731                 r3[7] = 1.0, r3[4] = r3[5] = r3[6] = 0.0;
<a name="l00732"></a>00732 
<a name="l00733"></a>00733         <span class="comment">/* choose pivot - or die */</span>
<a name="l00734"></a>00734         <span class="keywordflow">if</span> (fabs(r3[0]) &gt; fabs(r2[0]))
<a name="l00735"></a>00735                 SWAP_ROWS(r3, r2);
<a name="l00736"></a>00736         <span class="keywordflow">if</span> (fabs(r2[0]) &gt; fabs(r1[0]))
<a name="l00737"></a>00737                 SWAP_ROWS(r2, r1);
<a name="l00738"></a>00738         <span class="keywordflow">if</span> (fabs(r1[0]) &gt; fabs(r0[0]))
<a name="l00739"></a>00739                 SWAP_ROWS(r1, r0);
<a name="l00740"></a>00740         <span class="keywordflow">if</span> (0.0 == r0[0])
<a name="l00741"></a>00741                 <span class="keywordflow">return</span> GL_FALSE;
<a name="l00742"></a>00742 
<a name="l00743"></a>00743         <span class="comment">/* eliminate first variable     */</span>
<a name="l00744"></a>00744         m1 = r1[0] / r0[0];
<a name="l00745"></a>00745         m2 = r2[0] / r0[0];
<a name="l00746"></a>00746         m3 = r3[0] / r0[0];
<a name="l00747"></a>00747         s = r0[1];
<a name="l00748"></a>00748         r1[1] -= m1 * <a class="code" href="flash_2GLES_2glext_8h.html#ad585a1393cfa368fa9dc3d8ebff640d5">s</a>;
<a name="l00749"></a>00749         r2[1] -= m2 * <a class="code" href="flash_2GLES_2glext_8h.html#ad585a1393cfa368fa9dc3d8ebff640d5">s</a>;
<a name="l00750"></a>00750         r3[1] -= m3 * <a class="code" href="flash_2GLES_2glext_8h.html#ad585a1393cfa368fa9dc3d8ebff640d5">s</a>;
<a name="l00751"></a>00751         s = r0[2];
<a name="l00752"></a>00752         r1[2] -= m1 * <a class="code" href="flash_2GLES_2glext_8h.html#ad585a1393cfa368fa9dc3d8ebff640d5">s</a>;
<a name="l00753"></a>00753         r2[2] -= m2 * <a class="code" href="flash_2GLES_2glext_8h.html#ad585a1393cfa368fa9dc3d8ebff640d5">s</a>;
<a name="l00754"></a>00754         r3[2] -= m3 * <a class="code" href="flash_2GLES_2glext_8h.html#ad585a1393cfa368fa9dc3d8ebff640d5">s</a>;
<a name="l00755"></a>00755         s = r0[3];
<a name="l00756"></a>00756         r1[3] -= m1 * <a class="code" href="flash_2GLES_2glext_8h.html#ad585a1393cfa368fa9dc3d8ebff640d5">s</a>;
<a name="l00757"></a>00757         r2[3] -= m2 * <a class="code" href="flash_2GLES_2glext_8h.html#ad585a1393cfa368fa9dc3d8ebff640d5">s</a>;
<a name="l00758"></a>00758         r3[3] -= m3 * <a class="code" href="flash_2GLES_2glext_8h.html#ad585a1393cfa368fa9dc3d8ebff640d5">s</a>;
<a name="l00759"></a>00759         s = r0[4];
<a name="l00760"></a>00760         <span class="keywordflow">if</span> (s != 0.0) {
<a name="l00761"></a>00761                 r1[4] -= m1 * <a class="code" href="flash_2GLES_2glext_8h.html#ad585a1393cfa368fa9dc3d8ebff640d5">s</a>;
<a name="l00762"></a>00762                 r2[4] -= m2 * <a class="code" href="flash_2GLES_2glext_8h.html#ad585a1393cfa368fa9dc3d8ebff640d5">s</a>;
<a name="l00763"></a>00763                 r3[4] -= m3 * <a class="code" href="flash_2GLES_2glext_8h.html#ad585a1393cfa368fa9dc3d8ebff640d5">s</a>;
<a name="l00764"></a>00764         }
<a name="l00765"></a>00765         s = r0[5];
<a name="l00766"></a>00766         <span class="keywordflow">if</span> (s != 0.0) {
<a name="l00767"></a>00767                 r1[5] -= m1 * <a class="code" href="flash_2GLES_2glext_8h.html#ad585a1393cfa368fa9dc3d8ebff640d5">s</a>;
<a name="l00768"></a>00768                 r2[5] -= m2 * <a class="code" href="flash_2GLES_2glext_8h.html#ad585a1393cfa368fa9dc3d8ebff640d5">s</a>;
<a name="l00769"></a>00769                 r3[5] -= m3 * <a class="code" href="flash_2GLES_2glext_8h.html#ad585a1393cfa368fa9dc3d8ebff640d5">s</a>;
<a name="l00770"></a>00770         }
<a name="l00771"></a>00771         s = r0[6];
<a name="l00772"></a>00772         <span class="keywordflow">if</span> (s != 0.0) {
<a name="l00773"></a>00773                 r1[6] -= m1 * <a class="code" href="flash_2GLES_2glext_8h.html#ad585a1393cfa368fa9dc3d8ebff640d5">s</a>;
<a name="l00774"></a>00774                 r2[6] -= m2 * <a class="code" href="flash_2GLES_2glext_8h.html#ad585a1393cfa368fa9dc3d8ebff640d5">s</a>;
<a name="l00775"></a>00775                 r3[6] -= m3 * <a class="code" href="flash_2GLES_2glext_8h.html#ad585a1393cfa368fa9dc3d8ebff640d5">s</a>;
<a name="l00776"></a>00776         }
<a name="l00777"></a>00777         s = r0[7];
<a name="l00778"></a>00778         <span class="keywordflow">if</span> (s != 0.0) {
<a name="l00779"></a>00779                 r1[7] -= m1 * <a class="code" href="flash_2GLES_2glext_8h.html#ad585a1393cfa368fa9dc3d8ebff640d5">s</a>;
<a name="l00780"></a>00780                 r2[7] -= m2 * <a class="code" href="flash_2GLES_2glext_8h.html#ad585a1393cfa368fa9dc3d8ebff640d5">s</a>;
<a name="l00781"></a>00781                 r3[7] -= m3 * <a class="code" href="flash_2GLES_2glext_8h.html#ad585a1393cfa368fa9dc3d8ebff640d5">s</a>;
<a name="l00782"></a>00782         }
<a name="l00783"></a>00783 
<a name="l00784"></a>00784         <span class="comment">/* choose pivot - or die */</span>
<a name="l00785"></a>00785         <span class="keywordflow">if</span> (fabs(r3[1]) &gt; fabs(r2[1]))
<a name="l00786"></a>00786                 SWAP_ROWS(r3, r2);
<a name="l00787"></a>00787         <span class="keywordflow">if</span> (fabs(r2[1]) &gt; fabs(r1[1]))
<a name="l00788"></a>00788                 SWAP_ROWS(r2, r1);
<a name="l00789"></a>00789         <span class="keywordflow">if</span> (0.0 == r1[1])
<a name="l00790"></a>00790                 <span class="keywordflow">return</span> GL_FALSE;
<a name="l00791"></a>00791 
<a name="l00792"></a>00792         <span class="comment">/* eliminate second variable */</span>
<a name="l00793"></a>00793         m2 = r2[1] / r1[1];
<a name="l00794"></a>00794         m3 = r3[1] / r1[1];
<a name="l00795"></a>00795         r2[2] -= m2 * r1[2];
<a name="l00796"></a>00796         r3[2] -= m3 * r1[2];
<a name="l00797"></a>00797         r2[3] -= m2 * r1[3];
<a name="l00798"></a>00798         r3[3] -= m3 * r1[3];
<a name="l00799"></a>00799         s = r1[4];
<a name="l00800"></a>00800         <span class="keywordflow">if</span> (0.0 != s) {
<a name="l00801"></a>00801                 r2[4] -= m2 * <a class="code" href="flash_2GLES_2glext_8h.html#ad585a1393cfa368fa9dc3d8ebff640d5">s</a>;
<a name="l00802"></a>00802                 r3[4] -= m3 * <a class="code" href="flash_2GLES_2glext_8h.html#ad585a1393cfa368fa9dc3d8ebff640d5">s</a>;
<a name="l00803"></a>00803         }
<a name="l00804"></a>00804         s = r1[5];
<a name="l00805"></a>00805         <span class="keywordflow">if</span> (0.0 != s) {
<a name="l00806"></a>00806                 r2[5] -= m2 * <a class="code" href="flash_2GLES_2glext_8h.html#ad585a1393cfa368fa9dc3d8ebff640d5">s</a>;
<a name="l00807"></a>00807                 r3[5] -= m3 * <a class="code" href="flash_2GLES_2glext_8h.html#ad585a1393cfa368fa9dc3d8ebff640d5">s</a>;
<a name="l00808"></a>00808         }
<a name="l00809"></a>00809         s = r1[6];
<a name="l00810"></a>00810         <span class="keywordflow">if</span> (0.0 != s) {
<a name="l00811"></a>00811                 r2[6] -= m2 * <a class="code" href="flash_2GLES_2glext_8h.html#ad585a1393cfa368fa9dc3d8ebff640d5">s</a>;
<a name="l00812"></a>00812                 r3[6] -= m3 * <a class="code" href="flash_2GLES_2glext_8h.html#ad585a1393cfa368fa9dc3d8ebff640d5">s</a>;
<a name="l00813"></a>00813         }
<a name="l00814"></a>00814         s = r1[7];
<a name="l00815"></a>00815         <span class="keywordflow">if</span> (0.0 != s) {
<a name="l00816"></a>00816                 r2[7] -= m2 * <a class="code" href="flash_2GLES_2glext_8h.html#ad585a1393cfa368fa9dc3d8ebff640d5">s</a>;
<a name="l00817"></a>00817                 r3[7] -= m3 * <a class="code" href="flash_2GLES_2glext_8h.html#ad585a1393cfa368fa9dc3d8ebff640d5">s</a>;
<a name="l00818"></a>00818         }
<a name="l00819"></a>00819 
<a name="l00820"></a>00820         <span class="comment">/* choose pivot - or die */</span>
<a name="l00821"></a>00821         <span class="keywordflow">if</span> (fabs(r3[2]) &gt; fabs(r2[2]))
<a name="l00822"></a>00822                 SWAP_ROWS(r3, r2);
<a name="l00823"></a>00823         <span class="keywordflow">if</span> (0.0 == r2[2])
<a name="l00824"></a>00824                 <span class="keywordflow">return</span> GL_FALSE;
<a name="l00825"></a>00825 
<a name="l00826"></a>00826         <span class="comment">/* eliminate third variable */</span>
<a name="l00827"></a>00827         m3 = r3[2] / r2[2];
<a name="l00828"></a>00828         r3[3] -= m3 * r2[3], r3[4] -= m3 * r2[4],
<a name="l00829"></a>00829                 r3[5] -= m3 * r2[5], r3[6] -= m3 * r2[6], r3[7] -= m3 * r2[7];
<a name="l00830"></a>00830 
<a name="l00831"></a>00831         <span class="comment">/* last check */</span>
<a name="l00832"></a>00832         <span class="keywordflow">if</span> (0.0 == r3[3])
<a name="l00833"></a>00833                 <span class="keywordflow">return</span> GL_FALSE;
<a name="l00834"></a>00834 
<a name="l00835"></a>00835         s = 1.0f / r3[3];               <span class="comment">/* now back substitute row 3 */</span>
<a name="l00836"></a>00836         r3[4] *= <a class="code" href="flash_2GLES_2glext_8h.html#ad585a1393cfa368fa9dc3d8ebff640d5">s</a>;
<a name="l00837"></a>00837         r3[5] *= <a class="code" href="flash_2GLES_2glext_8h.html#ad585a1393cfa368fa9dc3d8ebff640d5">s</a>;
<a name="l00838"></a>00838         r3[6] *= <a class="code" href="flash_2GLES_2glext_8h.html#ad585a1393cfa368fa9dc3d8ebff640d5">s</a>;
<a name="l00839"></a>00839         r3[7] *= <a class="code" href="flash_2GLES_2glext_8h.html#ad585a1393cfa368fa9dc3d8ebff640d5">s</a>;
<a name="l00840"></a>00840 
<a name="l00841"></a>00841         m2 = r2[3];                     <span class="comment">/* now back substitute row 2 */</span>
<a name="l00842"></a>00842         s = 1.0f / r2[2];
<a name="l00843"></a>00843         r2[4] = s * (r2[4] - r3[4] * m2), r2[5] = s * (r2[5] - r3[5] * m2),
<a name="l00844"></a>00844                 r2[6] = s * (r2[6] - r3[6] * m2), r2[7] = s * (r2[7] - r3[7] * m2);
<a name="l00845"></a>00845         m1 = r1[3];
<a name="l00846"></a>00846         r1[4] -= r3[4] * m1, r1[5] -= r3[5] * m1,
<a name="l00847"></a>00847                 r1[6] -= r3[6] * m1, r1[7] -= r3[7] * m1;
<a name="l00848"></a>00848         m0 = r0[3];
<a name="l00849"></a>00849         r0[4] -= r3[4] * m0, r0[5] -= r3[5] * m0,
<a name="l00850"></a>00850                 r0[6] -= r3[6] * m0, r0[7] -= r3[7] * m0;
<a name="l00851"></a>00851 
<a name="l00852"></a>00852         m1 = r1[2];                     <span class="comment">/* now back substitute row 1 */</span>
<a name="l00853"></a>00853         s = 1.0f / r1[1];
<a name="l00854"></a>00854         r1[4] = s * (r1[4] - r2[4] * m1), r1[5] = s * (r1[5] - r2[5] * m1),
<a name="l00855"></a>00855                 r1[6] = s * (r1[6] - r2[6] * m1), r1[7] = s * (r1[7] - r2[7] * m1);
<a name="l00856"></a>00856         m0 = r0[2];
<a name="l00857"></a>00857         r0[4] -= r2[4] * m0, r0[5] -= r2[5] * m0,
<a name="l00858"></a>00858                 r0[6] -= r2[6] * m0, r0[7] -= r2[7] * m0;
<a name="l00859"></a>00859 
<a name="l00860"></a>00860         m0 = r0[1];                     <span class="comment">/* now back substitute row 0 */</span>
<a name="l00861"></a>00861         s = 1.0f / r0[0];
<a name="l00862"></a>00862         r0[4] = s * (r0[4] - r1[4] * m0), r0[5] = s * (r0[5] - r1[5] * m0),
<a name="l00863"></a>00863                 r0[6] = s * (r0[6] - r1[6] * m0), r0[7] = s * (r0[7] - r1[7] * m0);
<a name="l00864"></a>00864 
<a name="l00865"></a>00865         MAT(out, 0, 0) = r0[4];
<a name="l00866"></a>00866         MAT(out, 0, 1) = r0[5], MAT(out, 0, 2) = r0[6];
<a name="l00867"></a>00867         MAT(out, 0, 3) = r0[7], MAT(out, 1, 0) = r1[4];
<a name="l00868"></a>00868         MAT(out, 1, 1) = r1[5], MAT(out, 1, 2) = r1[6];
<a name="l00869"></a>00869         MAT(out, 1, 3) = r1[7], MAT(out, 2, 0) = r2[4];
<a name="l00870"></a>00870         MAT(out, 2, 1) = r2[5], MAT(out, 2, 2) = r2[6];
<a name="l00871"></a>00871         MAT(out, 2, 3) = r2[7], MAT(out, 3, 0) = r3[4];
<a name="l00872"></a>00872         MAT(out, 3, 1) = r3[5], MAT(out, 3, 2) = r3[6];
<a name="l00873"></a>00873         MAT(out, 3, 3) = r3[7];
<a name="l00874"></a>00874 
<a name="l00875"></a>00875         <span class="keywordflow">return</span> GL_TRUE;
<a name="l00876"></a>00876 
<a name="l00877"></a>00877 <span class="preprocessor">#undef MAT</span>
<a name="l00878"></a>00878 <span class="preprocessor"></span><span class="preprocessor">#undef SWAP_ROWS</span>
<a name="l00879"></a>00879 <span class="preprocessor"></span>}
<a name="l00880"></a>00880 
<a name="l00881"></a>00881 
<a name="l00882"></a>00882 
<a name="l00883"></a>00883 <span class="comment">/* projection du point (objx,objy,obz) sur l&#39;ecran (winx,winy,winz) */</span>
<a name="l00884"></a><a class="code" href="GLESUtils_8cpp.html#a00c33e8973076efea2a039b4fbd2ace8">00884</a> <a class="code" href="flash_2GLES_2gl_8h.html#acebcc1c5663f14ebde1d16831e5fed94">GLint</a> <a class="code" href="GLESUtils_8cpp.html#a00c33e8973076efea2a039b4fbd2ace8">gluProject</a>(<a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> objx, <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> objy, <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> objz,
<a name="l00885"></a>00885                    <span class="keyword">const</span> <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> model[16], <span class="keyword">const</span> <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> proj[16],
<a name="l00886"></a>00886                    <span class="keyword">const</span> <a class="code" href="flash_2GLES_2gl_8h.html#acebcc1c5663f14ebde1d16831e5fed94">GLint</a> viewport[4],
<a name="l00887"></a>00887                    <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> * winx, <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> * winy, <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> * winz)
<a name="l00888"></a>00888 {
<a name="l00889"></a>00889         <span class="comment">/* matrice de transformation */</span>
<a name="l00890"></a>00890         <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> <a class="code" href="Renderer_2GL_2glext_8h.html#a83ad0ee7f1e06b59c90271716e689080">in</a>[4], out[4];
<a name="l00891"></a>00891 
<a name="l00892"></a>00892         <span class="comment">/* initilise la matrice et le vecteur a transformer */</span>
<a name="l00893"></a>00893         in[0] = objx;
<a name="l00894"></a>00894         in[1] = objy;
<a name="l00895"></a>00895         in[2] = objz;
<a name="l00896"></a>00896         in[3] = 1.0;
<a name="l00897"></a>00897         <a class="code" href="GLESUtils_8cpp.html#a8140c44e1a3b7a6ce5c5484388109bf0">transform_point</a>(out, model, in);
<a name="l00898"></a>00898         <a class="code" href="GLESUtils_8cpp.html#a8140c44e1a3b7a6ce5c5484388109bf0">transform_point</a>(in, proj, out);
<a name="l00899"></a>00899 
<a name="l00900"></a>00900         <span class="comment">/* d&#39;ou le resultat normalise entre -1 et 1 */</span>
<a name="l00901"></a>00901         <span class="keywordflow">if</span> (in[3] == 0.0)
<a name="l00902"></a>00902                 <span class="keywordflow">return</span> GL_FALSE;
<a name="l00903"></a>00903 
<a name="l00904"></a>00904         in[0] /= in[3];
<a name="l00905"></a>00905         in[1] /= in[3];
<a name="l00906"></a>00906         in[2] /= in[3];
<a name="l00907"></a>00907 
<a name="l00908"></a>00908         <span class="comment">/* en coordonnees ecran */</span>
<a name="l00909"></a>00909         *winx = viewport[0] + (1 + in[0]) * viewport[2] / 2;
<a name="l00910"></a>00910         *winy = viewport[1] + (1 + in[1]) * viewport[3] / 2;
<a name="l00911"></a>00911         <span class="comment">/* entre 0 et 1 suivant z */</span>
<a name="l00912"></a>00912         *winz = (1 + in[2]) / 2;
<a name="l00913"></a>00913         <span class="keywordflow">return</span> GL_TRUE;
<a name="l00914"></a>00914 }
<a name="l00915"></a>00915 
<a name="l00916"></a>00916 
<a name="l00917"></a>00917 
<a name="l00918"></a>00918 <span class="comment">/* transformation du point ecran (winx,winy,winz) en point objet */</span>
<a name="l00919"></a><a class="code" href="GLESUtils_8h.html#af2cfa6fbf2078b97114e5f643cf39643">00919</a> <a class="code" href="flash_2GLES_2gl_8h.html#acebcc1c5663f14ebde1d16831e5fed94">GLint</a> <a class="code" href="GLESUtils_8cpp.html#aef0980daf29dfe0e66a46ebb11984542">gluUnProject</a>(<a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> winx, <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> winy, <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> winz,
<a name="l00920"></a>00920                          <span class="keyword">const</span> <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> model[16], <span class="keyword">const</span> <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> proj[16],
<a name="l00921"></a>00921                          <span class="keyword">const</span> <a class="code" href="flash_2GLES_2gl_8h.html#acebcc1c5663f14ebde1d16831e5fed94">GLint</a> viewport[4],
<a name="l00922"></a>00922                          <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> * objx, <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> * objy, <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> * objz)
<a name="l00923"></a>00923 {
<a name="l00924"></a>00924         <span class="comment">/* matrice de transformation */</span>
<a name="l00925"></a>00925         <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> <a class="code" href="Renderer_2GL_2glext_8h.html#af593500c283bf1a787a6f947f503a5c2">m</a>[16], A[16];
<a name="l00926"></a>00926         <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> <a class="code" href="Renderer_2GL_2glext_8h.html#a83ad0ee7f1e06b59c90271716e689080">in</a>[4], out[4];
<a name="l00927"></a>00927 
<a name="l00928"></a>00928         <span class="comment">/* transformation coordonnees normalisees entre -1 et 1 */</span>
<a name="l00929"></a>00929         in[0] = (winx - viewport[0]) * 2 / viewport[2] - 1.0<a class="code" href="Renderer_2GL_2glext_8h.html#aba8ad56949f59242bc167b073dae3715">f</a>;
<a name="l00930"></a>00930         in[1] = (winy - viewport[1]) * 2 / viewport[3] - 1.0<a class="code" href="Renderer_2GL_2glext_8h.html#aba8ad56949f59242bc167b073dae3715">f</a>;
<a name="l00931"></a>00931         in[2] = 2 * winz - 1.0f;
<a name="l00932"></a>00932         in[3] = 1.0f;
<a name="l00933"></a>00933 
<a name="l00934"></a>00934         <span class="comment">/* calcul transformation inverse */</span>
<a name="l00935"></a>00935         <a class="code" href="GLESUtils_8cpp.html#a43666c60d1b7c59ee050524780ba831f">matmul</a>(A, proj, model);
<a name="l00936"></a>00936         <a class="code" href="GLESUtils_8cpp.html#a110c83c633db7bf415bd14e6c7550fcb">invert_matrix</a>(A, m);
<a name="l00937"></a>00937 
<a name="l00938"></a>00938         <span class="comment">/* d&#39;ou les coordonnees objets */</span>
<a name="l00939"></a>00939         <a class="code" href="GLESUtils_8cpp.html#a8140c44e1a3b7a6ce5c5484388109bf0">transform_point</a>(out, m, in);
<a name="l00940"></a>00940         <span class="keywordflow">if</span> (out[3] == 0.0)
<a name="l00941"></a>00941                 <span class="keywordflow">return</span> GL_FALSE;
<a name="l00942"></a>00942         *objx = out[0] / out[3];
<a name="l00943"></a>00943         *objy = out[1] / out[3];
<a name="l00944"></a>00944         *objz = out[2] / out[3];
<a name="l00945"></a>00945         <span class="keywordflow">return</span> GL_TRUE;
<a name="l00946"></a>00946 }
<a name="l00947"></a>00947 
<a name="l00948"></a>00948 
<a name="l00949"></a>00949 <span class="comment">/*</span>
<a name="l00950"></a>00950 <span class="comment">* New in GLU 1.3</span>
<a name="l00951"></a>00951 <span class="comment">* This is like gluUnProject but also takes near and far DepthRange values.</span>
<a name="l00952"></a>00952 <span class="comment">*/</span>
<a name="l00953"></a>00953 
<a name="l00954"></a><a class="code" href="GLESUtils_8cpp.html#a513c6b561289d1348fa40321a1f8fcc6">00954</a> <a class="code" href="flash_2GLES_2gl_8h.html#acebcc1c5663f14ebde1d16831e5fed94">GLint</a> <a class="code" href="GLESUtils_8cpp.html#a513c6b561289d1348fa40321a1f8fcc6">gluUnProject4</a>(<a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> winx, <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> winy, <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> winz, <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> clipw,
<a name="l00955"></a>00955                           <span class="keyword">const</span> <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> modelMatrix[16],
<a name="l00956"></a>00956                           <span class="keyword">const</span> <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> projMatrix[16],
<a name="l00957"></a>00957                           <span class="keyword">const</span> <a class="code" href="flash_2GLES_2gl_8h.html#acebcc1c5663f14ebde1d16831e5fed94">GLint</a> viewport[4],
<a name="l00958"></a>00958                           <a class="code" href="flash_2GLES_2gl_8h.html#af387aa958960231c80566b243bd2c641">GLclampf</a> nearZ, <a class="code" href="flash_2GLES_2gl_8h.html#af387aa958960231c80566b243bd2c641">GLclampf</a> farZ,
<a name="l00959"></a>00959                           <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> * objx, <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> * objy, <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> * objz,
<a name="l00960"></a>00960                           <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> * objw)
<a name="l00961"></a>00961 {
<a name="l00962"></a>00962         <span class="comment">/* matrice de transformation */</span>
<a name="l00963"></a>00963         <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> <a class="code" href="Renderer_2GL_2glext_8h.html#af593500c283bf1a787a6f947f503a5c2">m</a>[16], A[16];
<a name="l00964"></a>00964         <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> <a class="code" href="Renderer_2GL_2glext_8h.html#a83ad0ee7f1e06b59c90271716e689080">in</a>[4], out[4];
<a name="l00965"></a>00965         <a class="code" href="flash_2GLES_2gl_8h.html#a836cf6377099e88abf24c255b5b0ac52">GLfloat</a> <a class="code" href="flash_2GLES_2glext_8h.html#afbd8e4152e83f10b9242ae1e7a71cb0b">z</a> = nearZ + winz * (farZ - nearZ);
<a name="l00966"></a>00966 
<a name="l00967"></a>00967         <span class="comment">/* transformation coordonnees normalisees entre -1 et 1 */</span>
<a name="l00968"></a>00968         in[0] = (winx - viewport[0]) * 2 / viewport[2] - 1.0<a class="code" href="Renderer_2GL_2glext_8h.html#aba8ad56949f59242bc167b073dae3715">f</a>;
<a name="l00969"></a>00969         in[1] = (winy - viewport[1]) * 2 / viewport[3] - 1.0<a class="code" href="Renderer_2GL_2glext_8h.html#aba8ad56949f59242bc167b073dae3715">f</a>;
<a name="l00970"></a>00970         in[2] = 2.0f * z - 1.0f;
<a name="l00971"></a>00971         in[3] = clipw;
<a name="l00972"></a>00972 
<a name="l00973"></a>00973         <span class="comment">/* calcul transformation inverse */</span>
<a name="l00974"></a>00974         <a class="code" href="GLESUtils_8cpp.html#a43666c60d1b7c59ee050524780ba831f">matmul</a>(A, projMatrix, modelMatrix);
<a name="l00975"></a>00975         <a class="code" href="GLESUtils_8cpp.html#a110c83c633db7bf415bd14e6c7550fcb">invert_matrix</a>(A, m);
<a name="l00976"></a>00976 
<a name="l00977"></a>00977         <span class="comment">/* d&#39;ou les coordonnees objets */</span>
<a name="l00978"></a>00978         <a class="code" href="GLESUtils_8cpp.html#a8140c44e1a3b7a6ce5c5484388109bf0">transform_point</a>(out, m, in);
<a name="l00979"></a>00979         <span class="keywordflow">if</span> (out[3] == 0.0)
<a name="l00980"></a>00980                 <span class="keywordflow">return</span> GL_FALSE;
<a name="l00981"></a>00981         *objx = out[0] / out[3];
<a name="l00982"></a>00982         *objy = out[1] / out[3];
<a name="l00983"></a>00983         *objz = out[2] / out[3];
<a name="l00984"></a>00984         *objw = out[3];
<a name="l00985"></a>00985         <span class="keywordflow">return</span> GL_TRUE;
<a name="l00986"></a>00986 }
<a name="l00987"></a>00987 
<a name="l00988"></a><a class="code" href="GLESUtils_8h.html#a53eeaf69cc8e728ba3142e2f32b7812f">00988</a> <span class="keywordtype">float</span> <a class="code" href="GLESUtils_8cpp.html#a53eeaf69cc8e728ba3142e2f32b7812f">GetOrthoRenderSizeXf</a>()
<a name="l00989"></a>00989 {
<a name="l00990"></a>00990         <span class="keywordflow">return</span> <a class="code" href="GLESUtils_8cpp.html#a38deb7f34428741e2d3c1c635fb68e43">g_renderOrthoRenderSizeX</a>;
<a name="l00991"></a>00991 }
<a name="l00992"></a>00992 
<a name="l00993"></a><a class="code" href="GLESUtils_8h.html#a45e5c79ef6e83cc998fd8b6be83f2e1a">00993</a> <span class="keywordtype">float</span> <a class="code" href="GLESUtils_8cpp.html#a45e5c79ef6e83cc998fd8b6be83f2e1a">GetOrthoRenderSizeYf</a>()
<a name="l00994"></a>00994 {
<a name="l00995"></a>00995         <span class="keywordflow">return</span> <a class="code" href="GLESUtils_8cpp.html#acf46e869b557a68225eb92905ea30d32">g_renderOrthoRenderSizeY</a>;
<a name="l00996"></a>00996 }
</pre></div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Thu May 2 2013 17:17:06 for Proton by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
