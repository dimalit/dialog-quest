<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Proton: InputTextRenderComponent.cpp Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Proton
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_b4959094aa2649f063000bebf8111065.html">shared</a>      </li>
      <li class="navelem"><a class="el" href="dir_2b403b5300fc0d4500f921b8344bec5b.html">Entity</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">InputTextRenderComponent.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="InputTextRenderComponent_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include &quot;<a class="code" href="PlatformPrecomp_8h.html">PlatformPrecomp.h</a>&quot;</span>
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="preprocessor">#include &quot;<a class="code" href="InputTextRenderComponent_8h.html">InputTextRenderComponent.h</a>&quot;</span>
<a name="l00004"></a>00004 <span class="preprocessor">#include &quot;<a class="code" href="BaseApp_8h.html">BaseApp.h</a>&quot;</span>
<a name="l00005"></a>00005 
<a name="l00006"></a><a class="code" href="classInputTextRenderComponent.html#a56f3b70e2ec6f83fc5eb28a2f9fff85c">00006</a> <a class="code" href="classInputTextRenderComponent.html#a56f3b70e2ec6f83fc5eb28a2f9fff85c">InputTextRenderComponent::InputTextRenderComponent</a>()
<a name="l00007"></a>00007 {
<a name="l00008"></a>00008         <a class="code" href="classEntityComponent.html#ae7a07a0d82df6fc9a33b7bb72b3d7be8">SetName</a>(<span class="stringliteral">&quot;InputTextRender&quot;</span>);
<a name="l00009"></a>00009 }
<a name="l00010"></a>00010 
<a name="l00011"></a><a class="code" href="classInputTextRenderComponent.html#ad52351cb804c6ec4cbd3fe58eefb2a8b">00011</a> <a class="code" href="classInputTextRenderComponent.html#ad52351cb804c6ec4cbd3fe58eefb2a8b">InputTextRenderComponent::~InputTextRenderComponent</a>()
<a name="l00012"></a>00012 {
<a name="l00013"></a>00013         <span class="comment">//BigB&#39;s change</span>
<a name="l00014"></a>00014         <span class="keywordflow">if</span> (<a class="code" href="RenderUtils_8cpp.html#a9b659f82b574d9616f26bb3131b66e09">GetEntityWithNativeUIFocus</a>() == <a class="code" href="classEntityComponent.html#a1f7f2527931a1ee880178e1587e997b5">GetParent</a>())
<a name="l00015"></a>00015         {
<a name="l00016"></a>00016                 <a class="code" href="classEntityComponent.html#aec128263d40de70312fa334b12138643">GetFunction</a>(<span class="stringliteral">&quot;CloseKeyboard&quot;</span>)-&gt;<a class="code" href="classFunctionObject.html#abfd6ae66d3b358d20aaab70d861e57e7">sig_function</a>(NULL);
<a name="l00017"></a>00017         } <span class="keywordflow">else</span>
<a name="l00018"></a>00018         {
<a name="l00019"></a>00019                 <span class="keywordflow">if</span> (<a class="code" href="RenderUtils_8cpp.html#aed0a0b710950a1a867d83377921b1235">GetIsUsingNativeUI</a>())
<a name="l00020"></a>00020                 {
<a name="l00021"></a>00021                         <a class="code" href="AndroidUtils_8cpp.html#aaa5c9bf2289dec09f59ef2b7ba6c66ae">LogMsg</a>(<span class="stringliteral">&quot;Keyboard is active, but proton isn&#39;t closing it because it doesn&#39;t look like this InputTextRenderComponent has focus.&quot;</span>);
<a name="l00022"></a>00022                 }
<a name="l00023"></a>00023         }
<a name="l00024"></a>00024 }
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 
<a name="l00027"></a><a class="code" href="classInputTextRenderComponent.html#abf013da1bfd5a3d45287ece65a8511bf">00027</a> <span class="keywordtype">void</span> <a class="code" href="classInputTextRenderComponent.html#abf013da1bfd5a3d45287ece65a8511bf">InputTextRenderComponent::OnAdd</a>(<a class="code" href="classEntity.html">Entity</a> *pEnt)
<a name="l00028"></a>00028 {
<a name="l00029"></a>00029         <a class="code" href="classInputTextRenderComponent.html#abf013da1bfd5a3d45287ece65a8511bf">EntityComponent::OnAdd</a>(pEnt);
<a name="l00030"></a>00030 
<a name="l00031"></a>00031         <span class="comment">//shared with the rest of the entity</span>
<a name="l00032"></a>00032         m_pPos2d = &amp;<a class="code" href="classEntityComponent.html#a1f7f2527931a1ee880178e1587e997b5">GetParent</a>()-&gt;<a class="code" href="classEntity.html#ae244d907956ed32fb3b9d399e3fa1d2a" title="Gets a named Variant from this Entity&#39;s variant DB.">GetVar</a>(<span class="stringliteral">&quot;pos2d&quot;</span>)-&gt;<a class="code" href="classVariant.html#a623fdb9f51669ff8bfda1b6b268bbaa6">GetVector2</a>();
<a name="l00033"></a>00033         m_pSize2d = &amp;<a class="code" href="classEntityComponent.html#a1f7f2527931a1ee880178e1587e997b5">GetParent</a>()-&gt;<a class="code" href="classEntity.html#ae244d907956ed32fb3b9d399e3fa1d2a" title="Gets a named Variant from this Entity&#39;s variant DB.">GetVar</a>(<span class="stringliteral">&quot;size2d&quot;</span>)-&gt;<a class="code" href="classVariant.html#a623fdb9f51669ff8bfda1b6b268bbaa6">GetVector2</a>();
<a name="l00034"></a>00034         m_pScale2d = &amp;<a class="code" href="classEntityComponent.html#a1f7f2527931a1ee880178e1587e997b5">GetParent</a>()-&gt;<a class="code" href="classEntity.html#a62ab472f90722bb07b43f632bcd3584b" title="Gets a named Variant from this Entity&#39;s variant DB.">GetVarWithDefault</a>(<span class="stringliteral">&quot;scale2d&quot;</span>, <a class="code" href="classVariant.html">Variant</a>(1.0<a class="code" href="Renderer_2GL_2glext_8h.html#aba8ad56949f59242bc167b073dae3715">f</a>, 1.0<a class="code" href="Renderer_2GL_2glext_8h.html#aba8ad56949f59242bc167b073dae3715">f</a>))-&gt;<a class="code" href="classVariant.html#a623fdb9f51669ff8bfda1b6b268bbaa6">GetVector2</a>();
<a name="l00035"></a>00035         m_pAlignment = &amp;<a class="code" href="classEntityComponent.html#a1f7f2527931a1ee880178e1587e997b5">GetParent</a>()-&gt;<a class="code" href="classEntity.html#ae244d907956ed32fb3b9d399e3fa1d2a" title="Gets a named Variant from this Entity&#39;s variant DB.">GetVar</a>(<span class="stringliteral">&quot;alignment&quot;</span>)-&gt;<a class="code" href="classVariant.html#a02c9fa88617102d1efcb991626cda39d">GetUINT32</a>();
<a name="l00036"></a>00036         m_pColor = &amp;<a class="code" href="classEntityComponent.html#a1f7f2527931a1ee880178e1587e997b5">GetParent</a>()-&gt;<a class="code" href="classEntity.html#a62ab472f90722bb07b43f632bcd3584b" title="Gets a named Variant from this Entity&#39;s variant DB.">GetVarWithDefault</a>(<span class="stringliteral">&quot;color&quot;</span>, <a class="code" href="classVariant.html">Variant</a>(MAKE_RGBA(255,255,255,255)))-&gt;<a class="code" href="classVariant.html#a02c9fa88617102d1efcb991626cda39d">GetUINT32</a>();
<a name="l00037"></a>00037         m_pColorMod = &amp;<a class="code" href="classEntityComponent.html#a1f7f2527931a1ee880178e1587e997b5">GetParent</a>()-&gt;<a class="code" href="classEntity.html#a62ab472f90722bb07b43f632bcd3584b" title="Gets a named Variant from this Entity&#39;s variant DB.">GetVarWithDefault</a>(<span class="stringliteral">&quot;colorMod&quot;</span>, <a class="code" href="classVariant.html">Variant</a>(MAKE_RGBA(255,255,255,255)))-&gt;<a class="code" href="classVariant.html#a02c9fa88617102d1efcb991626cda39d">GetUINT32</a>();
<a name="l00038"></a>00038         m_pAlpha = &amp;<a class="code" href="classEntityComponent.html#a1f7f2527931a1ee880178e1587e997b5">GetParent</a>()-&gt;<a class="code" href="classEntity.html#a62ab472f90722bb07b43f632bcd3584b" title="Gets a named Variant from this Entity&#39;s variant DB.">GetVarWithDefault</a>(<span class="stringliteral">&quot;alpha&quot;</span>, <a class="code" href="classVariant.html">Variant</a>(1.0<a class="code" href="Renderer_2GL_2glext_8h.html#aba8ad56949f59242bc167b073dae3715">f</a>))-&gt;<a class="code" href="classVariant.html#a37b2540d2a848c60a31ea4775892a683">GetFloat</a>();
<a name="l00039"></a>00039 
<a name="l00040"></a>00040         <a class="code" href="classEntityComponent.html#a1f7f2527931a1ee880178e1587e997b5">GetParent</a>()-&gt;<a class="code" href="classEntity.html#a3caca7df803637d92b141daca30f4c3b">GetFunction</a>(<span class="stringliteral">&quot;OnTouchEnd&quot;</span>)-&gt;<a class="code" href="classFunctionObject.html#abfd6ae66d3b358d20aaab70d861e57e7">sig_function</a>.connect(1, boost::bind(&amp;InputTextRenderComponent::OnTouchEnd, <span class="keyword">this</span>, _1));
<a name="l00041"></a>00041         <a class="code" href="classEntityComponent.html#a1f7f2527931a1ee880178e1587e997b5">GetParent</a>()-&gt;<a class="code" href="classEntity.html#a3caca7df803637d92b141daca30f4c3b">GetFunction</a>(<span class="stringliteral">&quot;OnTouchStart&quot;</span>)-&gt;<a class="code" href="classFunctionObject.html#abfd6ae66d3b358d20aaab70d861e57e7">sig_function</a>.connect(1, boost::bind(&amp;InputTextRenderComponent::OnTouchStart, <span class="keyword">this</span>, _1));
<a name="l00042"></a>00042         <a class="code" href="classEntityComponent.html#a1f7f2527931a1ee880178e1587e997b5">GetParent</a>()-&gt;<a class="code" href="classEntity.html#a3caca7df803637d92b141daca30f4c3b">GetFunction</a>(<span class="stringliteral">&quot;OnInput&quot;</span>)-&gt;<a class="code" href="classFunctionObject.html#abfd6ae66d3b358d20aaab70d861e57e7">sig_function</a>.connect(1, boost::bind(&amp;InputTextRenderComponent::OnInput, <span class="keyword">this</span>, _1)); <span class="comment">//used for keyboard keys on Win</span>
<a name="l00043"></a>00043         <a class="code" href="classEntityComponent.html#a1f7f2527931a1ee880178e1587e997b5">GetParent</a>()-&gt;<a class="code" href="classEntity.html#a3caca7df803637d92b141daca30f4c3b">GetFunction</a>(<span class="stringliteral">&quot;OnLosingNativeGUIFocus&quot;</span>)-&gt;<a class="code" href="classFunctionObject.html#abfd6ae66d3b358d20aaab70d861e57e7">sig_function</a>.connect(1, boost::bind(&amp;InputTextRenderComponent::OnLosingNativeGUIFocus, <span class="keyword">this</span>, _1)); 
<a name="l00044"></a>00044         <a class="code" href="classEntityComponent.html#aec128263d40de70312fa334b12138643">GetFunction</a>(<span class="stringliteral">&quot;ActivateKeyboard&quot;</span>)-&gt;<a class="code" href="classFunctionObject.html#abfd6ae66d3b358d20aaab70d861e57e7">sig_function</a>.connect(1, boost::bind(&amp;InputTextRenderComponent::ActivateKeyboard, <span class="keyword">this</span>, _1)); 
<a name="l00045"></a>00045         <a class="code" href="classEntityComponent.html#aec128263d40de70312fa334b12138643">GetFunction</a>(<span class="stringliteral">&quot;CloseKeyboard&quot;</span>)-&gt;<a class="code" href="classFunctionObject.html#abfd6ae66d3b358d20aaab70d861e57e7">sig_function</a>.connect(1, boost::bind(&amp;InputTextRenderComponent::CloseKeyboard, <span class="keyword">this</span>, _1)); 
<a name="l00046"></a>00046         m_pVisible = &amp;<a class="code" href="classEntityComponent.html#a1f7f2527931a1ee880178e1587e997b5">GetParent</a>()-&gt;<a class="code" href="classEntity.html#a62ab472f90722bb07b43f632bcd3584b" title="Gets a named Variant from this Entity&#39;s variant DB.">GetVarWithDefault</a>(<span class="stringliteral">&quot;visible&quot;</span>, <a class="code" href="PlatformSetupAndroid_8h.html#acbd4acd0d29e2d6c43104827f77d9cd2">uint32</a>(1))-&gt;<a class="code" href="classVariant.html#a02c9fa88617102d1efcb991626cda39d">GetUINT32</a>();
<a name="l00047"></a>00047         m_pGetFocusOnEnter = &amp;<a class="code" href="classEntityComponent.html#a442511658233f10576d974409840d6d7">GetVarWithDefault</a>(<span class="stringliteral">&quot;getFocusOnEnter&quot;</span>, <a class="code" href="PlatformSetupAndroid_8h.html#acbd4acd0d29e2d6c43104827f77d9cd2">uint32</a>(0))-&gt;<a class="code" href="classVariant.html#a02c9fa88617102d1efcb991626cda39d">GetUINT32</a>();
<a name="l00048"></a>00048         <a class="code" href="classEntityComponent.html#a1f7f2527931a1ee880178e1587e997b5">GetParent</a>()-&gt;<a class="code" href="classEntity.html#ae244d907956ed32fb3b9d399e3fa1d2a" title="Gets a named Variant from this Entity&#39;s variant DB.">GetVar</a>(<span class="stringliteral">&quot;visible&quot;</span>)-&gt;<a class="code" href="classVariant.html#a3abb77632110a5deaa94d81e0623bd7a">GetSigOnChanged</a>()-&gt;connect(1, boost::bind(&amp;InputTextRenderComponent::OnVisibilityChanged, <span class="keyword">this</span>, _1));
<a name="l00049"></a>00049         m_pHasFocus = &amp;<a class="code" href="classEntityComponent.html#ab98598189ea0c5d0da7231e16bcefde4">GetVar</a>(<span class="stringliteral">&quot;hasFocus&quot;</span>)-&gt;<a class="code" href="classVariant.html#a02c9fa88617102d1efcb991626cda39d">GetUINT32</a>();
<a name="l00050"></a>00050 
<a name="l00051"></a>00051         <span class="comment">//our own stuff</span>
<a name="l00052"></a>00052         m_pDisabled = &amp;<a class="code" href="classEntityComponent.html#a442511658233f10576d974409840d6d7">GetVarWithDefault</a>(<span class="stringliteral">&quot;disabled&quot;</span>, <a class="code" href="PlatformSetupAndroid_8h.html#acbd4acd0d29e2d6c43104827f77d9cd2">uint32</a>(0))-&gt;<a class="code" href="classVariant.html#a02c9fa88617102d1efcb991626cda39d">GetUINT32</a>();
<a name="l00053"></a>00053         <a class="code" href="classEntityComponent.html#ab98598189ea0c5d0da7231e16bcefde4">GetVar</a>(<span class="stringliteral">&quot;disabled&quot;</span>)-&gt;<a class="code" href="classVariant.html#a3abb77632110a5deaa94d81e0623bd7a">GetSigOnChanged</a>()-&gt;connect(1, boost::bind(&amp;InputTextRenderComponent::OnDisabledChanged, <span class="keyword">this</span>, _1));
<a name="l00054"></a>00054         m_pVisualStyle = &amp;<a class="code" href="classEntityComponent.html#a442511658233f10576d974409840d6d7">GetVarWithDefault</a>(<span class="stringliteral">&quot;visualStyle&quot;</span>, <a class="code" href="classVariant.html">Variant</a>(<a class="code" href="PlatformSetupAndroid_8h.html#acbd4acd0d29e2d6c43104827f77d9cd2">uint32</a>(<a class="code" href="classInputTextRenderComponent.html#a4d3f593ac6ca875517afc57a180645b1ae833ffb109221b250d090b38b5d53dd9">STYLE_NORMAL</a>)))-&gt;<a class="code" href="classVariant.html#a02c9fa88617102d1efcb991626cda39d">GetUINT32</a>();
<a name="l00055"></a>00055         <a class="code" href="classEntityComponent.html#ab98598189ea0c5d0da7231e16bcefde4">GetVar</a>(<span class="stringliteral">&quot;visualStyle&quot;</span>)-&gt;<a class="code" href="classVariant.html#a3abb77632110a5deaa94d81e0623bd7a">GetSigOnChanged</a>()-&gt;connect(1, boost::bind(&amp;InputTextRenderComponent::OnVisualStyleChanged, <span class="keyword">this</span>, _1));
<a name="l00056"></a>00056 
<a name="l00057"></a>00057 
<a name="l00058"></a>00058         m_pTextSize2d = &amp;<a class="code" href="classEntityComponent.html#ab98598189ea0c5d0da7231e16bcefde4">GetVar</a>(<span class="stringliteral">&quot;textSize2d&quot;</span>)-&gt;<a class="code" href="classVariant.html#a623fdb9f51669ff8bfda1b6b268bbaa6">GetVector2</a>();
<a name="l00059"></a>00059         m_pTextOffsetPos2d = &amp;<a class="code" href="classEntityComponent.html#a442511658233f10576d974409840d6d7">GetVarWithDefault</a>(<span class="stringliteral">&quot;textOffsetPos2d&quot;</span>, <a class="code" href="classVariant.html">Variant</a>(3,3))-&gt;<a class="code" href="classVariant.html#a623fdb9f51669ff8bfda1b6b268bbaa6">GetVector2</a>();
<a name="l00060"></a>00060         m_pCursorColor = &amp;<a class="code" href="classEntityComponent.html#a442511658233f10576d974409840d6d7">GetVarWithDefault</a>(<span class="stringliteral">&quot;cursorColor&quot;</span>, <a class="code" href="classVariant.html">Variant</a>(MAKE_RGBA(209,181,137,255)))-&gt;<a class="code" href="classVariant.html#a02c9fa88617102d1efcb991626cda39d">GetUINT32</a>();
<a name="l00061"></a>00061         m_pInputLengthMax = &amp;<a class="code" href="classEntityComponent.html#a442511658233f10576d974409840d6d7">GetVarWithDefault</a>(<span class="stringliteral">&quot;inputLengthMax&quot;</span>, <a class="code" href="classVariant.html">Variant</a>(<a class="code" href="PlatformSetupAndroid_8h.html#acbd4acd0d29e2d6c43104827f77d9cd2">uint32</a>(10)))-&gt;<a class="code" href="classVariant.html#a02c9fa88617102d1efcb991626cda39d">GetUINT32</a>();
<a name="l00062"></a>00062         m_pBorderColor = &amp;<a class="code" href="classEntityComponent.html#a442511658233f10576d974409840d6d7">GetVarWithDefault</a>(<span class="stringliteral">&quot;borderColor&quot;</span>, <a class="code" href="classVariant.html">Variant</a>(MAKE_RGBA(255,255,255,255)))-&gt;<a class="code" href="classVariant.html#a02c9fa88617102d1efcb991626cda39d">GetUINT32</a>();
<a name="l00063"></a>00063         m_pInputType = &amp;<a class="code" href="classEntityComponent.html#a442511658233f10576d974409840d6d7">GetVarWithDefault</a>(<span class="stringliteral">&quot;inputType&quot;</span>, <a class="code" href="classVariant.html">Variant</a>(<a class="code" href="PlatformSetupAndroid_8h.html#acbd4acd0d29e2d6c43104827f77d9cd2">uint32</a>(<a class="code" href="classInputTextRenderComponent.html#a93d8044ad15fe764c012d96d2759e89ca69bf7215f9fe8418cda2f4019c19581a">INPUT_TYPE_ASCII</a>)))-&gt;<a class="code" href="classVariant.html#a02c9fa88617102d1efcb991626cda39d">GetUINT32</a>();
<a name="l00064"></a>00064         m_pFiltering = &amp;<a class="code" href="classEntityComponent.html#a442511658233f10576d974409840d6d7">GetVarWithDefault</a>(<span class="stringliteral">&quot;filtering&quot;</span>, <a class="code" href="classVariant.html">Variant</a>(<a class="code" href="PlatformSetupAndroid_8h.html#acbd4acd0d29e2d6c43104827f77d9cd2">uint32</a>(<a class="code" href="classInputTextRenderComponent.html#af8b836557dc6f64ce4c0206e08796373a6a349b0bdff43c15cbbdaaa9ea279272">FILTERING_STRICT</a>)))-&gt;<a class="code" href="classVariant.html#a02c9fa88617102d1efcb991626cda39d">GetUINT32</a>();
<a name="l00065"></a>00065         m_pTruncateTextIfNeeded = &amp;<a class="code" href="classEntityComponent.html#a442511658233f10576d974409840d6d7">GetVarWithDefault</a>(<span class="stringliteral">&quot;truncateTextIfNeeded&quot;</span>, <a class="code" href="classVariant.html">Variant</a>(<a class="code" href="PlatformSetupAndroid_8h.html#acbd4acd0d29e2d6c43104827f77d9cd2">uint32</a>(0)))-&gt;<a class="code" href="classVariant.html#a02c9fa88617102d1efcb991626cda39d">GetUINT32</a>();
<a name="l00066"></a>00066         <a class="code" href="classEntityComponent.html#ab98598189ea0c5d0da7231e16bcefde4">GetVar</a>(<span class="stringliteral">&quot;truncateTextIfNeeded&quot;</span>)-&gt;<a class="code" href="classVariant.html#a3abb77632110a5deaa94d81e0623bd7a">GetSigOnChanged</a>()-&gt;connect(1, boost::bind(&amp;InputTextRenderComponent::OnTruncateTextIfNeededChanged, <span class="keyword">this</span>, _1));
<a name="l00067"></a>00067 
<a name="l00068"></a>00068         m_pText = &amp;<a class="code" href="classEntityComponent.html#ab98598189ea0c5d0da7231e16bcefde4">GetVar</a>(<span class="stringliteral">&quot;text&quot;</span>)-&gt;<a class="code" href="classVariant.html#a2300548c7f923ba77e6e51e22131585d">GetString</a>(); <span class="comment">//local to us</span>
<a name="l00069"></a>00069         <a class="code" href="classEntityComponent.html#ab98598189ea0c5d0da7231e16bcefde4">GetVar</a>(<span class="stringliteral">&quot;text&quot;</span>)-&gt;<a class="code" href="classVariant.html#a3abb77632110a5deaa94d81e0623bd7a">GetSigOnChanged</a>()-&gt;connect(1, boost::bind(&amp;InputTextRenderComponent::OnTextChanged, <span class="keyword">this</span>, _1));
<a name="l00070"></a>00070 
<a name="l00071"></a>00071         m_pPlaceHolderText = &amp;<a class="code" href="classEntityComponent.html#ab98598189ea0c5d0da7231e16bcefde4">GetVar</a>(<span class="stringliteral">&quot;placeHolderText&quot;</span>)-&gt;<a class="code" href="classVariant.html#a2300548c7f923ba77e6e51e22131585d">GetString</a>(); <span class="comment">//local to us</span>
<a name="l00072"></a>00072 
<a name="l00073"></a>00073         m_pFontID = &amp;<a class="code" href="classEntityComponent.html#a442511658233f10576d974409840d6d7">GetVarWithDefault</a>(<span class="stringliteral">&quot;font&quot;</span>, <a class="code" href="PlatformSetupAndroid_8h.html#acbd4acd0d29e2d6c43104827f77d9cd2">uint32</a>(<a class="code" href="BaseApp_8h.html#a2e76f2763cbe7ef26f60343a0024e198a304227491dc5dac288c794f02547c172">FONT_SMALL</a>))-&gt;<a class="code" href="classVariant.html#a02c9fa88617102d1efcb991626cda39d">GetUINT32</a>();
<a name="l00074"></a>00074         <a class="code" href="classEntityComponent.html#ab98598189ea0c5d0da7231e16bcefde4">GetVar</a>(<span class="stringliteral">&quot;font&quot;</span>)-&gt;<a class="code" href="classVariant.html#a3abb77632110a5deaa94d81e0623bd7a">GetSigOnChanged</a>()-&gt;connect(1, boost::bind(&amp;InputTextRenderComponent::OnFontChanged, <span class="keyword">this</span>, _1));
<a name="l00075"></a>00075         <a class="code" href="classEntityComponent.html#a1f7f2527931a1ee880178e1587e997b5">GetParent</a>()-&gt;<a class="code" href="classEntity.html#ae244d907956ed32fb3b9d399e3fa1d2a" title="Gets a named Variant from this Entity&#39;s variant DB.">GetVar</a>(<span class="stringliteral">&quot;scale2d&quot;</span>)-&gt;<a class="code" href="classVariant.html#a3abb77632110a5deaa94d81e0623bd7a">GetSigOnChanged</a>()-&gt;connect(1, boost::bind(&amp;InputTextRenderComponent::OnScaleChanged, <span class="keyword">this</span>, _1));
<a name="l00076"></a>00076 
<a name="l00077"></a>00077         <span class="comment">//register ourselves to render if the parent does</span>
<a name="l00078"></a>00078         <a class="code" href="classEntityComponent.html#a1f7f2527931a1ee880178e1587e997b5">GetParent</a>()-&gt;<a class="code" href="classEntity.html#a3caca7df803637d92b141daca30f4c3b">GetFunction</a>(<span class="stringliteral">&quot;OnRender&quot;</span>)-&gt;<a class="code" href="classFunctionObject.html#abfd6ae66d3b358d20aaab70d861e57e7">sig_function</a>.connect(1, boost::bind(&amp;InputTextRenderComponent::OnRender, <span class="keyword">this</span>, _1));
<a name="l00079"></a>00079         <a class="code" href="classEntityComponent.html#a1f7f2527931a1ee880178e1587e997b5">GetParent</a>()-&gt;<a class="code" href="classEntity.html#a3caca7df803637d92b141daca30f4c3b">GetFunction</a>(<span class="stringliteral">&quot;OnUpdate&quot;</span>)-&gt;<a class="code" href="classFunctionObject.html#abfd6ae66d3b358d20aaab70d861e57e7">sig_function</a>.connect(1, boost::bind(&amp;InputTextRenderComponent::OnUpdate, <span class="keyword">this</span>, _1));
<a name="l00080"></a>00080 
<a name="l00081"></a>00081         <span class="comment">//on android we might need to reinit the soft keyboard</span>
<a name="l00082"></a>00082 
<a name="l00083"></a>00083         <a class="code" href="BaseApp_8h.html#a72086b48d24daf0a65dd20189a16bd16">GetBaseApp</a>()-&gt;<a class="code" href="classBaseApp.html#aaee0be683732eb188792eb1d97cf6bdd" title="Game restored focus.">m_sig_enterforeground</a>.connect(1, boost::bind(&amp;InputTextRenderComponent::OnEnterForeground, <span class="keyword">this</span>, _1));
<a name="l00084"></a>00084         <a class="code" href="BaseApp_8h.html#a72086b48d24daf0a65dd20189a16bd16">GetBaseApp</a>()-&gt;<a class="code" href="classBaseApp.html#ae7fc69fe80d3aeba8b5874a5990e14d2" title="Game lost focus.">m_sig_enterbackground</a>.connect(1, boost::bind(&amp;InputTextRenderComponent::OnEnterBackground, <span class="keyword">this</span>, _1));
<a name="l00085"></a>00085 
<a name="l00086"></a>00086 }
<a name="l00087"></a>00087 
<a name="l00088"></a>00088 
<a name="l00089"></a>00089 
<a name="l00090"></a>00090 <span class="keywordtype">void</span> InputTextRenderComponent::OnVisibilityChanged(<a class="code" href="classVariant.html">Variant</a> *pDataObject)
<a name="l00091"></a>00091 {
<a name="l00092"></a>00092         <span class="keywordflow">if</span> (pDataObject-&gt;<a class="code" href="classVariant.html#a02c9fa88617102d1efcb991626cda39d">GetUINT32</a>() == 0)
<a name="l00093"></a>00093         {
<a name="l00094"></a>00094                 <span class="comment">//we&#39;re no longer visible.  If we have focus and the keyboard is up, we should really put it down</span>
<a name="l00095"></a>00095                 CloseKeyboard(NULL);
<a name="l00096"></a>00096         }
<a name="l00097"></a>00097 }
<a name="l00098"></a>00098 
<a name="l00099"></a>00099 
<a name="l00100"></a>00100 <span class="keywordtype">void</span> InputTextRenderComponent::OnDisabledChanged(<a class="code" href="classVariant.html">Variant</a> *pDataObject)
<a name="l00101"></a>00101 {
<a name="l00102"></a>00102         <span class="keywordflow">if</span> (pDataObject-&gt;<a class="code" href="classVariant.html#a02c9fa88617102d1efcb991626cda39d">GetUINT32</a>() == 1)
<a name="l00103"></a>00103         {
<a name="l00104"></a>00104                 <span class="comment">//we should lose focus if we had it, otherwise it will look weird with the blinking carrot on a dimmed out control</span>
<a name="l00105"></a>00105                 CloseKeyboard(NULL);
<a name="l00106"></a>00106         }
<a name="l00107"></a>00107 }
<a name="l00108"></a>00108 
<a name="l00109"></a>00109 <span class="keywordtype">void</span> InputTextRenderComponent::OnTextChanged(<a class="code" href="classVariant.html">Variant</a> *pDataObject)
<a name="l00110"></a>00110 {
<a name="l00111"></a>00111         <a class="code" href="structrtRectf.html">rtRectf</a> rt;
<a name="l00112"></a>00112 
<a name="l00113"></a>00113         <span class="keywordflow">switch</span>(*m_pVisualStyle)
<a name="l00114"></a>00114         {
<a name="l00115"></a>00115         <span class="keywordflow">case</span> <a class="code" href="classInputTextRenderComponent.html#a4d3f593ac6ca875517afc57a180645b1ae833ffb109221b250d090b38b5d53dd9">STYLE_NORMAL</a>:
<a name="l00116"></a>00116         <span class="keywordflow">if</span> (*m_pTruncateTextIfNeeded != 0)
<a name="l00117"></a>00117         {
<a name="l00118"></a>00118                 m_displayText = TrimText(m_pText);
<a name="l00119"></a>00119                 <span class="comment">//also set the real thing</span>
<a name="l00120"></a>00120                 *m_pText = m_displayText;
<a name="l00121"></a>00121         } <span class="keywordflow">else</span>
<a name="l00122"></a>00122         {
<a name="l00123"></a>00123                 m_displayText = *m_pText;
<a name="l00124"></a>00124         }
<a name="l00125"></a>00125 
<a name="l00126"></a>00126         <span class="keywordflow">break</span>;
<a name="l00127"></a>00127 
<a name="l00128"></a>00128         <span class="keywordflow">case</span> <a class="code" href="classInputTextRenderComponent.html#a4d3f593ac6ca875517afc57a180645b1a07ce8c357ec7833225baf818f650d0ee">STYLE_PASSWORD</a>:
<a name="l00129"></a>00129                 m_displayText.clear();
<a name="l00130"></a>00130                 m_displayText.resize(m_pText-&gt;size(), <span class="charliteral">&#39;*&#39;</span>);
<a name="l00131"></a>00131                 <span class="keywordflow">break</span>;
<a name="l00132"></a>00132         }
<a name="l00133"></a>00133 
<a name="l00134"></a>00134         <a class="code" href="BaseApp_8h.html#a72086b48d24daf0a65dd20189a16bd16">GetBaseApp</a>()-&gt;<a class="code" href="classBaseApp.html#ad4bb2d71a45ea06b880fa1b5e512a884">GetFont</a>(<a class="code" href="BaseApp_8h.html#a2e76f2763cbe7ef26f60343a0024e198">eFont</a>(*m_pFontID))-&gt;<a class="code" href="classRTFont.html#a07a367764133d5bfa98e2cc386038725">MeasureText</a>(&amp;rt, m_displayText, m_pScale2d-&gt;x);
<a name="l00135"></a>00135         
<a name="l00136"></a>00136         *m_pTextSize2d = CL_Vec2f(rt.<a class="code" href="structrtRectf.html#a0410aa65b3d292f46ca5b5df02a3087e">GetWidth</a>(), rt.<a class="code" href="structrtRectf.html#af5b496cf9927a066da3749ebb0c203b9">GetHeight</a>());
<a name="l00137"></a>00137 
<a name="l00138"></a>00138         <span class="keywordflow">if</span> (*m_pHasFocus)
<a name="l00139"></a>00139         {
<a name="l00140"></a>00140                 <a class="code" href="AndroidUtils_8cpp.html#ac0ecdfe3fb97001fe047f56f385d0173">SetLastStringInput</a>(*m_pText);
<a name="l00141"></a>00141         }
<a name="l00142"></a>00142 
<a name="l00143"></a>00143         <span class="comment">//oh, fix the border around us to fit if needed</span>
<a name="l00144"></a>00144         m_pSize2d-&gt;y = <a class="code" href="BaseApp_8h.html#a72086b48d24daf0a65dd20189a16bd16">GetBaseApp</a>()-&gt;<a class="code" href="classBaseApp.html#ad4bb2d71a45ea06b880fa1b5e512a884">GetFont</a>(<a class="code" href="BaseApp_8h.html#a2e76f2763cbe7ef26f60343a0024e198">eFont</a>(*m_pFontID))-&gt;<a class="code" href="classRTFont.html#ad8d60bcc3f52b432e796ef2cab7708ab">GetLineHeight</a>(m_pScale2d-&gt;y)+6.0f;
<a name="l00145"></a>00145 }
<a name="l00146"></a>00146 
<a name="l00147"></a>00147 <span class="keywordtype">void</span> InputTextRenderComponent::OnScaleChanged(<a class="code" href="classVariant.html">Variant</a> *pDataObject)
<a name="l00148"></a>00148 {
<a name="l00149"></a>00149         OnTextChanged(NULL);
<a name="l00150"></a>00150 }
<a name="l00151"></a>00151 
<a name="l00152"></a>00152 <span class="keywordtype">void</span> InputTextRenderComponent::OnVisualStyleChanged(<a class="code" href="classVariant.html">Variant</a> *pDataObject)
<a name="l00153"></a>00153 {
<a name="l00154"></a>00154         OnTextChanged(NULL);
<a name="l00155"></a>00155 }
<a name="l00156"></a>00156 
<a name="l00157"></a>00157 
<a name="l00158"></a>00158 <span class="keywordtype">void</span> InputTextRenderComponent::OnFontChanged(<a class="code" href="classVariant.html">Variant</a> *pDataObject)
<a name="l00159"></a>00159 {
<a name="l00160"></a>00160         OnTextChanged(NULL);
<a name="l00161"></a>00161 }
<a name="l00162"></a>00162 
<a name="l00163"></a>00163 <span class="keywordtype">void</span> InputTextRenderComponent::ActivateKeyboard(<a class="code" href="classVariantList.html">VariantList</a> *pVList)
<a name="l00164"></a>00164 {
<a name="l00165"></a>00165         <span class="keywordflow">if</span> (<a class="code" href="RenderUtils_8cpp.html#aed0a0b710950a1a867d83377921b1235">GetIsUsingNativeUI</a>())
<a name="l00166"></a>00166         {
<a name="l00167"></a>00167                 <span class="keywordflow">if</span> (<a class="code" href="RenderUtils_8cpp.html#a9b659f82b574d9616f26bb3131b66e09">GetEntityWithNativeUIFocus</a>() == <a class="code" href="classEntityComponent.html#a1f7f2527931a1ee880178e1587e997b5">GetParent</a>())
<a name="l00168"></a>00168                 {
<a name="l00169"></a>00169                         <span class="keywordflow">return</span>;
<a name="l00170"></a>00170                 } <span class="keywordflow">else</span>
<a name="l00171"></a>00171                 {
<a name="l00172"></a>00172                         <a class="code" href="RenderUtils_8cpp.html#a51e15055160b774712bf5085fac88780">SetIsUsingNativeUI</a>(<span class="keyword">false</span>); <span class="comment">//prepare to accept focus here and unfocus whatever had it</span>
<a name="l00173"></a>00173                         <a class="code" href="BaseApp_8h.html#a11454091168162d8f3991461725aa24f">GetMessageManager</a>()-&gt;<a class="code" href="classMessageManager.html#ae7f3c3a352708e2a3670a1c871e902d2">CallComponentFunction</a>(<span class="keyword">this</span>, 1, <span class="stringliteral">&quot;ActivateKeyboard&quot;</span>);
<a name="l00174"></a>00174                         <span class="keywordflow">return</span>;
<a name="l00175"></a>00175                 }
<a name="l00176"></a>00176         }
<a name="l00177"></a>00177         
<a name="l00178"></a>00178 
<a name="l00179"></a>00179         <span class="keywordtype">string</span> <a class="code" href="Renderer_2GL_2glext_8h.html#aaced7cfc21e7d37775d6921bb8177239">name</a> = <span class="stringliteral">&quot;Unknown&quot;</span>;
<a name="l00180"></a>00180         <span class="keywordflow">if</span> (<a class="code" href="classEntityComponent.html#a1f7f2527931a1ee880178e1587e997b5">GetParent</a>()) name = <a class="code" href="classEntityComponent.html#a1f7f2527931a1ee880178e1587e997b5">GetParent</a>()-&gt;<a class="code" href="classEntity.html#ab8a108916f59e952a46ab92395f9d48f">GetName</a>();
<a name="l00181"></a>00181 <span class="preprocessor">#ifdef _DEBUG</span>
<a name="l00182"></a>00182 <span class="preprocessor"></span>        <a class="code" href="AndroidUtils_8cpp.html#aaa5c9bf2289dec09f59ef2b7ba6c66ae">LogMsg</a>(<span class="stringliteral">&quot;InputTextRenderComponent::ActivateKeyboard sending MESSAGE_OPEN_TEXT_BOX from %s&quot;</span>, name.c_str());
<a name="l00183"></a>00183 <span class="preprocessor">#endif</span>
<a name="l00184"></a>00184 <span class="preprocessor"></span>
<a name="l00185"></a>00185         <a class="code" href="structOSMessage.html">OSMessage</a> o;
<a name="l00186"></a>00186         o.<a class="code" href="structOSMessage.html#a15a064581798f6bc8724440f285eacd7">m_type</a> = <a class="code" href="structOSMessage.html#a9fc98c3cc1a5a51feb7a977b01defadca2d7b52aaa576564087b1e1908725818c">OSMessage::MESSAGE_OPEN_TEXT_BOX</a>;
<a name="l00187"></a>00187         o.m_string = *m_pText;
<a name="l00188"></a>00188         <a class="code" href="AndroidUtils_8cpp.html#ac0ecdfe3fb97001fe047f56f385d0173">SetLastStringInput</a>(*m_pText);
<a name="l00189"></a>00189         o.m_x = -1000;
<a name="l00190"></a>00190         o.m_y = -1000; 
<a name="l00191"></a>00191         o.m_parm1 = *m_pInputLengthMax; <span class="comment">//no longer used...</span>
<a name="l00192"></a>00192         o.m_fontSize = 30.0f;
<a name="l00193"></a>00193         o.m_sizeX = 217;
<a name="l00194"></a>00194         o.m_sizeY = 40;
<a name="l00195"></a>00195 
<a name="l00196"></a>00196         <span class="keywordflow">switch</span> (*m_pInputType)
<a name="l00197"></a>00197         {
<a name="l00198"></a>00198         <span class="keywordflow">case</span> <a class="code" href="classInputTextRenderComponent.html#a93d8044ad15fe764c012d96d2759e89ca357ef543148339371d5d65193af0fe1c">INPUT_TYPE_NUMBERS</a>:
<a name="l00199"></a>00199                 o.m_parm2 = <a class="code" href="structOSMessage.html#ac9cc078cef8e42d0264719b505c63871a7249432816db987bc1c722e0132ea207">OSMessage::PARM_KEYBOARD_TYPE_NUMBERS</a>;
<a name="l00200"></a>00200                 <span class="keywordflow">break</span>;
<a name="l00201"></a>00201 
<a name="l00202"></a>00202         <span class="keywordflow">case</span> <a class="code" href="classInputTextRenderComponent.html#a93d8044ad15fe764c012d96d2759e89ca69bf7215f9fe8418cda2f4019c19581a">INPUT_TYPE_ASCII</a>:
<a name="l00203"></a>00203                 o.m_parm2 = <a class="code" href="structOSMessage.html#ac9cc078cef8e42d0264719b505c63871ac208d60c469d555ac90bd3204125f233">OSMessage::PARM_KEYBOARD_TYPE_ASCII</a>;
<a name="l00204"></a>00204                 <span class="keywordflow">break</span>;
<a name="l00205"></a>00205 
<a name="l00206"></a>00206         <span class="keywordflow">case</span> <a class="code" href="classInputTextRenderComponent.html#a93d8044ad15fe764c012d96d2759e89ca03069b9c65c380329284013fff5030a3">INPUT_TYPE_URL</a>:
<a name="l00207"></a>00207                 o.m_parm2 = <a class="code" href="structOSMessage.html#ac9cc078cef8e42d0264719b505c63871af6f42a47096b4ab8f3bcb1d6c9e0562d">OSMessage::PARM_KEYBOARD_TYPE_URL</a>;
<a name="l00208"></a>00208                 <span class="keywordflow">break</span>;
<a name="l00209"></a>00209 
<a name="l00210"></a>00210         <span class="keywordflow">case</span> <a class="code" href="classInputTextRenderComponent.html#a93d8044ad15fe764c012d96d2759e89ca0bbcafb5595ab787517878fc3f508bc5">INPUT_TYPE_ASCII_FULL</a>:
<a name="l00211"></a>00211                 o.m_parm2 = <a class="code" href="structOSMessage.html#ac9cc078cef8e42d0264719b505c63871acc2cd5c97b1284235c9321ecc82e64c5">OSMessage::PARM_KEYBOARD_TYPE_ASCII_FULL</a>;
<a name="l00212"></a>00212                 <span class="keywordflow">break</span>;
<a name="l00213"></a>00213         
<a name="l00214"></a>00214         <span class="keywordflow">case</span> <a class="code" href="classInputTextRenderComponent.html#a93d8044ad15fe764c012d96d2759e89ca70fe9cf7fa5465441c670224e3ce1308">INPUT_TYPE_EMAIL</a>:
<a name="l00215"></a>00215                 o.m_parm2 = <a class="code" href="structOSMessage.html#ac9cc078cef8e42d0264719b505c63871acf1b9e36d4dbbf791f8bfeff72f393d8">OSMessage::PARM_KEYBOARD_TYPE_EMAIL</a>;
<a name="l00216"></a>00216                 <span class="keywordflow">break</span>;
<a name="l00217"></a>00217         }
<a name="l00218"></a>00218 
<a name="l00219"></a>00219         <a class="code" href="BaseApp_8h.html#a72086b48d24daf0a65dd20189a16bd16">GetBaseApp</a>()-&gt;<a class="code" href="classBaseApp.html#a8c4775724ea459bdf155a6920a44d6db">AddOSMessage</a>(o);
<a name="l00220"></a>00220         <a class="code" href="classEntityComponent.html#ab98598189ea0c5d0da7231e16bcefde4">GetVar</a>(<span class="stringliteral">&quot;hasFocus&quot;</span>)-&gt;<a class="code" href="classVariant.html#aad26833544d00075f151ac07fa0297b3">Set</a>(<a class="code" href="PlatformSetupAndroid_8h.html#acbd4acd0d29e2d6c43104827f77d9cd2">uint32</a>(1));
<a name="l00221"></a>00221         <a class="code" href="RenderUtils_8cpp.html#a51e15055160b774712bf5085fac88780">SetIsUsingNativeUI</a>(<span class="keyword">true</span>);
<a name="l00222"></a>00222         <a class="code" href="RenderUtils_8cpp.html#a7a53c6ee901e27e494c5dabd5545e0c8">SetEntityWithNativeUIFocus</a>(<a class="code" href="classEntityComponent.html#a1f7f2527931a1ee880178e1587e997b5">GetParent</a>());
<a name="l00223"></a>00223 
<a name="l00224"></a>00224     <span class="comment">//send message to whoever cares, iCade gamepad on iOS cares about this</span>
<a name="l00225"></a>00225     <a class="code" href="classVariantList.html">VariantList</a> <a class="code" href="Renderer_2GL_2glext_8h.html#a4568fc090febc136eed4577a600739ca">v</a>;
<a name="l00226"></a>00226     v.<a class="code" href="classVariantList.html#ae09016f46aba2be2557f3fafe75a6900">Get</a>(0).<a class="code" href="classVariant.html#aad26833544d00075f151ac07fa0297b3">Set</a>((<span class="keywordtype">float</span>)<a class="code" href="MessageManager_8h.html#a700ed30d49bfe436323e17539d3a0010a75e621fc79842c867d175d06acf7d0ee">MESSAGE_TYPE_HW_KEYBOARD_INPUT_STARTING</a>);
<a name="l00227"></a>00227     <a class="code" href="BaseApp_8h.html#a72086b48d24daf0a65dd20189a16bd16">GetBaseApp</a>()-&gt;<a class="code" href="classBaseApp.html#ae61e455166e7236f6235bbbe6241e866">m_sig_hardware</a>(&amp;v);
<a name="l00228"></a>00228     
<a name="l00229"></a>00229     
<a name="l00230"></a>00230 }
<a name="l00231"></a>00231 
<a name="l00232"></a>00232 <span class="keywordtype">void</span> InputTextRenderComponent::OnLosingNativeGUIFocus(<a class="code" href="classVariantList.html">VariantList</a> *pVList)
<a name="l00233"></a>00233 {
<a name="l00234"></a>00234         <span class="keywordtype">string</span> name = <span class="stringliteral">&quot;Unknown&quot;</span>;
<a name="l00235"></a>00235         <span class="keywordflow">if</span> (<a class="code" href="classEntityComponent.html#a1f7f2527931a1ee880178e1587e997b5">GetParent</a>()) name = <a class="code" href="classEntityComponent.html#a1f7f2527931a1ee880178e1587e997b5">GetParent</a>()-&gt;<a class="code" href="classEntity.html#ab8a108916f59e952a46ab92395f9d48f">GetName</a>();
<a name="l00236"></a>00236 
<a name="l00237"></a>00237         <a class="code" href="AndroidUtils_8cpp.html#aaa5c9bf2289dec09f59ef2b7ba6c66ae">LogMsg</a>(<span class="stringliteral">&quot;Item %s losing focus, closing keyboard&quot;</span>, name.c_str());
<a name="l00238"></a>00238     <a class="code" href="classVariantList.html">VariantList</a> vList(<span class="keyword">this</span>);
<a name="l00239"></a>00239         <a class="code" href="classEntityComponent.html#aec128263d40de70312fa334b12138643">GetFunction</a>(<span class="stringliteral">&quot;CloseKeyboard&quot;</span>)-&gt;<a class="code" href="classFunctionObject.html#abfd6ae66d3b358d20aaab70d861e57e7">sig_function</a>(&amp;vList);
<a name="l00240"></a>00240 }
<a name="l00241"></a>00241 
<a name="l00242"></a>00242 <span class="keywordtype">void</span> InputTextRenderComponent::OnEnterForeground(<a class="code" href="classVariantList.html">VariantList</a> *pVList)
<a name="l00243"></a>00243 {
<a name="l00244"></a>00244         <span class="keywordflow">if</span> (<a class="code" href="RenderUtils_8cpp.html#a9b659f82b574d9616f26bb3131b66e09">GetEntityWithNativeUIFocus</a>() == <a class="code" href="classEntityComponent.html#a1f7f2527931a1ee880178e1587e997b5">GetParent</a>())
<a name="l00245"></a>00245         {
<a name="l00246"></a>00246         <span class="comment">//added for android</span>
<a name="l00247"></a>00247 
<a name="l00248"></a>00248 <span class="preprocessor">#ifdef _DEBUG</span>
<a name="l00249"></a>00249 <span class="preprocessor"></span>                <a class="code" href="AndroidUtils_8cpp.html#aaa5c9bf2289dec09f59ef2b7ba6c66ae">LogMsg</a>(<span class="stringliteral">&quot;InputTextRenderComponent::OnEnterForeground - Re-opening on keyboard&quot;</span>);
<a name="l00250"></a>00250 <span class="preprocessor">#endif</span>
<a name="l00251"></a>00251 <span class="preprocessor"></span>                <span class="comment">//re init our keyboard just in case, android needs this</span>
<a name="l00252"></a>00252                 <a class="code" href="classEntityComponent.html#aec128263d40de70312fa334b12138643">GetFunction</a>(<span class="stringliteral">&quot;ActivateKeyboard&quot;</span>)-&gt;<a class="code" href="classFunctionObject.html#abfd6ae66d3b358d20aaab70d861e57e7">sig_function</a>(NULL);
<a name="l00253"></a>00253         }
<a name="l00254"></a>00254         
<a name="l00255"></a>00255 }
<a name="l00256"></a>00256 
<a name="l00257"></a>00257 <span class="keywordtype">void</span> InputTextRenderComponent::OnEnterBackground(<a class="code" href="classVariantList.html">VariantList</a> *pVList)
<a name="l00258"></a>00258 {
<a name="l00259"></a>00259         
<a name="l00260"></a>00260         <span class="comment">//added for Android</span>
<a name="l00261"></a>00261         <span class="keywordflow">if</span> (<a class="code" href="RenderUtils_8cpp.html#a9b659f82b574d9616f26bb3131b66e09">GetEntityWithNativeUIFocus</a>() == <a class="code" href="classEntityComponent.html#a1f7f2527931a1ee880178e1587e997b5">GetParent</a>())
<a name="l00262"></a>00262         {
<a name="l00263"></a>00263 
<a name="l00264"></a>00264 <span class="preprocessor">#ifdef _DEBUG</span>
<a name="l00265"></a>00265 <span class="preprocessor"></span>                <a class="code" href="AndroidUtils_8cpp.html#aaa5c9bf2289dec09f59ef2b7ba6c66ae">LogMsg</a>(<span class="stringliteral">&quot;InputTextRenderComponent::OnEnterBackground - Running CloseKeyboard&quot;</span>);
<a name="l00266"></a>00266 <span class="preprocessor">#endif</span>
<a name="l00267"></a>00267 <span class="preprocessor"></span>        
<a name="l00268"></a>00268                 <a class="code" href="classVariantList.html">VariantList</a> vList(<span class="keyword">this</span>);
<a name="l00269"></a>00269                 <a class="code" href="classEntityComponent.html#aec128263d40de70312fa334b12138643">GetFunction</a>(<span class="stringliteral">&quot;CloseKeyboard&quot;</span>)-&gt;<a class="code" href="classFunctionObject.html#abfd6ae66d3b358d20aaab70d861e57e7">sig_function</a>(&amp;vList);
<a name="l00270"></a>00270         }
<a name="l00271"></a>00271 
<a name="l00272"></a>00272 }
<a name="l00273"></a>00273 
<a name="l00274"></a>00274 
<a name="l00275"></a>00275 <span class="keywordtype">void</span> InputTextRenderComponent::CloseKeyboard( <a class="code" href="classVariantList.html">VariantList</a> *pVList )
<a name="l00276"></a>00276 {
<a name="l00277"></a>00277         <span class="keywordtype">string</span> name = <span class="stringliteral">&quot;Unknown&quot;</span>;
<a name="l00278"></a>00278         <span class="keywordflow">if</span> (<a class="code" href="classEntityComponent.html#a1f7f2527931a1ee880178e1587e997b5">GetParent</a>()) name = <a class="code" href="classEntityComponent.html#a1f7f2527931a1ee880178e1587e997b5">GetParent</a>()-&gt;<a class="code" href="classEntity.html#ab8a108916f59e952a46ab92395f9d48f">GetName</a>();
<a name="l00279"></a>00279 
<a name="l00280"></a>00280         <span class="keywordflow">if</span> (<a class="code" href="RenderUtils_8cpp.html#a9b659f82b574d9616f26bb3131b66e09">GetEntityWithNativeUIFocus</a>() == <a class="code" href="classEntityComponent.html#a1f7f2527931a1ee880178e1587e997b5">GetParent</a>())
<a name="l00281"></a>00281         {
<a name="l00282"></a>00282 <span class="preprocessor">#ifdef _DEBUG</span>
<a name="l00283"></a>00283 <span class="preprocessor"></span>                <a class="code" href="AndroidUtils_8cpp.html#aaa5c9bf2289dec09f59ef2b7ba6c66ae">LogMsg</a>(<span class="stringliteral">&quot;InputTextRenderComponent::CloseKeyboard - setting NativeUIFocus to zero from %s&quot;</span>, name.c_str());
<a name="l00284"></a>00284 <span class="preprocessor">#endif</span>
<a name="l00285"></a>00285 <span class="preprocessor"></span>                <a class="code" href="RenderUtils_8cpp.html#a7a53c6ee901e27e494c5dabd5545e0c8">SetEntityWithNativeUIFocus</a>(NULL, <span class="keyword">true</span>);
<a name="l00286"></a>00286         }
<a name="l00287"></a>00287 
<a name="l00288"></a>00288         <span class="keywordflow">if</span> (!*m_pHasFocus) <span class="keywordflow">return</span>;
<a name="l00289"></a>00289 
<a name="l00290"></a>00290 <span class="preprocessor">#ifdef _DEBUG</span>
<a name="l00291"></a>00291 <span class="preprocessor"></span>        <a class="code" href="AndroidUtils_8cpp.html#aaa5c9bf2289dec09f59ef2b7ba6c66ae">LogMsg</a>(<span class="stringliteral">&quot;Sending MESSAGE_CLOSE_TEXT_BOX from %s&quot;</span>, name.c_str());
<a name="l00292"></a>00292 <span class="preprocessor">#endif</span>
<a name="l00293"></a>00293 <span class="preprocessor"></span>
<a name="l00294"></a>00294         <a class="code" href="classEntityComponent.html#ab98598189ea0c5d0da7231e16bcefde4">GetVar</a>(<span class="stringliteral">&quot;hasFocus&quot;</span>)-&gt;<a class="code" href="classVariant.html#aad26833544d00075f151ac07fa0297b3">Set</a>(<a class="code" href="PlatformSetupAndroid_8h.html#acbd4acd0d29e2d6c43104827f77d9cd2">uint32</a>(0));
<a name="l00295"></a>00295 
<a name="l00296"></a>00296         <a class="code" href="structOSMessage.html">OSMessage</a> o;
<a name="l00297"></a>00297         o.<a class="code" href="structOSMessage.html#a15a064581798f6bc8724440f285eacd7">m_type</a> = <a class="code" href="structOSMessage.html#a9fc98c3cc1a5a51feb7a977b01defadca3530850b5d3bf758a859ef0dae58a984">OSMessage::MESSAGE_CLOSE_TEXT_BOX</a>;
<a name="l00298"></a>00298         <a class="code" href="BaseApp_8h.html#a72086b48d24daf0a65dd20189a16bd16">GetBaseApp</a>()-&gt;<a class="code" href="classBaseApp.html#a8c4775724ea459bdf155a6920a44d6db">AddOSMessage</a>(o);
<a name="l00299"></a>00299 
<a name="l00300"></a>00300     <span class="comment">//send message to people who care, iCade gamepad on iOS cares about this...</span>
<a name="l00301"></a>00301     <a class="code" href="classVariantList.html">VariantList</a> <a class="code" href="Renderer_2GL_2glext_8h.html#a4568fc090febc136eed4577a600739ca">v</a>;
<a name="l00302"></a>00302     v.<a class="code" href="classVariantList.html#ae09016f46aba2be2557f3fafe75a6900">Get</a>(0).<a class="code" href="classVariant.html#aad26833544d00075f151ac07fa0297b3">Set</a>((<span class="keywordtype">float</span>)<a class="code" href="MessageManager_8h.html#a700ed30d49bfe436323e17539d3a0010ae04164895d459b6f7583ee8dc16d06dd">MESSAGE_TYPE_HW_KEYBOARD_INPUT_ENDING</a>);
<a name="l00303"></a>00303     <a class="code" href="BaseApp_8h.html#a72086b48d24daf0a65dd20189a16bd16">GetBaseApp</a>()-&gt;<a class="code" href="classBaseApp.html#ae61e455166e7236f6235bbbe6241e866">m_sig_hardware</a>(&amp;v);
<a name="l00304"></a>00304     
<a name="l00305"></a>00305 }
<a name="l00306"></a>00306 
<a name="l00307"></a>00307 
<a name="l00308"></a>00308 <span class="keywordtype">void</span> InputTextRenderComponent::OnTouchEnd(<a class="code" href="classVariantList.html">VariantList</a> *pVList)
<a name="l00309"></a>00309 {
<a name="l00310"></a>00310         <span class="comment">/*</span>
<a name="l00311"></a>00311 <span class="comment">        if (*m_pVisible == 0) return;</span>
<a name="l00312"></a>00312 <span class="comment"></span>
<a name="l00313"></a>00313 <span class="comment">        TouchTrackInfo *pTouch = GetBaseApp()-&gt;GetTouch(pVList-&gt;Get(2).GetUINT32());</span>
<a name="l00314"></a>00314 <span class="comment">        if (pTouch-&gt;WasHandled()) return;</span>
<a name="l00315"></a>00315 <span class="comment">        pTouch-&gt;SetWasHandled(true, GetParent());</span>
<a name="l00316"></a>00316 <span class="comment"></span>
<a name="l00317"></a>00317 <span class="comment">        if (*m_pDisabled == false)</span>
<a name="l00318"></a>00318 <span class="comment">        {</span>
<a name="l00319"></a>00319 <span class="comment">                ActivateKeyboard(NULL);</span>
<a name="l00320"></a>00320 <span class="comment">        }</span>
<a name="l00321"></a>00321 <span class="comment">        */</span>
<a name="l00322"></a>00322 }
<a name="l00323"></a>00323 
<a name="l00324"></a>00324 
<a name="l00325"></a>00325 <span class="keywordtype">void</span> InputTextRenderComponent::OnTouchStart(<a class="code" href="classVariantList.html">VariantList</a> *pVList)
<a name="l00326"></a>00326 {
<a name="l00327"></a>00327         <span class="keywordflow">if</span> (*m_pVisible == 0) <span class="keywordflow">return</span>;
<a name="l00328"></a>00328 
<a name="l00329"></a>00329         <a class="code" href="classTouchTrackInfo.html">TouchTrackInfo</a> *pTouch = <a class="code" href="BaseApp_8h.html#a72086b48d24daf0a65dd20189a16bd16">GetBaseApp</a>()-&gt;<a class="code" href="classBaseApp.html#afa088b1de3a17d9d06533cc27a1fe9e0">GetTouch</a>(pVList-&gt;<a class="code" href="classVariantList.html#ae09016f46aba2be2557f3fafe75a6900">Get</a>(2).<a class="code" href="classVariant.html#a02c9fa88617102d1efcb991626cda39d">GetUINT32</a>());
<a name="l00330"></a>00330         <span class="keywordflow">if</span> (pTouch-&gt;<a class="code" href="classTouchTrackInfo.html#a8fad66ad15f2935b8956abb5fe367dc3">WasHandled</a>()) <span class="keywordflow">return</span>;
<a name="l00331"></a>00331         pTouch-&gt;<a class="code" href="classTouchTrackInfo.html#a13c8cada4a6a9861337f68b6df14a7a5">SetWasHandled</a>(<span class="keyword">true</span>, <a class="code" href="classEntityComponent.html#a1f7f2527931a1ee880178e1587e997b5">GetParent</a>());
<a name="l00332"></a>00332 
<a name="l00333"></a>00333         <span class="keywordflow">if</span> (*m_pDisabled == <span class="keyword">false</span>)
<a name="l00334"></a>00334         {
<a name="l00335"></a>00335                 ActivateKeyboard(NULL);
<a name="l00336"></a>00336         }
<a name="l00337"></a>00337 }
<a name="l00338"></a><a class="code" href="classInputTextRenderComponent.html#ac048af39002ea7bf1f512ac6ff9fe727">00338</a> <span class="keywordtype">void</span> <a class="code" href="classInputTextRenderComponent.html#ac048af39002ea7bf1f512ac6ff9fe727">InputTextRenderComponent::OnRemove</a>()
<a name="l00339"></a>00339 {
<a name="l00340"></a>00340         <span class="comment">/*</span>
<a name="l00341"></a>00341 <span class="comment">        if (GetEntityWithNativeUIFocus() == GetParent())</span>
<a name="l00342"></a>00342 <span class="comment">        {</span>
<a name="l00343"></a>00343 <span class="comment">                SetEntityWithNativeUIFocus(NULL);</span>
<a name="l00344"></a>00344 <span class="comment">        }</span>
<a name="l00345"></a>00345 <span class="comment">        //Don&#39;t do this, otherwise we won&#39;t kill the keyboard properly in the deconstructor</span>
<a name="l00346"></a>00346 <span class="comment">        */</span>
<a name="l00347"></a>00347 
<a name="l00348"></a>00348         <a class="code" href="classInputTextRenderComponent.html#ac048af39002ea7bf1f512ac6ff9fe727">EntityComponent::OnRemove</a>();
<a name="l00349"></a>00349 }
<a name="l00350"></a>00350 
<a name="l00351"></a>00351 <span class="keywordtype">void</span> InputTextRenderComponent::OnUpdate(<a class="code" href="classVariantList.html">VariantList</a> *pVList)
<a name="l00352"></a>00352 {
<a name="l00353"></a>00353 
<a name="l00354"></a>00354         <span class="keywordflow">if</span> (*m_pHasFocus)
<a name="l00355"></a>00355         {
<a name="l00356"></a>00356 
<a name="l00357"></a>00357         
<a name="l00358"></a>00358         <span class="comment">//      string curString = FilterToValidAscii(GetLastStringInput(), *m_pFiltering == FILTERING_STRICT);</span>
<a name="l00359"></a>00359                                 
<a name="l00360"></a>00360                 <span class="keywordtype">string</span> curString = <a class="code" href="AndroidUtils_8cpp.html#abf3b9c4cc1c16939d0be67eca2025c0c">GetLastStringInput</a>(); <span class="comment">//don&#39;t have to filter, already was</span>
<a name="l00361"></a>00361                 
<a name="l00362"></a>00362                 <span class="keywordflow">if</span> (*m_pText != curString)
<a name="l00363"></a>00363                 {
<a name="l00364"></a>00364                         <span class="keywordflow">if</span> (curString.size() &gt; m_pText-&gt;size())
<a name="l00365"></a>00365                         {
<a name="l00366"></a>00366                                 <span class="comment">//well, a character was added.  send it in case anybody cares</span>
<a name="l00367"></a>00367                 <a class="code" href="classVariantList.html">VariantList</a> vList( <span class="keyword">this</span>, <a class="code" href="PlatformSetupAndroid_8h.html#acbd4acd0d29e2d6c43104827f77d9cd2">uint32</a>(curString[curString.size()-1]));
<a name="l00368"></a>00368                                 <a class="code" href="classEntityComponent.html#aec128263d40de70312fa334b12138643">GetFunction</a>(<span class="stringliteral">&quot;OnChar&quot;</span>)-&gt;<a class="code" href="classFunctionObject.html#abfd6ae66d3b358d20aaab70d861e57e7">sig_function</a>(&amp;vList);
<a name="l00369"></a>00369                         } <span class="keywordflow">else</span>
<a name="l00370"></a>00370                         {
<a name="l00371"></a>00371                                 <span class="keywordflow">if</span> (curString.size() &lt; m_pText-&gt;size())
<a name="l00372"></a>00372                                 {
<a name="l00373"></a>00373                     <a class="code" href="classVariantList.html">VariantList</a> vList( <span class="keyword">this</span>, <a class="code" href="PlatformSetupAndroid_8h.html#acbd4acd0d29e2d6c43104827f77d9cd2">uint32</a>(8) );
<a name="l00374"></a>00374                     
<a name="l00375"></a>00375                                         <a class="code" href="classEntityComponent.html#aec128263d40de70312fa334b12138643">GetFunction</a>(<span class="stringliteral">&quot;OnChar&quot;</span>)-&gt;<a class="code" href="classFunctionObject.html#abfd6ae66d3b358d20aaab70d861e57e7">sig_function</a>(&amp;vList); <span class="comment">//send a delete char</span>
<a name="l00376"></a>00376                                 }
<a name="l00377"></a>00377                         }
<a name="l00378"></a>00378                 
<a name="l00379"></a>00379                         <a class="code" href="classEntityComponent.html#ab98598189ea0c5d0da7231e16bcefde4">GetVar</a>(<span class="stringliteral">&quot;text&quot;</span>)-&gt;<a class="code" href="classVariant.html#aad26833544d00075f151ac07fa0297b3">Set</a>(curString);
<a name="l00380"></a>00380                 }
<a name="l00381"></a>00381         
<a name="l00382"></a>00382         
<a name="l00383"></a>00383                 <span class="keywordflow">if</span> (!<a class="code" href="RenderUtils_8cpp.html#aed0a0b710950a1a867d83377921b1235">GetIsUsingNativeUI</a>())
<a name="l00384"></a>00384                 {
<a name="l00385"></a>00385                         <span class="comment">//the keyboard is closed, we&#39;re done</span>
<a name="l00386"></a>00386                         <a class="code" href="classEntityComponent.html#ab98598189ea0c5d0da7231e16bcefde4">GetVar</a>(<span class="stringliteral">&quot;hasFocus&quot;</span>)-&gt;<a class="code" href="classVariant.html#aad26833544d00075f151ac07fa0297b3">Set</a>(<a class="code" href="PlatformSetupAndroid_8h.html#acbd4acd0d29e2d6c43104827f77d9cd2">uint32</a>(0));
<a name="l00387"></a>00387                         <a class="code" href="classEntityComponent.html#aec128263d40de70312fa334b12138643">GetFunction</a>(<span class="stringliteral">&quot;CloseKeyboard&quot;</span>)-&gt;<a class="code" href="classFunctionObject.html#abfd6ae66d3b358d20aaab70d861e57e7">sig_function</a>(NULL);
<a name="l00388"></a>00388                 }
<a name="l00389"></a>00389         }
<a name="l00390"></a>00390 }
<a name="l00391"></a>00391 
<a name="l00392"></a>00392 <span class="keywordtype">void</span> InputTextRenderComponent::OnRender(<a class="code" href="classVariantList.html">VariantList</a> *pVList)
<a name="l00393"></a>00393 {
<a name="l00394"></a>00394         <span class="keywordflow">if</span> (*m_pAlpha &lt;= 0) <span class="keywordflow">return</span>;
<a name="l00395"></a>00395 
<a name="l00396"></a>00396         <span class="keywordflow">if</span> (*m_pVisible == 0) <span class="keywordflow">return</span>;
<a name="l00397"></a>00397 
<a name="l00398"></a>00398         CL_Vec2f vFinalPos = pVList-&gt;<a class="code" href="classVariantList.html#af64fa28d435940d9d0e0f2adf147b742">m_variant</a>[0].<a class="code" href="classVariant.html#a623fdb9f51669ff8bfda1b6b268bbaa6">GetVector2</a>()+*m_pPos2d;
<a name="l00399"></a>00399         <span class="comment">//vFinalPos -= GetAlignmentOffset(*m_pSize2d, eAlignment(*m_pAlignment));</span>
<a name="l00400"></a>00400 
<a name="l00401"></a>00401         <span class="keywordflow">if</span> (vFinalPos.y &lt; -m_pSize2d-&gt;y) <span class="keywordflow">return</span>;
<a name="l00402"></a>00402         <span class="keywordflow">if</span> (vFinalPos.y &gt; <a class="code" href="GLESUtils_8cpp.html#a45e5c79ef6e83cc998fd8b6be83f2e1a">GetOrthoRenderSizeYf</a>()) <span class="keywordflow">return</span>;
<a name="l00403"></a>00403 
<a name="l00404"></a>00404         <span class="keywordtype">float</span> <a class="code" href="flash_2GLES_2glext_8h.html#ac679905d37690e6431eaf72910a29d36">alpha</a>;
<a name="l00405"></a>00405 
<a name="l00406"></a>00406         <span class="keywordflow">if</span> (*m_pDisabled)
<a name="l00407"></a>00407         {
<a name="l00408"></a>00408                 alpha = rt_min(*m_pAlpha, 0.5<a class="code" href="Renderer_2GL_2glext_8h.html#aba8ad56949f59242bc167b073dae3715">f</a>);
<a name="l00409"></a>00409         } <span class="keywordflow">else</span>
<a name="l00410"></a>00410         {
<a name="l00411"></a>00411                 alpha = *m_pAlpha;
<a name="l00412"></a>00412         }
<a name="l00413"></a>00413         
<a name="l00414"></a>00414         <a class="code" href="PlatformSetupAndroid_8h.html#acbd4acd0d29e2d6c43104827f77d9cd2">uint32</a> <a class="code" href="Renderer_2GL_2glext_8h.html#a3ea846f998d64f079b86052b6c4193a8">color</a> = <a class="code" href="RenderUtils_8cpp.html#a444dc2512a095df169e9c7b1aa49648b" title="Performs a &quot;linear burn&quot; operation for the colors c1 and c2.">ColorCombine</a>(*m_pColor, *m_pColorMod, alpha);
<a name="l00415"></a>00415 
<a name="l00416"></a>00416         <span class="keywordtype">string</span> *pTextToDraw = &amp;m_displayText;
<a name="l00417"></a>00417 
<a name="l00418"></a>00418         <span class="keywordflow">if</span> (!*m_pHasFocus &amp;&amp; !m_pPlaceHolderText-&gt;empty())
<a name="l00419"></a>00419         {
<a name="l00420"></a>00420                 pTextToDraw = m_pPlaceHolderText;
<a name="l00421"></a>00421         }
<a name="l00422"></a>00422 
<a name="l00423"></a>00423         <a class="code" href="BaseApp_8h.html#a72086b48d24daf0a65dd20189a16bd16">GetBaseApp</a>()-&gt;<a class="code" href="classBaseApp.html#ad4bb2d71a45ea06b880fa1b5e512a884">GetFont</a>(<a class="code" href="BaseApp_8h.html#a2e76f2763cbe7ef26f60343a0024e198">eFont</a>(*m_pFontID))-&gt;<a class="code" href="classRTFont.html#a772ed3b1ed0724f0d74ae4a0de8fa4c6">DrawScaled</a>(vFinalPos.x+m_pTextOffsetPos2d-&gt;x* m_pScale2d-&gt;x, vFinalPos.y+m_pTextOffsetPos2d-&gt;y* m_pScale2d-&gt;y, *pTextToDraw, m_pScale2d-&gt;x, color);
<a name="l00424"></a>00424         
<a name="l00425"></a>00425 
<a name="l00426"></a>00426         <a class="code" href="PlatformSetupAndroid_8h.html#acbd4acd0d29e2d6c43104827f77d9cd2">uint32</a> borderCol = <a class="code" href="RenderUtils_8cpp.html#a444dc2512a095df169e9c7b1aa49648b" title="Performs a &quot;linear burn&quot; operation for the colors c1 and c2.">ColorCombine</a>(*m_pBorderColor, MAKE_RGBA(255,255,255,255), alpha);
<a name="l00427"></a>00427         <span class="keywordflow">if</span> (GET_ALPHA(borderCol) &gt; 0)
<a name="l00428"></a>00428         {
<a name="l00429"></a>00429                 <a class="code" href="GLESUtils_8cpp.html#a6ac3f63b00b7c06f823a5d23a6d63053">DrawRect</a>(vFinalPos, *m_pSize2d, borderCol);
<a name="l00430"></a>00430         }
<a name="l00431"></a>00431 
<a name="l00432"></a>00432         <span class="keywordflow">if</span> (*m_pHasFocus)
<a name="l00433"></a>00433         {
<a name="l00434"></a>00434                 <span class="comment">//draw the blinking cursor too</span>
<a name="l00435"></a>00435                 <span class="keywordtype">float</span> <a class="code" href="flash_2GLES_2glext_8h.html#aedd0ea77029b98ce91e47c19addcb68f">height</a> = <a class="code" href="BaseApp_8h.html#a72086b48d24daf0a65dd20189a16bd16">GetBaseApp</a>()-&gt;<a class="code" href="classBaseApp.html#ad4bb2d71a45ea06b880fa1b5e512a884">GetFont</a>(<a class="code" href="BaseApp_8h.html#a2e76f2763cbe7ef26f60343a0024e198">eFont</a>(*m_pFontID))-&gt;<a class="code" href="classRTFont.html#ad8d60bcc3f52b432e796ef2cab7708ab">GetLineHeight</a>(m_pScale2d-&gt;x);
<a name="l00436"></a>00436                                 
<a name="l00437"></a>00437                 CL_Vec2f vCursorPos(vFinalPos+*m_pTextOffsetPos2d);
<a name="l00438"></a>00438                 vCursorPos.x += m_pTextSize2d-&gt;x;
<a name="l00439"></a>00439                 
<a name="l00440"></a>00440                 CL_Rectf <a class="code" href="flash_2GLES_2glext_8h.html#abe08814c2f72843fde4d8df41440d5a0">r</a> = CL_Rectf(vCursorPos.x, vCursorPos.y, vCursorPos.x+2, vCursorPos.y+height); 
<a name="l00441"></a>00441                 <span class="keywordtype">float</span> blinkAlpha = ((<a class="code" href="RenderUtils_8cpp.html#a16da0d063d5f1b04ea0787849ff48fe8">SinPulseByMS</a>(500)+1)/2);
<a name="l00442"></a>00442                 <a class="code" href="PlatformSetupAndroid_8h.html#acbd4acd0d29e2d6c43104827f77d9cd2">uint32</a> color = <a class="code" href="RenderUtils_8cpp.html#a444dc2512a095df169e9c7b1aa49648b" title="Performs a &quot;linear burn&quot; operation for the colors c1 and c2.">ColorCombine</a>(*m_pCursorColor, *m_pColorMod, *m_pAlpha*blinkAlpha);
<a name="l00443"></a>00443                 
<a name="l00444"></a>00444                 <span class="keywordflow">if</span> (GET_ALPHA(color) &gt; 0)
<a name="l00445"></a>00445                 <a class="code" href="GLESUtils_8cpp.html#a5d08d616ba56f053d6dbcd5f60ddd25c">DrawFilledRect</a>(r, color);
<a name="l00446"></a>00446         }
<a name="l00447"></a>00447 }
<a name="l00448"></a>00448 
<a name="l00449"></a>00449 <span class="keywordtype">void</span> InputTextRenderComponent::OnInput( <a class="code" href="classVariantList.html">VariantList</a> *pVList )
<a name="l00450"></a>00450 {
<a name="l00451"></a>00451         <span class="keywordflow">if</span> (*m_pVisible == 0) <span class="keywordflow">return</span>;
<a name="l00452"></a>00452 
<a name="l00453"></a>00453 
<a name="l00454"></a>00454         <a class="code" href="MessageManager_8h.html#a700ed30d49bfe436323e17539d3a0010">eMessageType</a> messageType = <a class="code" href="MessageManager_8h.html#a700ed30d49bfe436323e17539d3a0010">eMessageType</a>( <span class="keywordtype">int</span>(pVList-&gt;<a class="code" href="classVariantList.html#ae09016f46aba2be2557f3fafe75a6900">Get</a>(0).<a class="code" href="classVariant.html#a37b2540d2a848c60a31ea4775892a683">GetFloat</a>()));
<a name="l00455"></a>00455 
<a name="l00456"></a>00456         <span class="keywordflow">if</span> (!*m_pHasFocus)
<a name="l00457"></a>00457         {
<a name="l00458"></a>00458                 <span class="comment">//well, there is one exception to a keypress we&#39;ll process, if nobody else focus, and it&#39;s an enter, and we&#39;re</span>
<a name="l00459"></a>00459                 <span class="comment">//instructed to give ourselves focus if enter is hit, then ok.</span>
<a name="l00460"></a>00460                 <span class="keywordflow">if</span> (messageType == <a class="code" href="MessageManager_8h.html#a700ed30d49bfe436323e17539d3a0010a28f5b06e02b343a08d3c0f6f6bcd80a3">MESSAGE_TYPE_GUI_CHAR</a>)
<a name="l00461"></a>00461                 {
<a name="l00462"></a>00462                         <span class="keywordtype">char</span> <a class="code" href="Renderer_2GL_2glext_8h.html#a1f2d7f8147412c43ba2303a56f97ee73">c</a> = (char)pVList-&gt;<a class="code" href="classVariantList.html#ae09016f46aba2be2557f3fafe75a6900">Get</a>(2).<a class="code" href="classVariant.html#a02c9fa88617102d1efcb991626cda39d">GetUINT32</a>();
<a name="l00463"></a>00463                         
<a name="l00464"></a>00464                         <span class="keywordflow">if</span> (c == 13)
<a name="l00465"></a>00465                         {
<a name="l00466"></a>00466                                 <span class="keywordflow">if</span> ( *m_pGetFocusOnEnter &amp;&amp; <a class="code" href="RenderUtils_8cpp.html#a9b659f82b574d9616f26bb3131b66e09">GetEntityWithNativeUIFocus</a>() == NULL)
<a name="l00467"></a>00467                                 {
<a name="l00468"></a>00468                                         <span class="comment">//they hit enter, give ourselves focus!</span>
<a name="l00469"></a>00469                                         <a class="code" href="classEntityComponent.html#aec128263d40de70312fa334b12138643">GetFunction</a>(<span class="stringliteral">&quot;ActivateKeyboard&quot;</span>)-&gt;<a class="code" href="classFunctionObject.html#abfd6ae66d3b358d20aaab70d861e57e7">sig_function</a>(NULL);
<a name="l00470"></a>00470                                 }
<a name="l00471"></a>00471                         }
<a name="l00472"></a>00472                 }
<a name="l00473"></a>00473                 
<a name="l00474"></a>00474                 <span class="keywordflow">return</span>; <span class="comment">//don&#39;t process text if we&#39;re not active</span>
<a name="l00475"></a>00475         }
<a name="l00476"></a>00476 
<a name="l00477"></a>00477         <span class="comment">//0 = message type, 1 = parent coordinate offset, 2 = char, 3 reserved for filtering control messages</span>
<a name="l00478"></a>00478         
<a name="l00479"></a>00479         <span class="keywordflow">switch</span> (messageType)
<a name="l00480"></a>00480         {
<a name="l00481"></a>00481         <span class="keywordflow">case</span> <a class="code" href="MessageManager_8h.html#a700ed30d49bfe436323e17539d3a0010ab55c432270b3ef08e732d870a177e4ec">MESSAGE_TYPE_GUI_PASTE</a>:
<a name="l00482"></a>00482                 {
<a name="l00483"></a>00483                         <span class="keywordtype">string</span> paste = pVList-&gt;<a class="code" href="classVariantList.html#ae09016f46aba2be2557f3fafe75a6900">Get</a>(2).<a class="code" href="classVariant.html#a2300548c7f923ba77e6e51e22131585d">GetString</a>();
<a name="l00484"></a>00484                         <span class="keywordtype">string</span> <a class="code" href="Renderer_2GL_2glext_8h.html#ad3c78daa7d8673f71649d4840c641779">input</a> = *m_pText;
<a name="l00485"></a>00485 
<a name="l00486"></a>00486                         input += paste;
<a name="l00487"></a>00487 
<a name="l00488"></a>00488                         <span class="comment">//but is it too long for our input box?</span>
<a name="l00489"></a>00489                         <a class="code" href="MiscUtils_8cpp.html#acb8475c518fa8ff378d9ec3b7e79f9b5">TruncateString</a>(input, *m_pInputLengthMax);
<a name="l00490"></a>00490                         input = <a class="code" href="MiscUtils_8cpp.html#acaabaf71331c32c77910e9d405ed4bdd">FilterToValidAscii</a>(input, *m_pFiltering == <a class="code" href="classInputTextRenderComponent.html#af8b836557dc6f64ce4c0206e08796373a6a349b0bdff43c15cbbdaaa9ea279272">FILTERING_STRICT</a>);
<a name="l00491"></a>00491                         <span class="keywordflow">if</span> (*m_pHasFocus)
<a name="l00492"></a>00492                         {
<a name="l00493"></a>00493                                 <a class="code" href="AndroidUtils_8cpp.html#ac0ecdfe3fb97001fe047f56f385d0173">SetLastStringInput</a>( input);
<a name="l00494"></a>00494                         } <span class="keywordflow">else</span>
<a name="l00495"></a>00495                         {
<a name="l00496"></a>00496                                 <a class="code" href="classEntityComponent.html#ab98598189ea0c5d0da7231e16bcefde4">GetVar</a>(<span class="stringliteral">&quot;text&quot;</span>)-&gt;<a class="code" href="classVariant.html#aad26833544d00075f151ac07fa0297b3">Set</a>(input); <span class="comment">//so everybody receives notifications that it has changed</span>
<a name="l00497"></a>00497                         }
<a name="l00498"></a>00498                 }
<a name="l00499"></a>00499                 <span class="keywordflow">break</span>;
<a name="l00500"></a>00500         
<a name="l00501"></a>00501         <span class="keywordflow">case</span> <a class="code" href="MessageManager_8h.html#a700ed30d49bfe436323e17539d3a0010a28f5b06e02b343a08d3c0f6f6bcd80a3">MESSAGE_TYPE_GUI_CHAR</a>:
<a name="l00502"></a>00502 <span class="preprocessor">#ifdef _DEBUG           </span>
<a name="l00503"></a>00503 <span class="preprocessor"></span>                <span class="comment">//LogMsg(&quot;InputTextRender: Got key %u (%c)&quot;, pVList-&gt;Get(2).GetUINT32(), (char)pVList-&gt;Get(2).GetUINT32());</span>
<a name="l00504"></a>00504 <span class="preprocessor">#endif</span>
<a name="l00505"></a>00505 <span class="preprocessor"></span>                <span class="keywordflow">if</span> (pVList-&gt;<a class="code" href="classVariantList.html#ae09016f46aba2be2557f3fafe75a6900">Get</a>(2).<a class="code" href="classVariant.html#a02c9fa88617102d1efcb991626cda39d">GetUINT32</a>() &gt; 255)
<a name="l00506"></a>00506                 {
<a name="l00507"></a>00507                         <span class="comment">//a proton virtual key, like f1 or something. Ignore</span>
<a name="l00508"></a>00508                         <span class="keywordflow">break</span>;
<a name="l00509"></a>00509                 }
<a name="l00510"></a>00510 
<a name="l00511"></a>00511 
<a name="l00512"></a>00512                 <span class="keywordtype">char</span> c = (char)pVList-&gt;<a class="code" href="classVariantList.html#ae09016f46aba2be2557f3fafe75a6900">Get</a>(2).<a class="code" href="classVariant.html#a02c9fa88617102d1efcb991626cda39d">GetUINT32</a>();
<a name="l00513"></a>00513                 
<a name="l00514"></a>00514                 <span class="keywordtype">string</span> input = <a class="code" href="AndroidUtils_8cpp.html#abf3b9c4cc1c16939d0be67eca2025c0c">GetLastStringInput</a>();
<a name="l00515"></a>00515 
<a name="l00516"></a>00516                 <span class="keywordflow">switch</span> (c)
<a name="l00517"></a>00517                 {
<a name="l00518"></a>00518                 <span class="keywordflow">case</span> 13:
<a name="l00519"></a>00519                 {
<a name="l00520"></a>00520                         <span class="comment">//enter</span>
<a name="l00521"></a>00521                         <a class="code" href="classVariantList.html">VariantList</a> vList(<span class="keyword">this</span>);
<a name="l00522"></a>00522                         <a class="code" href="classEntityComponent.html#aec128263d40de70312fa334b12138643">GetFunction</a>(<span class="stringliteral">&quot;CloseKeyboard&quot;</span>)-&gt;<a class="code" href="classFunctionObject.html#abfd6ae66d3b358d20aaab70d861e57e7">sig_function</a>(&amp;vList);
<a name="l00523"></a>00523                 }
<a name="l00524"></a>00524                         <span class="keywordflow">break</span>;
<a name="l00525"></a>00525                 
<a name="l00526"></a>00526                 <span class="keywordflow">case</span> 8:
<a name="l00527"></a>00527                         <span class="comment">//backspace</span>
<a name="l00528"></a>00528                         <span class="keywordflow">if</span> (input.length() &gt; 0)
<a name="l00529"></a>00529                         {
<a name="l00530"></a>00530                                 input.erase(input.length()-1, 1);
<a name="l00531"></a>00531                         }
<a name="l00532"></a>00532                         <span class="keywordflow">break</span>;
<a name="l00533"></a>00533 
<a name="l00534"></a>00534                         
<a name="l00535"></a>00535                 <span class="keywordflow">break</span>;
<a name="l00536"></a>00536 
<a name="l00537"></a>00537                 <span class="keywordflow">default</span>:
<a name="l00538"></a>00538 
<a name="l00539"></a>00539                         <span class="keywordflow">if</span> (input.size() &lt; *m_pInputLengthMax)
<a name="l00540"></a>00540                         {
<a name="l00541"></a>00541                                 input += <a class="code" href="Renderer_2GL_2glext_8h.html#a1f2d7f8147412c43ba2303a56f97ee73">c</a>;
<a name="l00542"></a>00542                         } 
<a name="l00543"></a>00543                 }
<a name="l00544"></a>00544         
<a name="l00545"></a>00545                 <a class="code" href="AndroidUtils_8cpp.html#ac0ecdfe3fb97001fe047f56f385d0173">SetLastStringInput</a>( <a class="code" href="MiscUtils_8cpp.html#acaabaf71331c32c77910e9d405ed4bdd">FilterToValidAscii</a>(input, *m_pFiltering == <a class="code" href="classInputTextRenderComponent.html#af8b836557dc6f64ce4c0206e08796373a6a349b0bdff43c15cbbdaaa9ea279272">FILTERING_STRICT</a>));
<a name="l00546"></a>00546                 <span class="keywordflow">break</span>;
<a name="l00547"></a>00547         }       
<a name="l00548"></a>00548 }
<a name="l00549"></a>00549 
<a name="l00550"></a>00550 <span class="keywordtype">void</span> InputTextRenderComponent::OnTruncateTextIfNeededChanged(<a class="code" href="classVariant.html">Variant</a> *pDataObject)
<a name="l00551"></a>00551 {
<a name="l00552"></a>00552         <span class="keywordflow">if</span> (pDataObject-&gt;<a class="code" href="classVariant.html#a02c9fa88617102d1efcb991626cda39d">GetUINT32</a>() != 0)
<a name="l00553"></a>00553         {
<a name="l00554"></a>00554                 <span class="comment">//apply it to any existing text</span>
<a name="l00555"></a>00555                 <a class="code" href="classEntityComponent.html#ab98598189ea0c5d0da7231e16bcefde4">GetVar</a>(<span class="stringliteral">&quot;text&quot;</span>)-&gt;<a class="code" href="classVariant.html#aad26833544d00075f151ac07fa0297b3">Set</a>(*m_pText);
<a name="l00556"></a>00556         }
<a name="l00557"></a>00557 }
<a name="l00558"></a>00558 
<a name="l00559"></a>00559 <span class="keywordtype">string</span> InputTextRenderComponent::TrimText(<span class="keywordtype">string</span> *pText)
<a name="l00560"></a>00560 {
<a name="l00561"></a>00561 
<a name="l00562"></a>00562         CL_Vec2f vTextSize = <a class="code" href="BaseApp_8h.html#a72086b48d24daf0a65dd20189a16bd16">GetBaseApp</a>()-&gt;<a class="code" href="classBaseApp.html#ad4bb2d71a45ea06b880fa1b5e512a884">GetFont</a>(<a class="code" href="BaseApp_8h.html#a2e76f2763cbe7ef26f60343a0024e198">eFont</a>(*m_pFontID))-&gt;<a class="code" href="classRTFont.html#a07a367764133d5bfa98e2cc386038725">MeasureText</a>(*pText, m_pScale2d-&gt;x);
<a name="l00563"></a>00563 
<a name="l00564"></a>00564         <span class="keywordflow">if</span> (vTextSize.x &gt; m_pSize2d-&gt;x)
<a name="l00565"></a>00565         {
<a name="l00566"></a>00566                 <span class="comment">//trim that shit</span>
<a name="l00567"></a>00567                 <span class="keywordtype">int</span> charsThatFitInArea = <a class="code" href="BaseApp_8h.html#a72086b48d24daf0a65dd20189a16bd16">GetBaseApp</a>()-&gt;<a class="code" href="classBaseApp.html#ad4bb2d71a45ea06b880fa1b5e512a884">GetFont</a>(<a class="code" href="BaseApp_8h.html#a2e76f2763cbe7ef26f60343a0024e198">eFont</a>(*m_pFontID))-&gt;<a class="code" href="classRTFont.html#a6432190a2f1ca0d3ddc66d554b468842">CountCharsThatFitX</a>(m_pSize2d-&gt;x, *pText, m_pScale2d-&gt;x);
<a name="l00568"></a>00568                 <span class="keywordtype">string</span> temp = *m_pText;
<a name="l00569"></a>00569                 <a class="code" href="MiscUtils_8cpp.html#acb8475c518fa8ff378d9ec3b7e79f9b5">TruncateString</a>(temp, charsThatFitInArea);
<a name="l00570"></a>00570                 <span class="keywordflow">return</span> temp;
<a name="l00571"></a>00571                 
<a name="l00572"></a>00572         }
<a name="l00573"></a>00573         <span class="keywordflow">return</span> *m_pText;
<a name="l00574"></a>00574 }
</pre></div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Thu May 2 2013 17:17:09 for Proton by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
